<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="谷粒商城基础篇一、项目简介1.1 项目背景1.2 电商模式市面上有 5 种常见的电商模式 B2B、B2B、C2B、C2C、O2O 1.2.1 B2B 模式B2B(Business to Business)，是指商家和商家建立的商业关系，如 阿里巴巴， 1.2.2 B2C 模式B2C(Business to Consumer) 就是我们经常看到的供应商直接把商品买个用户，即 “商对客” 模式，也就是">
<meta property="og:type" content="website">
<meta property="og:title" content="GGB&#39;s Blog">
<meta property="og:url" content="http://example.com/categories/mall.html">
<meta property="og:site_name" content="GGB&#39;s Blog">
<meta property="og:description" content="谷粒商城基础篇一、项目简介1.1 项目背景1.2 电商模式市面上有 5 种常见的电商模式 B2B、B2B、C2B、C2C、O2O 1.2.1 B2B 模式B2B(Business to Business)，是指商家和商家建立的商业关系，如 阿里巴巴， 1.2.2 B2C 模式B2C(Business to Consumer) 就是我们经常看到的供应商直接把商品买个用户，即 “商对客” 模式，也就是">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg">
<meta property="og:image" content="http://example.com/image-20201015112852613.png">
<meta property="og:image" content="http://example.com/image-20201015101317095.png">
<meta property="og:image" content="http://example.com/image-20201015103427667.png">
<meta property="og:image" content="http://example.com/image-20201015103547907.png">
<meta property="og:image" content="http://example.com/image-20201015104330935.png">
<meta property="og:image" content="http://example.com/image-20201015104450711.png">
<meta property="og:image" content="http://example.com/image-20201015105256207.png">
<meta property="og:image" content="http://example.com/image-20201015110148578.png">
<meta property="og:image" content="http://example.com/image-20201015125006196.png">
<meta property="og:image" content="http://example.com/image-20201015125024611.png">
<meta property="og:image" content="http://example.com/image-20201015125053510.png">
<meta property="og:image" content="http://example.com/image-20201015141629387.png">
<meta property="og:image" content="http://example.com/image-20201015144524435.png">
<meta property="og:image" content="http://example.com/image-20201015151247976.png">
<meta property="og:image" content="http://example.com/image-20201016131742532.png">
<meta property="og:image" content="http://example.com/image-20201016131803836.png">
<meta property="og:image" content="http://example.com/image-20201016153720815.png">
<meta property="og:image" content="http://example.com/image-20201016174432942.png">
<meta property="og:image" content="http://example.com/image-20201016174334134.png">
<meta property="og:image" content="http://example.com/image-20201125115407751.png">
<meta property="og:image" content="http://example.com/image-20201125120634969.png">
<meta property="og:image" content="http://example.com/image-20201126154714221.png">
<meta property="og:image" content="http://example.com/image-20201126165501709.png">
<meta property="og:image" content="http://example.com/image-20201126165336761.png">
<meta property="og:image" content="http://example.com/image-20201126164858768.png">
<meta property="og:image" content="http://example.com/image-20201126161848389.png">
<meta property="og:image" content="http://example.com/image-20201127102052864.png">
<meta property="og:image" content="http://example.com/image-20201019202316446.png">
<meta property="og:image" content="http://example.com/image-20201019202933756.png">
<meta property="og:image" content="http://example.com/image-20201019203642525.png">
<meta property="og:image" content="http://example.com/image-20201019203744740.png">
<meta property="og:image" content="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3156348951/p139016.png">
<meta property="og:image" content="http://example.com/image-20201016222628121.png">
<meta property="og:image" content="http://example.com/image-20201127111241744.png">
<meta property="og:image" content="http://example.com/image-20201017104101531.png">
<meta property="og:image" content="http://example.com/image-20201017105714352.png">
<meta property="og:image" content="http://example.com/image-20201017085122214.png">
<meta property="og:image" content="http://example.com/image-20201020083615056.png">
<meta property="og:image" content="http://example.com/image-20201020083857519.png">
<meta property="og:image" content="http://example.com/image-20201020150957557.png">
<meta property="og:image" content="http://example.com/image-20201020151022330.png">
<meta property="og:image" content="http://example.com/image-20201017090210286.png">
<meta property="og:image" content="http://example.com/image-20201017090318165.png">
<meta property="og:image" content="http://example.com/image-20201017090546193.png">
<meta property="og:image" content="http://example.com/image-20201017090434369.png">
<meta property="og:image" content="http://example.com/image-20201018160751922.png">
<meta property="og:image" content="http://example.com/image-20201018161429599.png">
<meta property="og:image" content="http://example.com/image-20201018164706109.png">
<meta property="og:image" content="http://example.com/image-20201018164715825.png">
<meta property="og:image" content="http://example.com/image-20201018164748228.png">
<meta property="og:image" content="http://example.com/image-20201018093124893.png">
<meta property="og:image" content="http://example.com/image-20201018115207636.png">
<meta property="og:image" content="http://example.com/image-20201018115219350.png">
<meta property="og:image" content="http://example.com/image-20201018115326664.png">
<meta property="og:image" content="http://example.com/image-20201019201328358.png">
<meta property="og:image" content="http://example.com/image-20201019204335899.png">
<meta property="og:image" content="http://example.com/image-20201019205020068.png">
<meta property="og:image" content="http://example.com/image-20201020083020271.png">
<meta property="og:image" content="http://example.com/image-20201020151047887.png">
<meta property="og:image" content="http://example.com/image-20201020153526835.png">
<meta property="og:image" content="http://example.com/image-20201020154619941.png">
<meta property="og:image" content="http://example.com/image-20201020120929362.png">
<meta property="og:image" content="http://example.com/image-20201021051239049.png">
<meta property="og:image" content="http://example.com/image-20201021051433485.png">
<meta property="og:image" content="http://example.com/image-20201021051653178.png">
<meta property="og:image" content="http://example.com/image-20201022154745658.png">
<meta property="og:image" content="http://example.com/image-20201022155557579.png">
<meta property="og:image" content="http://example.com/image-20201022161654834.png">
<meta property="og:image" content="http://example.com/image-20201022162103501.png">
<meta property="og:image" content="http://example.com/image-20201023052252280.png">
<meta property="og:image" content="http://example.com/image-20201023052320519.png">
<meta property="og:image" content="http://example.com/image-20201023052748618.png">
<meta property="og:image" content="http://example.com/image-20201023072959266.png">
<meta property="og:image" content="http://example.com/image-20201023073041272.png">
<meta property="og:image" content="http://example.com/image-20201023080411308.png">
<meta property="og:image" content="http://example.com/image-20201023080500520.png">
<meta property="og:image" content="http://example.com/image-20201023081250886.png">
<meta property="og:image" content="http://example.com/image-20201024112115137.png">
<meta property="og:image" content="http://example.com/image-20201024113618961.png">
<meta property="og:image" content="http://example.com/image-20201024114238060.png">
<meta property="og:image" content="http://example.com/image-20201024114652266.png">
<meta property="og:image" content="http://example.com/image-20201024061157844.png">
<meta property="og:image" content="http://example.com/image-20201024061836312.png">
<meta property="og:image" content="http://example.com/image-20201024121842147.png">
<meta property="og:image" content="http://example.com/image-20201024122540156.png">
<meta property="og:image" content="http://example.com/image-20201024125311832.png">
<meta property="og:image" content="http://example.com/image-20201024131822802.png">
<meta property="og:image" content="http://example.com/image-20201024132207468.png">
<meta property="og:image" content="http://example.com/image-20201024140120849.png">
<meta property="og:image" content="http://example.com/image-20201024142800046.png">
<meta property="og:image" content="http://example.com/image-20201025095926893.png">
<meta property="og:image" content="http://example.com/image-20201025100138990.png">
<meta property="og:image" content="http://example.com/image-20201025100424345.png">
<meta property="article:published_time" content="2022-05-03T06:59:51.682Z">
<meta property="article:modified_time" content="2022-04-28T02:36:06.000Z">
<meta property="article:author" content="Jonebs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg">


<link rel="canonical" href="http://example.com/categories/mall">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":false,"lang":"zh-CN","comments":true,"permalink":"http://example.com/categories/mall.html","path":"categories/mall.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title> | GGB's Blog
</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">GGB's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">欢迎您！朋友</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E5%9F%BA%E7%A1%80%E7%AF%87"><span class="nav-number">1.</span> <span class="nav-text">谷粒商城基础篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">一、项目简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 项目背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E7%94%B5%E5%95%86%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 电商模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-1-B2B-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">1.2.1 B2B 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-2-B2C-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">1.2.2 B2C 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-3-C2B-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">1.2.3 C2B 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-4-C2C-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">1.2.4 C2C 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-5-O2O-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">1.2.5 O2O 模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 谷粒商城</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-number">1.1.4.</span> <span class="nav-text">1.4 项目架构图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E9%A1%B9%E7%9B%AE%E6%8A%80%E6%9C%AF-amp-%E7%89%B9%E8%89%B2"><span class="nav-number">1.1.5.</span> <span class="nav-text">1.5 项目技术&amp;特色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="nav-number">1.1.6.</span> <span class="nav-text">1.6 项目前置要求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">1.2.</span> <span class="nav-text">二、分布式基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 微服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E9%9B%86%E7%BE%A4-amp-%E5%88%86%E5%B8%83%E5%BC%8F-amp-%E8%8A%82%E7%82%B9"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 集群&amp;分布式&amp;节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 远程调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4 负载均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C-x2F-%E5%8F%91%E7%8E%B0-amp-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="nav-number">1.2.5.</span> <span class="nav-text">2.5 服务注册&#x2F;发现&amp;注册中心</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="nav-number">1.2.6.</span> <span class="nav-text">2.6 配置中心</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-7-%E6%9C%8D%E5%8A%A1%E7%86%94%E6%96%AD-amp-%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="nav-number">1.2.7.</span> <span class="nav-text">2.7 服务熔断&amp;服务降级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-8-API-%E7%BD%91%E5%85%B3"><span class="nav-number">1.2.8.</span> <span class="nav-text">2.8 API 网关</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.3.</span> <span class="nav-text">三、环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%89%E8%A3%85-linux%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 安装 linux虚拟机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%AE%89%E8%A3%85-docker"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 安装 docker</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-%E5%8D%B8%E8%BD%BD%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%89%8D%E5%AE%89%E8%A3%85%E7%9A%84-docker"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">3.2.1 卸载系统之前安装的 docker</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-docker-%E5%AE%89%E8%A3%85-mysql"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 docker 安装 mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">3.3.1 下载镜像文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">3.3.2 创建实例并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-3-%E9%80%9A%E8%BF%87%E5%AE%B9%E5%99%A8%E7%9A%84-mysql-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">3.3.3 通过容器的 mysql 命令行工具连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-docker-%E5%AE%89%E8%A3%85-redis"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 docker 安装 redis</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">3.4.1 下载镜像文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">3.4.2 创建实例并启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-3-%E4%BD%BF%E7%94%A8-redis-%E9%95%9C%E5%83%8F%E6%89%A7%E8%A1%8C-redis-cli-%E5%91%BD%E4%BB%A4%E8%BF%9E%E6%8E%A5"><span class="nav-number">1.3.4.3.</span> <span class="nav-text">3.4.3 使用 redis 镜像执行 redis-cli 命令连接</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%BB%9F%E4%B8%80"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.5 开发环境统一</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-1-Maven"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">3.5.1 Maven</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-2-idea-amp-VsCode"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">3.5.2 idea&amp;VsCode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-3-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-git"><span class="nav-number">1.3.5.3.</span> <span class="nav-text">3.5.3 安装配置 git</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-4-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E4%BD%BF%E7%94%A8"><span class="nav-number">1.3.5.4.</span> <span class="nav-text">3.5.4 逆向工程使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81MybatisPlus%E6%95%B4%E5%90%88"><span class="nav-number">1.4.</span> <span class="nav-text">四、MybatisPlus整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 配置环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1%E3%80%81%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">4.1.1、导入依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2%E3%80%81%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">4.2.2、配置数据源</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E9%A9%B1%E5%8A%A8"><span class="nav-number">1.4.1.2.1.</span> <span class="nav-text">导入数据库驱动</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8application-yml%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="nav-number">1.4.1.2.2.</span> <span class="nav-text">在application.yml配置数据源相关信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E5%88%86%E9%A1%B5%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 分页配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 逻辑删除</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E9%85%8D%E7%BD%AE-application-yml"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">步骤1：配置 application.yml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AD%A5%E9%AA%A42-%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AD%97%E6%AE%B5%E4%B8%8A%E5%8A%A0%E4%B8%8A-TableLogic%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">步骤2: 实体类字段上加上@TableLogic注解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81SpringCloud-Alibaba"><span class="nav-number">1.5.</span> <span class="nav-text">五、SpringCloud Alibaba</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-SpringCloud-Alibaba-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 SpringCloud Alibaba 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">5.1.1、简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">5.1.2、为什么要使用 ?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-SpringCloud-Alibaba-Nacos-%E4%BD%9C%E4%B8%BA%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 SpringCloud Alibaba - Nacos [作为注册中心]</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1%E3%80%81%E4%B8%8B%E8%BD%BD-nacos-server"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">5.2.1、下载 nacos-server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2%E3%80%81%E5%90%AF%E5%8A%A8-nacos-server"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">5.2.2、启动 nacos-server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3%E3%80%81%E6%B3%A8%E5%86%8C%E8%BF%9B%E5%85%A5-nacos-%E4%B8%AD"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">5.2.3、注册进入 nacos 中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nacos-%E4%BD%BF%E7%94%A8%E4%B8%89%E6%AD%A5"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">Nacos 使用三步</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-SpringCloud-Alibaba-Nacos-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3 SpringCloud Alibaba - Nacos [作为配置中心]</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1%E3%80%81pom-xml-%E5%BC%95%E5%85%A5-Nacos-Config-Starter"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">5.3.1、pom.xml 引入 Nacos Config Starter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-2%E3%80%81%E5%9C%A8%E5%BA%94%E7%94%A8%E7%9A%84-resource-%E4%B8%8B-bootstrap-properties"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">5.3.2、在应用的 resource 下 bootstrap.properties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-3%E3%80%81%E5%9C%A8-nacos-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">5.3.3、在 nacos 中添加配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-4%E3%80%81%E5%9C%A8%E5%BA%94%E7%94%A8%E4%B8%AD%E4%BD%BF%E7%94%A8-Value-%E5%92%8C-RefreshScope"><span class="nav-number">1.5.3.4.</span> <span class="nav-text">5.3.4、在应用中使用@Value 和 @RefreshScope</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-5%E3%80%81%E8%BF%9B%E9%98%B6"><span class="nav-number">1.5.3.5.</span> <span class="nav-text">5.3.5、进阶</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-SpringCloud-Alibaba-Sentinel"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.4 SpringCloud Alibaba-Sentinel</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">1、简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E9%99%90%E6%B5%81"><span class="nav-number">1.5.4.1.1.</span> <span class="nav-text">1、服务降级限流</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81Sentinel-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.5.4.1.2.</span> <span class="nav-text">2、Sentinel 简介</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81Hystrix-%E4%B8%8E-Sentinel-%E6%AF%94%E8%BE%83"><span class="nav-number">1.5.4.2.</span> <span class="nav-text">2、Hystrix 与 Sentinel 比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E6%95%B4%E5%90%88-Feign-%E5%92%8C-Sentinel-%E6%B5%8B%E8%AF%95%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7"><span class="nav-number">1.5.4.3.</span> <span class="nav-text">3、整合 Feign 和 Sentinel 测试熔断降级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E6%95%B4%E5%90%88-Sentinel-%E6%B5%8B%E8%AF%95%E9%99%90%E6%B5%81"><span class="nav-number">1.5.4.4.</span> <span class="nav-text">4、整合 Sentinel 测试限流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81Sentinel%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81"><span class="nav-number">1.5.4.5.</span> <span class="nav-text">5、Sentinel网关限流</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5-SpringCloud-Alibaba-Seata"><span class="nav-number">1.5.5.</span> <span class="nav-text">5.5 SpringCloud Alibaba-Seata</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B-1"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">1、简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">1.5.5.2.</span> <span class="nav-text">2、核心概念</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-SpringCloud-Alibaba-OSS"><span class="nav-number">1.5.6.</span> <span class="nav-text">5.6 SpringCloud Alibaba-OSS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-number">1.5.6.1.</span> <span class="nav-text">5.6.1、简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-2%E3%80%81%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.5.6.2.</span> <span class="nav-text">5.6.2、使用步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-3%E3%80%81-%E6%8A%BD%E5%8F%96%E6%88%90%E4%B8%80%E4%B8%AA%E5%8D%95%E7%8B%AC%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%EF%BC%9FOSS"><span class="nav-number">1.5.6.3.</span> <span class="nav-text">5.6.3、 抽取成一个单独的第三方服务？OSS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-4%E3%80%81Web%E7%AB%AF%E4%B8%8A%E4%BC%A0%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.5.6.4.</span> <span class="nav-text">5.6.4、Web端上传介绍</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E3%80%81SpringCloud"><span class="nav-number">1.6.</span> <span class="nav-text">六、SpringCloud</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-Feign-%E5%A3%B0%E6%98%8E%E5%BC%8F%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 Feign 声明式远程调用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">6.1.1、简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-2%E3%80%81%E4%BD%BF%E7%94%A8"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">6.1.2、使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-Gateway"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2 Gateway</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">6.2.1、简介</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-Sleuth-Zipkin-%E6%9C%8D%E5%8A%A1%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA"><span class="nav-number">1.6.3.</span> <span class="nav-text">6.3 Sleuth+Zipkin 服务链路追踪</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8"><span class="nav-number">1.6.3.1.</span> <span class="nav-text">1、为什么用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%9F%BA%E6%9C%AC%E6%9C%AF%E8%AF%AD"><span class="nav-number">1.6.3.2.</span> <span class="nav-text">2、基本术语</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E6%95%B4%E5%90%88-Sleuth"><span class="nav-number">1.6.3.3.</span> <span class="nav-text">3、整合 Sleuth</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E6%95%B4%E5%90%88-zipkin-%E5%8F%AF%E8%A7%86%E5%8C%96%E8%A7%82%E5%AF%9F"><span class="nav-number">1.6.3.4.</span> <span class="nav-text">4、整合 zipkin 可视化观察</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81Zipkin-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">1.6.3.5.</span> <span class="nav-text">5、Zipkin 数据持久化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-number">1.7.</span> <span class="nav-text">七、前端开发基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-VSCode-%E4%BD%BF%E7%94%A8"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.1 VSCode 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-ES6"><span class="nav-number">1.7.2.</span> <span class="nav-text">7.2 ES6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-Node-js"><span class="nav-number">1.7.3.</span> <span class="nav-text">7.3 Node.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-Vue"><span class="nav-number">1.7.4.</span> <span class="nav-text">7.4 Vue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-5-%E6%95%B4%E5%90%88-Element-UI"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">7.4.5 整合 Element UI</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-Babel"><span class="nav-number">1.7.5.</span> <span class="nav-text">7.5 Babel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-Webpack"><span class="nav-number">1.7.6.</span> <span class="nav-text">7.6 Webpack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="nav-number">1.8.</span> <span class="nav-text">八、商品服务&amp;三级分类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-number">1.8.1.</span> <span class="nav-text">8.1 基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-1%E3%80%81%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">8.1.1、三级分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-2%E3%80%81SPU-%E5%92%8C-SKU"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">8.1.2、SPU 和 SKU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-3%E3%80%81%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7-%E3%80%90%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E3%80%91%E4%B8%8E-%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">1.8.1.3.</span> <span class="nav-text">8.1.3、基本属性 【规格参数】与 销售属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-4%E3%80%81%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.8.1.4.</span> <span class="nav-text">8.1.4、接口文档位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-1-5%E3%80%81-Object-%E5%88%92%E5%88%86"><span class="nav-number">1.8.1.5.</span> <span class="nav-text">8.1.5、 Object 划分</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81PO-persistant-object-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.1.</span> <span class="nav-text">1、PO (persistant object) 持久化对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81DO-Domain-Object-%E9%A2%86%E5%9F%9F%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.2.</span> <span class="nav-text">2、DO ( Domain Object) 领域对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%E3%80%81TO-Transfer-Object-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.3.</span> <span class="nav-text">3、TO (Transfer Object) 数据传输对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4%E3%80%81DTO-Data-Transfer-Object-%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.4.</span> <span class="nav-text">4、DTO  (Data Transfer Object) 数据传输对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5%E3%80%81VO-value-object-%E5%80%BC%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.5.</span> <span class="nav-text">5、VO(value object) 值对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6%E3%80%81BO-business-object-%E4%B8%9A%E5%8A%A1%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.6.</span> <span class="nav-text">6、BO(business object) 业务对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#7%E3%80%81POJO-plain-ordinary-java-object-%E7%AE%80%E5%8D%95%E6%97%A0%E8%A7%84%E5%88%99-java-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.7.</span> <span class="nav-text">7、POJO ( plain ordinary java object) 简单无规则 java 对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8%E3%80%81DAO%EF%BC%88data-access-object%EF%BC%89-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.8.1.5.8.</span> <span class="nav-text">8、DAO（data access object） 数据访问对象</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99"><span class="nav-number">1.8.2.</span> <span class="nav-text">8.2 三级分类接口编写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-1-%E6%A0%91%E5%BD%A2%E5%B1%95%E7%A4%BA%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">8.2.1 树形展示三级分类数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4-amp-%E5%88%A0%E9%99%A4%E6%95%88%E6%9E%9C%E7%BB%86%E5%8C%96"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">8.2.2 逻辑删除&amp;删除效果细化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-%E6%96%B0%E5%A2%9E%E6%95%88%E6%9E%9C-amp-%E5%9F%BA%E6%9C%AC%E4%BF%AE%E6%94%B9"><span class="nav-number">1.8.2.3.</span> <span class="nav-text">8.2.3 新增效果&amp;基本修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD-amp-%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86-amp-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="nav-number">1.8.2.4.</span> <span class="nav-text">8.2.4 拖拽功能&amp;数据收集&amp;批量删除</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86"><span class="nav-number">1.9.</span> <span class="nav-text">九、商品服务&amp;品牌管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1%E3%80%81%E6%95%88%E6%9E%9C%E6%98%BE%E7%A4%BA%E4%BC%98%E5%8C%96%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%98%BE%E7%A4%BA%E5%BC%80%E5%85%B3"><span class="nav-number">1.9.1.</span> <span class="nav-text">9.1、效果显示优化与快速显示开关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2%E3%80%81%E8%A1%A8%E5%8D%95%E6%95%88%E9%AA%8C-amp-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%88%E9%AA%8C%E8%A7%84%E5%88%99"><span class="nav-number">1.9.2.</span> <span class="nav-text">9.2、表单效验&amp;自定义效验规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3%E3%80%81JSR303-%E6%95%B0%E6%8D%AE%E6%95%88%E9%AA%8C-amp-%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.9.3.</span> <span class="nav-text">9.3、JSR303 数据效验 &amp; 统一异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-1%E3%80%81%E7%BB%99Bean%E6%B7%BB%E5%8A%A0%E6%95%88%E9%AA%8C%E6%B3%A8%E8%A7%A3-javax-validation-constraints%E5%8C%85%E4%B8%8B-%E5%B9%B6%E5%AE%9A%E4%B9%89%E8%87%AA%E5%B7%B1%E7%9A%84%E7%9A%84message%E6%8F%90%E7%A4%BA"><span class="nav-number">1.9.3.1.</span> <span class="nav-text">9.3.1、给Bean添加效验注解  javax.validation.constraints包下 并定义自己的的message提示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-2%E3%80%81%E5%BC%80%E5%90%AF%E6%95%88%E9%AA%8C%E5%8A%9F%E8%83%BD-Valid"><span class="nav-number">1.9.3.2.</span> <span class="nav-text">9.3.2、开启效验功能 @Valid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-3%E3%80%81%E7%BB%99%E6%95%88%E9%AA%8C%E7%9A%84bean%E5%90%8E%E7%B4%A7%E8%B7%9F%E4%B8%80%E4%B8%AABindingResult-%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E6%95%88%E9%AA%8C%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="nav-number">1.9.3.3.</span> <span class="nav-text">9.3.3、给效验的bean后紧跟一个BindingResult 就可以获取到效验的结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-4%E3%80%81%E5%88%86%E7%BB%84%E6%95%88%E9%AA%8C-%E5%A4%9A%E5%9C%BA%E6%99%AF%E5%A4%8D%E6%9D%82%E6%95%88%E9%AA%8C"><span class="nav-number">1.9.3.4.</span> <span class="nav-text">9.3.4、分组效验 (多场景复杂效验)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-5%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%88%E9%AA%8C"><span class="nav-number">1.9.3.5.</span> <span class="nav-text">9.3.5、自定义效验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#9-3-6%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.9.3.6.</span> <span class="nav-text">9.3.6、异常处理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84"><span class="nav-number">1.10.</span> <span class="nav-text">十、商品服务&amp;属性分组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E3%80%81%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E6%8A%BD%E5%8F%96-amp-%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BA%A4%E4%BA%92"><span class="nav-number">1.10.1.</span> <span class="nav-text">10.1 、前端组件抽取 &amp; 父子组件交互</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-1-%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84-%E6%95%88%E6%9E%9C"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">10.1.1 属性分组 - 效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-2-Layout-%E5%B8%83%E5%B1%80"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">10.1.2 Layout 布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-1-3-%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="nav-number">1.10.1.3.</span> <span class="nav-text">10.1.3 父子组件如何进行交互</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E3%80%81%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E5%88%86%E7%B1%BB%E5%88%86%E7%BB%84"><span class="nav-number">1.10.2.</span> <span class="nav-text">10.2 、获取属性分类分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-%E3%80%81%E5%88%86%E7%B1%BB%E6%96%B0%E5%A2%9E-amp-%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">1.10.3.</span> <span class="nav-text">10.3 、分类新增 &amp; 级联选择器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-%E3%80%81%E5%88%86%E7%B1%BB%E4%BF%AE%E6%94%B9-amp-%E5%9B%9E%E6%98%BE%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">1.10.4.</span> <span class="nav-text">10.4 、分类修改 &amp; 回显级联选择器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-5%E3%80%81%E5%93%81%E7%89%8C%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E4%B8%8E%E7%BA%A7%E8%81%94%E6%9B%B4%E6%96%B0"><span class="nav-number">1.10.5.</span> <span class="nav-text">10.5、品牌分类关联与级联更新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-5-1%E3%80%81%E5%AE%9E%E7%8E%B0%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E6%90%9C%E7%B4%A2"><span class="nav-number">1.10.5.1.</span> <span class="nav-text">10.5.1、实现品牌管理搜索</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7"><span class="nav-number">1.11.</span> <span class="nav-text">十一、商品服务&amp;平台属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E6%96%B0%E5%A2%9E%E4%B8%8EVO"><span class="nav-number">1.11.1.</span> <span class="nav-text">11.1 规格参数新增与VO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#11-1-1-%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">11.1.1 获取分类规格参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8-amp-%E8%A7%84%E6%A0%BC%E4%BF%AE%E6%94%B9"><span class="nav-number">1.11.2.</span> <span class="nav-text">11.2 规格参数列表&amp;规格修改</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#11-2-1%E3%80%81%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0"><span class="nav-number">1.11.2.0.1.</span> <span class="nav-text">11.2.1、获取分类规格参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-2-2%E3%80%81%E6%9F%A5%E8%AF%A2%E5%B1%9E%E6%80%A7%E8%AF%A6%E6%83%85"><span class="nav-number">1.11.2.0.2.</span> <span class="nav-text">11.2.2、查询属性详情</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-3-3%E3%80%81%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">1.11.2.0.3.</span> <span class="nav-text">11.3.3、销售属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7-amp-%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94-amp-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7"><span class="nav-number">1.11.3.</span> <span class="nav-text">11.3 查询分类关联属性&amp;删除关联&amp;查询分组未关联属性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#11-3-1%E3%80%81%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E7%9A%84%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="nav-number">1.11.3.0.1.</span> <span class="nav-text">11.3.1、获取属性分组的关联的所有属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-3-2%E3%80%81%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7%E4%B8%8E%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="nav-number">1.11.3.0.2.</span> <span class="nav-text">11.3.2、删除属性与分组的关联关系</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-3-3%E3%80%81%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7"><span class="nav-number">1.11.3.0.3.</span> <span class="nav-text">11.3.3、查询分组未关联属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#11-4-4%E3%80%81%E6%96%B0%E5%A2%9E%E5%88%86%E7%BB%84%E4%B8%8E%E5%B1%9E%E6%80%A7%E5%85%B3%E8%81%94"><span class="nav-number">1.11.3.0.4.</span> <span class="nav-text">11.4.4、新增分组与属性关联</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81"><span class="nav-number">1.12.</span> <span class="nav-text">十二、商品服务&amp;新增商品</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E5%93%81%E7%89%8C"><span class="nav-number">1.12.1.</span> <span class="nav-text">12.1 获取分类关联的品牌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E4%B8%8B%E6%89%80%E6%9C%89%E5%88%86%E7%BB%84%E4%BB%A5%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="nav-number">1.12.2.</span> <span class="nav-text">12.2 获取分类下所有分组以及属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-3-%E5%95%86%E5%93%81-VO-%E6%8A%BD%E5%8F%96-amp-%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="nav-number">1.12.3.</span> <span class="nav-text">12.3 商品 VO 抽取&amp;商品新增业务流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-4-%E5%B0%81%E8%A3%85-Vo-%E4%B8%AD%EF%BC%8C%E6%9B%B4%E6%94%B9%E5%AF%B9%E5%BA%94%E5%BE%97%E5%B1%9E%E6%80%A7"><span class="nav-number">1.12.3.1.</span> <span class="nav-text">12.3.4 封装 Vo 中，更改对应得属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-5-%E5%88%86%E6%9E%90%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B"><span class="nav-number">1.12.3.2.</span> <span class="nav-text">12.3.5 分析业务流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-6-%E4%B8%BB%E8%A6%81%E7%BC%96%E7%A0%81%EF%BC%81"><span class="nav-number">1.12.3.3.</span> <span class="nav-text">12.3.6 主要编码！</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-7-%E6%80%BB%E7%BB%93"><span class="nav-number">1.12.3.4.</span> <span class="nav-text">12.3.7 总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-8-%E5%95%86%E5%93%81%E4%BF%9D%E5%AD%98%E5%90%8E-Debug-%E8%B0%83%E8%AF%95"><span class="nav-number">1.12.3.5.</span> <span class="nav-text">12.3.8 商品保存后 Debug 调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#12-3-9-%E5%95%86%E5%93%81%E4%BF%9D%E5%AD%98%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86"><span class="nav-number">1.12.3.6.</span> <span class="nav-text">12.3.9 商品保存其他问题处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1%E3%80%81-sku-images-%E8%A1%A8%E4%B8%AD-img-url-%E5%AD%97%E6%AE%B5%E4%B8%BA%E7%A9%BA"><span class="nav-number">1.12.3.6.1.</span> <span class="nav-text">1、   sku_images 表中 img_url 字段为空</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2%E3%80%81sku-%E6%BB%A1%E5%87%8F%E4%BB%A5%E5%8F%8A%E6%89%93%E6%8A%98%E4%BF%A1%E6%81%AF-%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF"><span class="nav-number">1.12.3.6.2.</span> <span class="nav-text">2、sku 满减以及打折信息 数据出现错误</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3%E3%80%81%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%85%B6%E4%BB%96%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="nav-number">1.12.3.6.3.</span> <span class="nav-text">3、程序中其他的异常</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E3%80%81-%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1-amp-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="nav-number">1.13.</span> <span class="nav-text">十三、 商品服务&amp;商品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#13-1-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86-SPU-%E6%A3%80%E7%B4%A2"><span class="nav-number">1.13.0.1.</span> <span class="nav-text">13.1 商品管理 SPU 检索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#13-1-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86-SkU-%E6%A3%80%E7%B4%A2"><span class="nav-number">1.13.0.2.</span> <span class="nav-text">13.1 商品管理 SkU 检索</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E4%BB%93%E5%82%A8%E6%9C%8D%E5%8A%A1-amp-%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="nav-number">1.14.</span> <span class="nav-text">十四、仓储服务&amp;仓库管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-1-%E6%95%B4%E5%90%88ware%E6%9C%8D%E5%8A%A1-amp-%E8%8E%B7%E5%8F%96%E4%BB%93%E5%BA%93%E5%88%97%E8%A1%A8"><span class="nav-number">1.14.1.</span> <span class="nav-text">14.1 整合ware服务&amp;获取仓库列表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14-1-1%E6%95%B4%E5%90%88-ware-%E6%9C%8D%E5%8A%A1"><span class="nav-number">1.14.1.1.</span> <span class="nav-text">14.1.1整合 ware 服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-1-2-%E8%8E%B7%E5%8F%96%E4%BB%93%E5%BA%93%E5%88%97%E8%A1%A8"><span class="nav-number">1.14.1.2.</span> <span class="nav-text">14.1.2 获取仓库列表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98-amp-%E5%88%9B%E5%BB%BA%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82"><span class="nav-number">1.14.2.</span> <span class="nav-text">14.2 查询库存&amp;创建采购需求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14-2-1-%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98"><span class="nav-number">1.14.2.1.</span> <span class="nav-text">14.2.1 查询库存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-2-2-%E5%88%9B%E5%BB%BA%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82"><span class="nav-number">1.14.2.2.</span> <span class="nav-text">14.2.2 创建采购需求</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-%E5%90%88%E5%B9%B6%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82-amp-%E9%A2%86%E5%8F%96%E9%87%87%E8%B4%AD%E5%8D%95-amp-%E5%AE%8C%E6%88%90%E9%87%87%E8%B4%AD-amp-Spu%E8%A7%84%E6%A0%BC%E7%BB%B4%E6%8A%A4"><span class="nav-number">1.14.3.</span> <span class="nav-text">14.3 合并采购需求&amp;领取采购单&amp;完成采购&amp;Spu规格维护</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-1-%E5%90%88%E5%B9%B6%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82"><span class="nav-number">1.14.3.1.</span> <span class="nav-text">14.3.1 合并采购需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-2-%E9%A2%86%E5%8F%96%E9%87%87%E8%B4%AD%E5%8D%95"><span class="nav-number">1.14.3.2.</span> <span class="nav-text">14.3.2 领取采购单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-3-%E5%AE%8C%E6%88%90%E9%87%87%E8%B4%AD"><span class="nav-number">1.14.3.3.</span> <span class="nav-text">14.3.3 完成采购</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-4-Spu%E8%A7%84%E6%A0%BC%E7%BB%B4%E6%8A%A4"><span class="nav-number">1.14.3.4.</span> <span class="nav-text">14.3.4 Spu规格维护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#14-3-5-Spu%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C"><span class="nav-number">1.14.3.5.</span> <span class="nav-text">14.3.5 Spu更新操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E7%AF%87%E6%80%BB%E7%BB%93"><span class="nav-number">1.15.</span> <span class="nav-text">分布式基础篇总结</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Jonebs"
      src="https://ggb01.oss-cn-beijing.aliyuncs.com/100511711.jpg">
  <p class="site-author-name" itemprop="name">Jonebs</p>
  <div class="site-description" itemprop="description">GGB</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/jonebs" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;jonebs" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.baidu.com/" title="https:&#x2F;&#x2F;www.baidu.com" rel="noopener" target="_blank">myblog</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner page posts-expand">


    
    
    
    <div class="post-block" lang="zh-CN"><header class="post-header">

<h1 class="post-title" itemprop="name headline">
</h1>

<div class="post-meta-container">
</div>

</header>

      
      
      <div class="post-body">
          <h1 id="谷粒商城基础篇"><a href="#谷粒商城基础篇" class="headerlink" title="谷粒商城基础篇"></a>谷粒商城基础篇</h1><h2 id="一、项目简介"><a href="#一、项目简介" class="headerlink" title="一、项目简介"></a>一、项目简介</h2><h3 id="1-1-项目背景"><a href="#1-1-项目背景" class="headerlink" title="1.1 项目背景"></a>1.1 项目背景</h3><h3 id="1-2-电商模式"><a href="#1-2-电商模式" class="headerlink" title="1.2 电商模式"></a>1.2 电商模式</h3><p>市面上有 5 种常见的电商模式 B2B、B2B、C2B、C2C、O2O</p>
<h4 id="1-2-1-B2B-模式"><a href="#1-2-1-B2B-模式" class="headerlink" title="1.2.1 B2B 模式"></a>1.2.1 B2B 模式</h4><p>B2B(Business to Business)，是指商家和商家建立的商业关系，如 阿里巴巴，</p>
<h4 id="1-2-2-B2C-模式"><a href="#1-2-2-B2C-模式" class="headerlink" title="1.2.2 B2C 模式"></a>1.2.2 B2C 模式</h4><p>B2C(Business to Consumer) 就是我们经常看到的供应商直接把商品买个用户，即 “商对客” 模式，也就是我们呢说的商业零售，直接面向消费销售产品和服务，如苏宁易购，京东，天猫，小米商城</p>
<h4 id="1-2-3-C2B-模式"><a href="#1-2-3-C2B-模式" class="headerlink" title="1.2.3 C2B 模式"></a>1.2.3 C2B 模式</h4><p>C2B (Customer to Business),即消费者对企业，先有消费者需求产生而后有企业生产，即先有消费者提出需求，后又生产企业按需求组织生产</p>
<h4 id="1-2-4-C2C-模式"><a href="#1-2-4-C2C-模式" class="headerlink" title="1.2.4 C2C 模式"></a>1.2.4 C2C 模式</h4><p> C2C (Customer to Consumer) 客户之间吧自己的东西放到网上去卖 如 淘宝 咸鱼</p>
<h4 id="1-2-5-O2O-模式"><a href="#1-2-5-O2O-模式" class="headerlink" title="1.2.5 O2O 模式"></a>1.2.5 O2O 模式</h4><p>O 2 O 即 Online To Offline，也即将线下商务的机会与互联网结合在一起，让互联网成为线下交易前台，线上快速支付，线下优质服务，如：饿了吗，美团，淘票票，京东到家</p>
<h3 id="1-3-谷粒商城"><a href="#1-3-谷粒商城" class="headerlink" title="1.3 谷粒商城"></a>1.3 谷粒商城</h3><p>谷粒商城是一个 B2C 模式的电商平台，销售自营商品给客户</p>
<h3 id="1-4-项目架构图"><a href="#1-4-项目架构图" class="headerlink" title="1.4 项目架构图"></a>1.4 项目架构图</h3><p>1、项目微服务架构图</p>
<p><img src="/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg"></p>
<p>2、微服务划分图</p>
<p><img src="/image-20201015112852613.png" alt="image-20201015112852613"></p>
<h3 id="1-5-项目技术-amp-特色"><a href="#1-5-项目技术-amp-特色" class="headerlink" title="1.5 项目技术&amp;特色"></a>1.5 项目技术&amp;特色</h3><ul>
<li>前后分离开发，并开发基于 vue 的 后台管理系统</li>
<li>SpringCloud 全新的解决方案</li>
<li>应用监控、限流、网关、熔断降级、等分布式方案，全方位涉及</li>
<li>透彻讲解分布式事务，分布式锁等分布式系统的难点</li>
<li>压力测试与性能优化</li>
<li>各种集群技术的区别以及使用</li>
<li>CI&#x2F;CD 使用</li>
</ul>
<h3 id="1-6-项目前置要求"><a href="#1-6-项目前置要求" class="headerlink" title="1.6 项目前置要求"></a>1.6 项目前置要求</h3><p>学习项目的前置知识</p>
<ul>
<li>熟悉 SpringBoot 以及常见整合方案</li>
<li>了解 SpringCloud</li>
<li>熟悉 git maven</li>
<li>熟悉 linux、redis docker 基本操作</li>
<li>了解 html，css，js，vue</li>
<li>熟练使用 idea 开发项目</li>
</ul>
<h2 id="二、分布式基础概念"><a href="#二、分布式基础概念" class="headerlink" title="二、分布式基础概念"></a>二、分布式基础概念</h2><h3 id="2-1-微服务"><a href="#2-1-微服务" class="headerlink" title="2.1 微服务"></a>2.1 微服务</h3><p>微服务架构风格，就像是把一个单独的应用程序开发成一套小服务，每个小服务运行在自己的进程中，并使用轻量级机制<strong>通信</strong>，通常是 HTTP API 这些服务围绕业务能力来构建，	并通过完全自动化部署机制来独立部署，这些服务使用不同的编程语言书写，以及不同数据存储技术，并保持最低限度的集中式管理</p>
<p><strong>简而言之，拒绝大型单体应用，基于业务边界进行服务拆分，每个服务独立部署运行。</strong></p>
<p><img src="/image-20201015101317095.png" alt="image-20201015101317095"></p>
<h3 id="2-2-集群-amp-分布式-amp-节点"><a href="#2-2-集群-amp-分布式-amp-节点" class="headerlink" title="2.2 集群&amp;分布式&amp;节点"></a>2.2 集群&amp;分布式&amp;节点</h3><p>集群是个物理状态，分布式是个工作方式</p>
<p>只要是一堆机器，也可以叫做集群，他不是不是一起协作干活，这谁也不知道，</p>
<p>《分布式系统原理与范型》定义：</p>
<p>“分布式系统是若干独立计算机的集合，这些计算机对于用户来说像但各相关系统”</p>
<p>分布式系统 (distributed system) 是建立网络之上的软件系统</p>
<p>分布式是指讲不通的业务分布在不同的地方</p>
<p>集群实质是将几台服务器集中在一起，实现同一业务</p>
<p>例如：京东是一个分布式系统，众多业务运行在不同的机器上，所有业务构成一个大型的业务集群，每一个小的业务，比如用户系统，访问压力大的时候一台服务器是不够的，我们就应该将用户系统部署到多个服务器，也就是每个一业务系统也可以做集群化</p>
<p>分布式中的每一个节点，都可以做集群，而集群并不一定就是分布式的</p>
<p>节点：集群中的一个服务器</p>
<h3 id="2-3-远程调用"><a href="#2-3-远程调用" class="headerlink" title="2.3 远程调用"></a>2.3 远程调用</h3><p>在分布式系统中，各个服务可能处于不同主机，但是服务之间不可避免的需要互相调用，我们称之为远程调用</p>
<p>SpringCloud 中使用 HTTP+JSON 的方式来完成远程调用</p>
<p><img src="/image-20201015103427667.png" alt="image-20201015103427667"></p>
<h3 id="2-4-负载均衡"><a href="#2-4-负载均衡" class="headerlink" title="2.4 负载均衡"></a>2.4 负载均衡</h3><p><img src="/image-20201015103547907.png" alt="image-20201015103547907"></p>
<p>分布式系统中，A  服务需要调用 B 服务，B 服务在多台机器中都存在， A 调用任意一个服务器均可完成功能</p>
<p>为了使每一个服务器都不要太或者太闲，我们可以负载均衡调用每一个服务器，提升网站的健壮性</p>
<p>常见的负载均衡算法：</p>
<blockquote>
<p>轮询：为第一个请求选择键康齿中的每一个后端服务器，然后按顺序往后依次选择，直到最后一个，然后循环</p>
</blockquote>
<blockquote>
<p>最小连接：优先选择链接数最少，也就是压力最小的后端服务器，在会话较长的情况下可以考虑采取这种方式</p>
</blockquote>
<h3 id="2-5-服务注册-x2F-发现-amp-注册中心"><a href="#2-5-服务注册-x2F-发现-amp-注册中心" class="headerlink" title="2.5 服务注册&#x2F;发现&amp;注册中心"></a>2.5 服务注册&#x2F;发现&amp;注册中心</h3><p>A 服务调用 B 服务， A 服务不知道 B 服务当前在哪几台服务器上有，那些正常的，哪些服务已经下线，解决这个问题可以引入注册中心</p>
<p><img src="/image-20201015104330935.png" alt="image-20201015104330935"></p>
<p>如果某些服务下线，我们其他人可以实时的感知到其他服务的状态，从而避免调用不可用的服务</p>
<h3 id="2-6-配置中心"><a href="#2-6-配置中心" class="headerlink" title="2.6 配置中心"></a>2.6 配置中心</h3><p><img src="/image-20201015104450711.png" alt="image-20201015104450711"></p>
<p>每一个服务最终都有大量配置，并且每个服务都可能部署在多个服务器上，我们经常需要变更配置，我们可以让每个服务在配置中心获取自己的位置。</p>
<p>配置中心用来集中管理微服务的配置信息</p>
<h3 id="2-7-服务熔断-amp-服务降级"><a href="#2-7-服务熔断-amp-服务降级" class="headerlink" title="2.7 服务熔断&amp;服务降级"></a>2.7 服务熔断&amp;服务降级</h3><p>在微服务架构中，微服务之间通过网络来进行通信，存在相互依赖，当其中一个服务不可用时，有可能会造成雪崩效应，要防止这种情况，必须要有容错机制来保护服务</p>
<p><img src="/image-20201015105256207.png" alt="image-20201015105256207"></p>
<p>1、服务熔断</p>
<ul>
<li>设置服务的超时，当被调用的服务经常失败到达某个阈值，我们可以开启断路保护机制，后来的请求不再去调用这个服务，本地直接返回默认的数据</li>
</ul>
<p>2、服务降级</p>
<ul>
<li>在运维期间，当系统处于高峰期，系统资源紧张，我们可以让非核心业务降级运行，降级：某些服务部处理，或者简单处理【抛异常，返回NULL，调用 Mock数据，调用 FallBack 处理逻辑】</li>
</ul>
<h3 id="2-8-API-网关"><a href="#2-8-API-网关" class="headerlink" title="2.8 API 网关"></a>2.8 API 网关</h3><p>在微服务架构中，API Gateway 作为整体架构的重要组件，他 抽象类服务中需要的公共功能，同时它提供了客户端<strong>负载均衡</strong>，<strong>服务自动熔断</strong>，<strong>灰度发布</strong>，<strong>统一认证</strong>，<strong>限流监控</strong>，<strong>日志统计</strong>等丰富功能，帮助我们解决很多 API 管理的难题</p>
<p><img src="/image-20201015110148578.png" alt="image-20201015110148578"></p>
<h2 id="三、环境搭建"><a href="#三、环境搭建" class="headerlink" title="三、环境搭建"></a>三、环境搭建</h2><h3 id="3-1-安装-linux虚拟机"><a href="#3-1-安装-linux虚拟机" class="headerlink" title="3.1 安装 linux虚拟机"></a>3.1 安装 linux虚拟机</h3><p>下载&amp;安装 VirtualBox <a target="_blank" rel="noopener" href="https://www.virtualbox.org/">https://www.virtualbox.org/</a>  要开启 CPU 虚拟化</p>
<p><img src="/image-20201015125006196.png" alt="image-20201015125006196"></p>
<p><img src="/image-20201015125024611.png" alt="image-20201015125024611"></p>
<p>CPU 查看</p>
<p><img src="/image-20201015125053510.png" alt="image-20201015125053510"></p>
<p>下载&amp; 安装 Vagrant </p>
<p><a target="_blank" rel="noopener" href="https://app.vagrantup.com/boxes/search">https://app.vagrantup.com/boxes/search</a> Vagrant 官方镜像仓库</p>
<p><a target="_blank" rel="noopener" href="https://www.vagrantup.com/downloads.html">https://www.vagrantup.com/downloads.html</a> Vagrant下载</p>
<p>打开window cmd窗口，运行Vagrant init centos&#x2F;7 ,即可初始化一个centos系统</p>
<p>运行vagrant up即可启动虚拟机。系统root用户的密码是vagrant</p>
<p>vagrant其他常用命令</p>
<p>vagrant ssh 自动使用 vagrant 用户连接虚拟机</p>
<p>vagrant upload source [destination] [name|id] 上传文件</p>
<p><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/cli/init.html">https://www.vagrantup.com/docs/cli/init.html</a> Vagrant 命令行</p>
<p>默认虚拟机的ip 地址不是固定ip 开发不方便</p>
<p><strong>Vagrant 和 VirtualBox 版本有对应问题  都安装最新版本 则安装成功</strong></p>
<p>修改 Vagrantfile</p>
<p>  config.vm.network “private_network”, ip: “192.168.56.10”</p>
<p>这里 ip 需要在 物理机下使用 ipconfig 命令找到</p>
<p><img src="/image-20201015141629387.png" alt="image-20201015141629387"></p>
<h3 id="3-2-安装-docker"><a href="#3-2-安装-docker" class="headerlink" title="3.2 安装 docker"></a>3.2 安装 docker</h3><p>Docker 安装文档参考官网</p>
<h4 id="3-2-1-卸载系统之前安装的-docker"><a href="#3-2-1-卸载系统之前安装的-docker" class="headerlink" title="3.2.1 卸载系统之前安装的 docker"></a>3.2.1 卸载系统之前安装的 docker</h4><p>Uninstall old versions</p>
<p>一步一步往下执行就行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<p>SET UP THE REPOSITORY</p>
<p>Install the <code>yum-utils</code> package (which provides the <code>yum-config-manager</code> utility) and set up the <strong>stable</strong> repository.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>INSTALL DOCKER ENGINE</p>
<ol>
<li>Install the <em>latest version</em> of Docker Engine and containerd, or go to the next step to install a specific version:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<p>Start Docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure>

<p>Verify that Docker Engine is installed correctly by running the <code>hello-world</code> image.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>

<p>设置docker开机自启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker </span><br></pre></td></tr></table></figure>

<p>设置 Docker 镜像加速</p>
<p>登录 aliyun.com 在控制台找到容器镜像服务</p>
<p><img src="/image-20201015144524435.png" alt="image-20201015144524435"></p>
<h3 id="3-3-docker-安装-mysql"><a href="#3-3-docker-安装-mysql" class="headerlink" title="3.3 docker 安装 mysql"></a>3.3 docker 安装 mysql</h3><h4 id="3-3-1-下载镜像文件"><a href="#3-3-1-下载镜像文件" class="headerlink" title="3.3.1 下载镜像文件"></a>3.3.1 下载镜像文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-创建实例并启动"><a href="#3-3-2-创建实例并启动" class="headerlink" title="3.3.2 创建实例并启动"></a>3.3.2 创建实例并启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --name指定容器名字 -v目录挂载 -p指定端口映射  -e设置mysql参数 -d后台运行</span></span><br><span class="line">sudo docker run -p 3306:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7</span><br><span class="line"><span class="comment">####</span></span><br><span class="line">-v 将对应文件挂载到主机</span><br><span class="line">-e 初始化对应</span><br><span class="line">-p 容器端口映射到主机的端口</span><br></pre></td></tr></table></figure>

<p>MySQL 配置</p>
<p>vi &#x2F;mydata&#x2F;mysql&#x2F;conf&#x2F;my.cnf 创建&amp;修改该文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect=<span class="string">&#x27;SET collation_connection = utf8_unicode_ci&#x27;</span></span><br><span class="line">init_connect=<span class="string">&#x27;SET NAMES utf8&#x27;</span></span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>



<h4 id="3-3-3-通过容器的-mysql-命令行工具连接"><a href="#3-3-3-通过容器的-mysql-命令行工具连接" class="headerlink" title="3.3.3 通过容器的 mysql 命令行工具连接"></a>3.3.3 通过容器的 mysql 命令行工具连接</h4><p><img src="/image-20201015151247976.png" alt="image-20201015151247976"></p>
<h3 id="3-4-docker-安装-redis"><a href="#3-4-docker-安装-redis" class="headerlink" title="3.4 docker 安装 redis"></a>3.4 docker 安装 redis</h3><h4 id="3-4-1-下载镜像文件"><a href="#3-4-1-下载镜像文件" class="headerlink" title="3.4.1 下载镜像文件"></a>3.4.1 下载镜像文件</h4><p>docker pull redis</p>
<h4 id="3-4-2-创建实例并启动"><a href="#3-4-2-创建实例并启动" class="headerlink" title="3.4.2 创建实例并启动"></a>3.4.2 创建实例并启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/conf</span><br><span class="line"><span class="built_in">touch</span> /mydata/redis/conf/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 同时 映射到对应文件夹</span></span><br><span class="line"><span class="comment"># 后面 \ 代表换行</span></span><br><span class="line">docker run -p 6379:6379 --name redis \</span><br><span class="line">-v /mydata/redis/data:/data \</span><br><span class="line">-v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d redis redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-使用-redis-镜像执行-redis-cli-命令连接"><a href="#3-4-3-使用-redis-镜像执行-redis-cli-命令连接" class="headerlink" title="3.4.3 使用 redis 镜像执行 redis-cli 命令连接"></a>3.4.3 使用 redis 镜像执行 redis-cli 命令连接</h4><p>docker exec -it redis redis-cli</p>
<p>持久化 默认 appendonly on 没有开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /mydata/redis/conf/redis.conf</span><br><span class="line"><span class="comment"># 插入下面内容</span></span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>



<h3 id="3-5-开发环境统一"><a href="#3-5-开发环境统一" class="headerlink" title="3.5 开发环境统一"></a>3.5 开发环境统一</h3><h4 id="3-5-1-Maven"><a href="#3-5-1-Maven" class="headerlink" title="3.5.1 Maven"></a>3.5.1 Maven</h4><p>配置阿里云镜像</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>配置 jdk 1.8 编译项目</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-idea-amp-VsCode"><a href="#3-5-2-idea-amp-VsCode" class="headerlink" title="3.5.2 idea&amp;VsCode"></a>3.5.2 idea&amp;VsCode</h4><blockquote>
<p>idea 安装 lombok、mybatisx插件 Translation插件 等等..</p>
<p>Vscode 安装开发必备插件</p>
<p>Vetur ——语法高亮，智能感知 包含格式化功能，Alt+Shift+F (格式化全文) ，Ctrl+K Ctrl+F (格式化选中代码，两个Ctrl需要同时按着)<br>EsLint 一一 语法纠错<br>Auto Close Tag 一一 自动闭合HTML&#x2F;XML标签<br>Auto Rename Tag 一一 自动完成另-侧标签的同步修改<br>JavaScript(ES6) code snippets 一一 ES6 语法智能提示以及快速输入，除j外还支持.ts, .jsx， .tsx， .html, .vue;省去了配置其支持各种包含is代码文件的时间</p>
</blockquote>
<p>VsCode开发vue 常用插件</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yujing1314/article/details/90340647">https://blog.csdn.net/yujing1314/article/details/90340647</a></p>
<h4 id="3-5-3-安装配置-git"><a href="#3-5-3-安装配置-git" class="headerlink" title="3.5.3 安装配置 git"></a>3.5.3 安装配置 git</h4><p>1、下载git</p>
<p><a target="_blank" rel="noopener" href="https://git-scm.com/">https://git-scm.com/</a></p>
<p>2、配置git 进入 git bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置用户名</span></span><br><span class="line">git config --global user.name <span class="string">&quot;user.name&quot;</span></span><br><span class="line"><span class="comment"># 配置邮箱</span></span><br><span class="line">git config --global user.email <span class="string">&quot;username@email.com&quot;</span> <span class="comment"># 注册账号使用的邮箱</span></span><br></pre></td></tr></table></figure>

<p>3、配置 ssh 免密登录</p>
<p><a target="_blank" rel="noopener" href="https://github.com/settings/keys">https://github.com/settings/keys</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git bash 使用 ssh-keygen -t rsa -C <span class="string">&quot;XXX@xxx.com&quot;</span> 命令 连续三次回车</span><br><span class="line">一般用户目录下都会有</span><br><span class="line">id_rsa 文件</span><br><span class="line">id_rsa.pub 文件</span><br><span class="line">或者 <span class="built_in">cat</span> ~/.ssh/id_rsa.pub</span><br><span class="line">登录进 github/gitee 设置 SSH KEY</span><br><span class="line">使用 ssh -T git@gitee.com 测试是否成功</span><br><span class="line">具体过程参考百度</span><br></pre></td></tr></table></figure>



<h4 id="3-5-4-逆向工程使用"><a href="#3-5-4-逆向工程使用" class="headerlink" title="3.5.4 逆向工程使用"></a>3.5.4 逆向工程使用</h4><p>1、导入项目逆向工程</p>
<p>2、下载人人开源后台管理系统脚手架工程</p>
<ol>
<li>导入工程，创建数据库</li>
<li>修改工程shiro依赖为SpringSecurity</li>
<li>删除部分暂时不需要的业务</li>
</ol>
<p>3、下载人人开源后台管理系统vue端脚手架工程</p>
<ol>
<li>vscode 导入前端项目</li>
<li>前后端联调测试基本功能</li>
</ol>
<h2 id="四、MybatisPlus整合"><a href="#四、MybatisPlus整合" class="headerlink" title="四、MybatisPlus整合"></a>四、MybatisPlus整合</h2><h3 id="4-1-配置环境"><a href="#4-1-配置环境" class="headerlink" title="4.1 配置环境"></a>4.1 配置环境</h3><h4 id="4-1-1、导入依赖"><a href="#4-1-1、导入依赖" class="headerlink" title="4.1.1、导入依赖"></a>4.1.1、导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-2、配置数据源"><a href="#4-2-2、配置数据源" class="headerlink" title="4.2.2、配置数据源"></a>4.2.2、配置数据源</h4><p>配置数据源</p>
<ol>
<li><h5 id="导入数据库驱动"><a href="#导入数据库驱动" class="headerlink" title="导入数据库驱动"></a>导入数据库驱动</h5><p><a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/mysql/mysql-connector-java">https://mvnrepository.com/artifact/mysql/mysql-connector-java</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入mysql驱动--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><h5 id="在application-yml配置数据源相关信息"><a href="#在application-yml配置数据源相关信息" class="headerlink" title="在application.yml配置数据源相关信息"></a>在application.yml配置数据源相关信息</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.56.10:3306/gulimall_pms</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="comment"># mapper文件扫描</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># 数据库主键自增</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>配置MyBatis-Plus包扫描：</p>
<ol>
<li><p>使用@MapperScanner</p>
</li>
<li><p>告诉MyBatis-Plus,Sql映射文件位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.product.dao&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallProductApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GulimallProductApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>具体过程参考官网： <a target="_blank" rel="noopener" href="https://baomidou.com/guide/install.html#release">https://baomidou.com/guide/install.html#release</a></p>
<h3 id="4-2-分页配置"><a href="#4-2-分页配置" class="headerlink" title="4.2 分页配置"></a>4.2 分页配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 声明配置类</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">// 开启注解</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.product.dao&quot;)</span> <span class="comment">// 指定扫描包</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引入分页插件 拦截器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PaginationInterceptor</span> <span class="variable">paginationInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">        <span class="comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span></span><br><span class="line">         paginationInterceptor.setOverflow(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">         paginationInterceptor.setLimit(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">// 开启 count 的 join 优化,只针对部分 left join</span></span><br><span class="line">        paginationInterceptor.setCountSqlParser(<span class="keyword">new</span> <span class="title class_">JsqlParserCountOptimize</span>(<span class="literal">true</span>));</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-逻辑删除"><a href="#4-3-逻辑删除" class="headerlink" title="4.3 逻辑删除"></a>4.3 逻辑删除</h3><p>说明:</p>
<p>只对自动注入的sql起效:</p>
<ul>
<li>插入: 不作限制</li>
<li>查找: 追加where条件过滤掉已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>更新: 追加where条件防止更新到已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>删除: 转变为 更新</li>
</ul>
<p>例如:</p>
<ul>
<li>删除: <code>update user set deleted=1 where id = 1 and deleted=0</code></li>
<li>查找: <code>select id,name,deleted from user where deleted=0</code></li>
</ul>
<h4 id="步骤1：配置-application-yml"><a href="#步骤1：配置-application-yml" class="headerlink" title="步骤1：配置 application.yml"></a>步骤1：配置 application.yml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># 数据库主键自增</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>

<h4 id="步骤2-实体类字段上加上-TableLogic注解"><a href="#步骤2-实体类字段上加上-TableLogic注解" class="headerlink" title="步骤2: 实体类字段上加上@TableLogic注解"></a>步骤2: 实体类字段上加上<code>@TableLogic</code>注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否显示[0-不显示，1显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableLogic(value = &quot;1&quot;,delval = &quot;0&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure>

<h2 id="五、SpringCloud-Alibaba"><a href="#五、SpringCloud-Alibaba" class="headerlink" title="五、SpringCloud Alibaba"></a>五、SpringCloud Alibaba</h2><h3 id="5-1-SpringCloud-Alibaba-简介"><a href="#5-1-SpringCloud-Alibaba-简介" class="headerlink" title="5.1 SpringCloud Alibaba 简介"></a>5.1 SpringCloud Alibaba 简介</h3><h4 id="5-1-1、简介"><a href="#5-1-1、简介" class="headerlink" title="5.1.1、简介"></a>5.1.1、简介</h4><p>Spring Cloud Alibaba 致力于提供微服务开发的一站式解决方案。此项目包含开发分布式应用微服务的必需组件，方便开发者通过 Spring Cloud 编程模型轻松使用这些组件来开发分布式应用服务。</p>
<p>依托 Spring Cloud Alibaba，您只需要添加一些注解和少量配置，就可以将 Spring Cloud 应用接入阿里微服务解决方案，通过阿里中间件来迅速搭建分布式应用系统。</p>
<h4 id="5-1-2、为什么要使用"><a href="#5-1-2、为什么要使用" class="headerlink" title="5.1.2、为什么要使用 ?"></a>5.1.2、为什么要使用 ?</h4><p><img src="/image-20201016131742532.png" alt="image-20201016131742532"></p>
<p><img src="/image-20201016131803836.png" alt="image-20201016131803836"></p>
<p><strong>SpringClouid的几大痛点：</strong></p>
<p>SpringCloud部分组件停止维护和更新，给开发带来不便;</p>
<p>SpringCloud部分环境搭建复杂，没有完善的可视化界面，我们需要大量的二次开发和定制</p>
<p>SpringCloud配置复杂，难以上手，部分配置差别难以区分和合理应用</p>
<p><strong>SpringCloud Alibaba的优势：</strong></p>
<p>阿里使用过的组件经历了考验，性能强悍，设计合理，现在开源出来大家用</p>
<p>成套的产品搭配完善的可视化界面给开发运维带来极大的便利</p>
<p>搭建简单，学习曲线低。</p>
<p><strong>结合SpringCloud Alibaba我们最终的技术搭配方案：</strong></p>
<p>SpringCloud Alibaba - Nacos : 注册中心 (服务发现&#x2F;注册)</p>
<p>SpringCloud Alibaba- Nacos: 配置中心 (动态配置管理)</p>
<p>SpringCloud - Ribbon: 负载均衡</p>
<p>SpringCloud - Feign: 声明式HTTP客户端(调用远程服务)</p>
<p>SpringCloud Alibaba - Sentinel: 服务容错(限流、降级、熔断)</p>
<p>SpringCloud - Gateway:  API 网关 (webflux 编程模式)</p>
<p>SpringCloud - Sleuth:调用链监控</p>
<p>SpringCloud Alibaba - Seata: 原Fescar, 即分布式事务解决方案</p>
<h3 id="5-2-SpringCloud-Alibaba-Nacos-作为注册中心"><a href="#5-2-SpringCloud-Alibaba-Nacos-作为注册中心" class="headerlink" title="5.2 SpringCloud Alibaba - Nacos [作为注册中心]"></a>5.2 SpringCloud Alibaba - Nacos [作为注册中心]</h3><p>Nacos 是阿里巴巴开源的一个更易于构建云原生应用的动态服务发现，配置管理和服务管理平台，他是使用 java 编写的，需要依赖 java 环境</p>
<p>Nacos 文档地址： <a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/quick-start.html">https://nacos.io/zh-cn/docs/quick-start.html</a></p>
<h4 id="5-2-1、下载-nacos-server"><a href="#5-2-1、下载-nacos-server" class="headerlink" title="5.2.1、下载 nacos-server"></a>5.2.1、下载 nacos-server</h4><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases">https://github.com/alibaba/nacos/releases</a></p>
<h4 id="5-2-2、启动-nacos-server"><a href="#5-2-2、启动-nacos-server" class="headerlink" title="5.2.2、启动 nacos-server"></a>5.2.2、启动 nacos-server</h4><ul>
<li>cmd 运行startup.cmd 文件</li>
<li>访问localhost:8848&#x2F;nacos&#x2F;</li>
<li>使用默认的 nacos&#x2F;nacos 登录</li>
</ul>
<p><img src="/image-20201016153720815.png" alt="image-20201016153720815"></p>
<h4 id="5-2-3、注册进入-nacos-中"><a href="#5-2-3、注册进入-nacos-中" class="headerlink" title="5.2.3、注册进入 nacos 中"></a>5.2.3、注册进入 nacos 中</h4><p>1、首先，修改 pom.xml 文件，引入  Nacos Discovery Starter</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、在应用的 &#x2F;resource &#x2F;application.properties 中配置 Nacos Server地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848</span><br></pre></td></tr></table></figure>

<p>3、使用@EnableDiscoveryClient 开启服务注册发现功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(ProviderApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、启动应用、观察 nacos 服务列表是否已经注册上服务</p>
<p>注意每一个应用都应该有名字，这样才能往册上去。修改pplicaion.propertes文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>= <span class="string">service provider</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br></pre></td></tr></table></figure>

<p>5、注册更多的服务上去，测试使用 feign 远程</p>
<h4 id="Nacos-使用三步"><a href="#Nacos-使用三步" class="headerlink" title="Nacos 使用三步"></a>Nacos 使用三步</h4><p>1、导包</p>
<p>2、写配置，指定 nacos 地址，指定应用的名字</p>
<p>3、开启服务注册发现功能 @EnableDiscoveryClient</p>
<p>Feign 使用三步</p>
<p>1、导包 openfeign</p>
<p>2、开启 @EnableFeignClients 功能</p>
<p>3、编写接口，进行远程调用</p>
<h3 id="5-3-SpringCloud-Alibaba-Nacos-作为配置中心"><a href="#5-3-SpringCloud-Alibaba-Nacos-作为配置中心" class="headerlink" title="5.3 SpringCloud Alibaba - Nacos [作为配置中心]"></a>5.3 SpringCloud Alibaba - Nacos [作为配置中心]</h3><h4 id="5-3-1、pom-xml-引入-Nacos-Config-Starter"><a href="#5-3-1、pom-xml-引入-Nacos-Config-Starter" class="headerlink" title="5.3.1、pom.xml 引入 Nacos Config Starter"></a>5.3.1、pom.xml 引入 Nacos Config Starter</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--配置中心来做配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-2、在应用的-resource-下-bootstrap-properties"><a href="#5-3-2、在应用的-resource-下-bootstrap-properties" class="headerlink" title="5.3.2、在应用的 resource 下 bootstrap.properties"></a>5.3.2、在应用的 resource 下 bootstrap.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">gulimall-coupon</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-3、在-nacos-中添加配置"><a href="#5-3-3、在-nacos-中添加配置" class="headerlink" title="5.3.3、在 nacos 中添加配置"></a>5.3.3、在 nacos 中添加配置</h4><p>选择右上角添加配置</p>
<p><img src="/image-20201016174432942.png" alt="image-20201016174432942"></p>
<p>Data ID 改成 gulimall-coupon.properties 默认规则 用户名.应用名.properties</p>
<p><img src="/image-20201016174334134.png" alt="image-20201016174334134"></p>
<h4 id="5-3-4、在应用中使用-Value-和-RefreshScope"><a href="#5-3-4、在应用中使用-Value-和-RefreshScope" class="headerlink" title="5.3.4、在应用中使用@Value 和 @RefreshScope"></a>5.3.4、在应用中使用@Value 和 @RefreshScope</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">// 刷新对应controller</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;coupon/coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CouponService couponService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;coupon.user.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;coupon.user.age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;name&quot;</span>,name).put(<span class="string">&quot;age&quot;</span>,age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-3-5、进阶"><a href="#5-3-5、进阶" class="headerlink" title="5.3.5、进阶"></a>5.3.5、进阶</h4><blockquote>
<p>1、核心概念</p>
</blockquote>
<p><strong>命名空间:</strong><br>用于进行租户粒度的配置隔离。不同的命名空间下，可以存在相同的 <strong>Group</strong> 或 <strong>DatalD</strong> 的配置。<strong>Namespace</strong>  的常用场景之一是不同环境的配置的区分隔离，例如开发测试环境和生产环境的资源(如配置、服务)隔离等。</p>
<p><strong>配置集</strong></p>
<p><strong>一组相关或者不相关的配置项的集合称为配置集</strong>。在系统中，一个配置文件通常就是一个配置集，包含了系统各个方面的配置。例如，一个配置集可能包含了数据源、线程池、日志级别等配置项。</p>
<p><strong>配置集ID:</strong></p>
<p>Nacos 中的某个配置集的 ID，配置集 ID 是组织划分配置的维度之一，<strong>Data ID</strong> 通常用于组织划分系统的配置集，一个系统或者应用可以包含多个配置集，一个系统应用可以包含多个配置集，每个配置集都可以被一个有意义的名称标识，Data ID 通常采用类 Java 包 如 ( com.taobao.tc.refund.log.level ) 的命名规则保证全局唯一性，此命名规则非强制</p>
<p><strong>配置分组：</strong></p>
<p>Nacos 中的一组配置集，是组织配置的维度之一，通过一个有意义的字符串，(如 Buy 或 Trade ) 对配置集进行分组，从而区分 Data ID 相同的配置集，当您在 Nacos 上创建一个配置时，如果未填写配置分组的名称，则配置分组的名称默认采用，DEFAULT_GROUP 配置分组的常见场景，不同的应用或组件采用了相同的配置类型，如 database_url 配置和 MQ_topic 配置</p>
<p><strong>bootstrap.properties 配置</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">gulimall-coupon # 服务的名称</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">127.0.0.1:8848  # 服务注册地址</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">ae34901c-9215-4409-ae61-c6b8d6c8f9b0  # 命名空间地址</span></span><br><span class="line"><span class="comment">#spring.cloud.nacos.config.group=111 # 对应分组</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].data-id</span>=<span class="string">datasource.yml  # 配置集指定data_id</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].group</span>=<span class="string">dev               # 配置集指定 group 分组</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.ext-config[0].refresh</span>=<span class="string">true            # 是否动态刷新 在配置中心修改后 微服务自动刷新</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>相关解释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1、如何使用 Nacos作为配置中心统一管理配置</span></span><br><span class="line"><span class="comment"> *  1.1 引入依赖</span></span><br><span class="line"><span class="comment"> *     &lt;dependency&gt;</span></span><br><span class="line"><span class="comment"> *             &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment"> *             &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment"> *      &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"> *  1.2 创建一个bootstrap.properties</span></span><br><span class="line"><span class="comment"> *      spring.application.name=gulimall-coupon</span></span><br><span class="line"><span class="comment"> *      spring.cloud.nacos.config.server-addr=127.0.0.1:8848</span></span><br><span class="line"><span class="comment"> *  1.3 需要给配置中心默认添加一个叫 数据集 (Data Id) gulimall-coupon.properties 默认规则 用户名.应用名.properties</span></span><br><span class="line"><span class="comment"> *  1.4 给 应用名.properties 添加任何配置</span></span><br><span class="line"><span class="comment"> *  1.5 动态获取配置</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@RefreshScope</span>: 动态获取并刷新配置</span></span><br><span class="line"><span class="comment"> *      <span class="doctag">@Value</span>$(&quot;$&#123;配置项的名字&#125;&quot;)</span></span><br><span class="line"><span class="comment"> * 如果配置中心和当前应用的配置文件中都配置了相同的配置文件，优先使用配置中心的文件</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2、细节</span></span><br><span class="line"><span class="comment"> *      1、命名空间：配置隔离：</span></span><br><span class="line"><span class="comment"> *          默认：public(保留空间)；默认新增的所有配置都在 public 空间</span></span><br><span class="line"><span class="comment"> *          1、开发 测试 生产 利用命名空间来做环境隔离</span></span><br><span class="line"><span class="comment"> *          注意: 在bootstrap.properties配置上 需要使用哪个命名空间下的配置</span></span><br><span class="line"><span class="comment"> *              spring.cloud.nacos.config.namespace=b1e89ce0-784f-4a80-9de0-e9b080eeaca5</span></span><br><span class="line"><span class="comment"> *          2、每一个微服务之间互相隔离配置，每一个微服务都创建自己的命名空间，只加载自己命名空间下的所有配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      2、配置集：所有配置的集合</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      3、配置集ID：类似文件名</span></span><br><span class="line"><span class="comment"> *          Data ID：类型文件名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      4、配置分组：</span></span><br><span class="line"><span class="comment"> *      默认所有的配置都属于 DEFAULT_GROUP</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 每个微服务创建自己的命名空间，使用配置分组区分环境，dev、test、prod</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3、同时加载多个配置集</span></span><br><span class="line"><span class="comment"> *      1、微服务任何配置信息，任何配置文件多可以放在配置中心中</span></span><br><span class="line"><span class="comment"> *      2、只要在 bootstrap.properties 说明加载配置中心中哪些配置文件即可</span></span><br><span class="line"><span class="comment"> *      3、<span class="doctag">@Value</span>，<span class="doctag">@ConfigurationProperties</span>...</span></span><br><span class="line"><span class="comment"> *      以前SpringBoot的任何方式从配置文件中获取值，都能使用</span></span><br><span class="line"><span class="comment"> *      配置中心有的优先使用配置中心的</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gcq</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Create</span> 2020-10-16</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h3 id="5-4-SpringCloud-Alibaba-Sentinel"><a href="#5-4-SpringCloud-Alibaba-Sentinel" class="headerlink" title="5.4 SpringCloud Alibaba-Sentinel"></a>5.4 SpringCloud Alibaba-Sentinel</h3><h4 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h4><h5 id="1、服务降级限流"><a href="#1、服务降级限流" class="headerlink" title="1、服务降级限流"></a>1、服务降级限流</h5><p><strong>什么是熔断：</strong></p>
<p>​	A 服务调用 B 服务的某个功能，由于网络不稳定问题，或者 B 服务卡机，导致功能时间超长，如果这样子的次数太多，我们可以直接将 B 断路了，（A 不在请求  B 接口）凡是调用 B 服务的直接返回降级数据，不必等待 B 的 超时执行，这样 B 的故障问题，就不会级联影响到 A。</p>
<p><strong>什么是降级：</strong></p>
<p>​	整个网站处于流量高峰期服务器压力剧增，根据当前自身业务情况以及流量，对一些服务和页面进行有策略的降级&#x2F;停止服务，所有的调用直接返回降级数据以此缓解服务器资源的压力，以保证核心业务的正常运行，同时也保持了客户和大部分客户等到正确的响应</p>
<p>异同：</p>
<p>​	相同点</p>
<p>​		1、为了保证集群大部分服务的可用性和可靠性，防止崩溃，牺牲小我	</p>
<p>​		2、用户最终都是体验到某个功能不可用</p>
<p>​	不同点：</p>
<p>​		1、熔断是被调用方的故障，触发系统的主动规则</p>
<p>​		2、降级是基于全局的考虑停止一些正常服务，释放资源</p>
<p>什么是限流</p>
<p>​	对打入的服务的请求流量进行控制，使服务能够承担不超过自己能力的流量压力</p>
<h5 id="2、Sentinel-简介"><a href="#2、Sentinel-简介" class="headerlink" title="2、Sentinel 简介"></a>2、Sentinel 简介</h5><p>官方文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></p>
<p>项目文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel">https://github.com/alibaba/Sentinel</a></p>
<p>随着微服务的流行，服务和服务之间的稳定性变得越来越重要。Sentinel 以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度保护服务的稳定性。</p>
<p><strong>Sentinel 具有以下特征:</strong></p>
<ul>
<li><strong>丰富的应用场景</strong>：Sentinel 承接了阿里巴巴近 10 年的双十一大促流量的核心场景，例如秒杀（即突发流量控制在系统容量可以承受的范围）、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。</li>
<li><strong>完备的实时监控</strong>：Sentinel 同时提供实时的监控功能。您可以在控制台中看到接入应用的单台机器秒级数据，甚至 500 台以下规模的集群的汇总运行情况。</li>
<li><strong>广泛的开源生态</strong>：Sentinel 提供开箱即用的与其它开源框架&#x2F;库的整合模块，例如与 Spring Cloud、Dubbo、gRPC 的整合。您只需要引入相应的依赖并进行简单的配置即可快速地接入 Sentinel。</li>
<li><strong>完善的 SPI 扩展点</strong>：Sentinel 提供简单易用、完善的 SPI 扩展接口。您可以通过实现扩展接口来快速地定制逻辑。例如定制规则管理、适配动态数据源等。</li>
</ul>
<p>Sentinel 的主要特性：</p>
<p><img src="/image-20201125115407751.png" alt="image-20201125115407751"></p>
<p><strong>Sentinel 分为两个部分:</strong></p>
<ul>
<li>核心库（Java 客户端）不依赖任何框架&#x2F;库，能够运行于所有 Java 运行时环境，同时对 Dubbo &#x2F; Spring Cloud 等框架也有较好的支持。</li>
<li>控制台（Dashboard）基于 Spring Boot 开发，打包后可以直接运行，不需要额外的 Tomcat 等应用容器。</li>
</ul>
<p><strong>Sentinel 基本概念:</strong></p>
<ul>
<li>资源<ul>
<li>资源是 Sentinel 的关键概念。它可以是 Java 应用程序中的任何内容，例如，由应用程序提供的服务，或由应用程序调用的其它应用提供的服务，甚至可以是一段代码。在接下来的文档中，我们都会用资源来描述代码块。</li>
<li><strong>只要通过 Sentinel API 定义的代码，就是资源，能够被 Sentinel 保护起来</strong>。大部分情况下，可以使用方法签名，URL，甚至服务名称作为资源名来标示资源。</li>
</ul>
</li>
<li>规则<ul>
<li>围绕资源的实时状态设定的规则，可以包括<strong>流量控制规则、熔断降级规则以及系统保护规则。所有规则可以动态实时调整。</strong></li>
</ul>
</li>
</ul>
<h4 id="2、Hystrix-与-Sentinel-比较"><a href="#2、Hystrix-与-Sentinel-比较" class="headerlink" title="2、Hystrix 与 Sentinel 比较"></a>2、Hystrix 与 Sentinel 比较</h4><p><img src="/image-20201125120634969.png" alt="image-20201125120634969"></p>
<h4 id="3、整合-Feign-和-Sentinel-测试熔断降级"><a href="#3、整合-Feign-和-Sentinel-测试熔断降级" class="headerlink" title="3、整合 Feign 和 Sentinel 测试熔断降级"></a>3、整合 Feign 和 Sentinel 测试熔断降级</h4><p>熔断降级官网解释：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7</a></p>
<p>Spring-  Cloud整合Sentinel和Feign：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</a></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 导入sentinel依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--导入openFeign --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.properties </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## sentinel与项目间的通信端口</span></span><br><span class="line"><span class="attr">spring.cloud.sentinel.transport.port</span>=<span class="string">8719</span></span><br><span class="line"><span class="comment">## sentinel端口设置</span></span><br><span class="line"><span class="attr">spring.cloud.sentinel.transport.dashboard</span>=<span class="string">localhost:8333</span></span><br><span class="line"><span class="comment">## 暴露信息</span></span><br><span class="line"><span class="attr">management.endpoints.web.exposure.exclude</span>=<span class="string">*</span></span><br><span class="line"><span class="comment">## 配置文件打开 Sentinel 对 Feign 的支持</span></span><br><span class="line"><span class="attr">feign.sentinel.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<p>开启后，在微服务中调用远程服务，Sentinel 就会记录微服务之间的调用，从而对远程调用进行设置熔断降级等。</p>
<p>请求设置</p>
<p><img src="/image-20201126154714221.png" alt="image-20201126154714221"></p>
<p>设置流控规则</p>
<p><img src="/image-20201126165501709.png" alt="image-20201126165501709"></p>
<p>Feign设置</p>
<p><img src="/image-20201126165336761.png" alt="image-20201126165336761"></p>
<p>结果</p>
<p><img src="/image-20201126164858768.png" alt="image-20201126164858768"></p>
<h4 id="4、整合-Sentinel-测试限流"><a href="#4、整合-Sentinel-测试限流" class="headerlink" title="4、整合 Sentinel 测试限流"></a>4、整合 Sentinel 测试限流</h4><p>官网Spring-Cloud 整合：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</a></p>
<p>Pom.xml</p>
<blockquote>
<p>参考 3、整合 Feign 和 Sentinel 测试熔断降级</p>
</blockquote>
<p>控制台：</p>
<p><img src="/image-20201126161848389.png"></p>
<p>超过单继阈值，返回自定义请求结果</p>
<p>实现方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  		1、代码</span></span><br><span class="line"><span class="comment"> *      	try (Entry entry = SphU.entry(&quot;resourceName&quot;)) &#123;</span></span><br><span class="line"><span class="comment"> *      	&#125;(BlockedException e)&#123;&#125;</span></span><br><span class="line"><span class="comment"> *      2、基于注解</span></span><br><span class="line"><span class="comment"> *       	<span class="doctag">@SentinelResource</span>(value = &quot;getCurrentSeckillSkusSource&quot;,blockHandler = &quot;BlockHandler&quot;)</span></span><br><span class="line"><span class="comment"> *       	无论1/2方式一定要配置限流以后的默认返回</span></span><br><span class="line"><span class="comment"> *       	url可以设置统一返回</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure>

<p>具体实现方式参考官网给出文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8</a></p>
<h4 id="5、Sentinel网关限流"><a href="#5、Sentinel网关限流" class="headerlink" title="5、Sentinel网关限流"></a>5、Sentinel网关限流</h4><p>官网文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81">https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81</a></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-sentinel-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>启动Sentinle1.7.1 后比原先的1.6.1多个一个功能</p>
<p><img src="/image-20201127102052864.png" alt="image-20201127102052864"></p>
<p>您可以在 <code>GatewayCallbackManager</code> 注册回调进行定制：</p>
<ul>
<li><code>setBlockHandler</code>：注册函数用于实现自定义的逻辑处理被限流的请求，对应接口为 <code>BlockRequestHandler</code>。默认实现为 <code>DefaultBlockRequestHandler</code>，当被限流时会返回类似于下面的错误信息：<code>Blocked by Sentinel: FlowException</code>。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SentinelGatewayConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SentinelGatewayConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        GatewayCallbackManager.setBlockHandler(<span class="keyword">new</span> <span class="title class_">BlockRequestHandler</span>() &#123;</span><br><span class="line">            <span class="comment">// 网关限流了 就会回调</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">handleRequest</span><span class="params">(ServerWebExchange serverWebExchange, Throwable throwable)</span> &#123;</span><br><span class="line">                <span class="type">R</span> <span class="variable">error</span> <span class="operator">=</span> R.error(BizCodeEnume.TO_MANY_REQUEST.getCode(), BizCodeEnume.TO_MANY_REQUEST.getMsg());</span><br><span class="line">                <span class="type">String</span> <span class="variable">errorJson</span> <span class="operator">=</span> JSON.toJSONString(error);</span><br><span class="line">                Mono&lt;ServerResponse&gt; body = ServerResponse.ok().body(Mono.just(errorJson), String.class);</span><br><span class="line">                <span class="keyword">return</span> body;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-5-SpringCloud-Alibaba-Seata"><a href="#5-5-SpringCloud-Alibaba-Seata" class="headerlink" title="5.5 SpringCloud Alibaba-Seata"></a>5.5 SpringCloud Alibaba-Seata</h3><h4 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h4><p>Seata 是一款开源的分布式事务解决方案，致力于提供高性能和简单易用的分布式事务服务。Seata 将为用户提供了 AT、TCC、SAGA 和 XA 事务模式，为用户打造一站式的分布式解决方案。</p>
<p><a target="_blank" rel="noopener" href="https://seata.io/zh-cn/index.html">https://seata.io/zh-cn/index.html</a></p>
<h4 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h4><p><strong>TC (Transaction Coordinator) - 事务协调者</strong></p>
<p>维护全局和分支事务的状态，驱动全局事务提交或回滚。</p>
<p><strong>TM (Transaction Manager) - 事务管理器</strong></p>
<p>定义全局事务的范围：开始全局事务、提交或回滚全局事务。</p>
<p><strong>RM (Resource Manager) - 资源管理器</strong></p>
<p>管理分支事务处理的资源，与TC交谈以注册分支事务和报告分支事务的状态，并驱动分支事务提交或回滚。</p>
<h3 id="5-6-SpringCloud-Alibaba-OSS"><a href="#5-6-SpringCloud-Alibaba-OSS" class="headerlink" title="5.6 SpringCloud Alibaba-OSS"></a>5.6 SpringCloud Alibaba-OSS</h3><h4 id="5-6-1、简介"><a href="#5-6-1、简介" class="headerlink" title="5.6.1、简介"></a>5.6.1、简介</h4><p>对象存储服务 阿里云对象存储服务（Object Storage Service，简称 OSS），是阿里云提供的海量、安全、低成本、高可靠的云存储服务。您可以在任何应用、任何时间、任何地点存储和访问任意类型的数据。</p>
<p><img src="/image-20201019202316446.png" alt="image-20201019202316446"></p>
<h4 id="5-6-2、使用步骤"><a href="#5-6-2、使用步骤" class="headerlink" title="5.6.2、使用步骤"></a>5.6.2、使用步骤</h4><p>使用 Java 上传文件</p>
<p><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.915.56196d39rr96Ll">https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.915.56196d39rr96Ll</a></p>
<p>来自官网实例 - 上传文件流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpload</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">      <span class="comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> <span class="string">&quot;http://oss-cn-hangzhou.aliyuncs.com&quot;</span>;</span><br><span class="line">          <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 //https://ram.console.aliyun.com 创建。</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> <span class="string">&quot;&lt;yourAccessKeyId&gt;&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> <span class="string">&quot;&lt;yourAccessKeySecret&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">      <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 上传文件流。</span></span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;&lt;yourlocalFile&gt;&quot;</span>);</span><br><span class="line">      ossClient.putObject(<span class="string">&quot;&lt;yourBucketName&gt;&quot;</span>, <span class="string">&quot;&lt;yourObjectName&gt;&quot;</span>, inputStream);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">      ossClient.shutdown();</span><br><span class="line">      System.out.println(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>需要填写 AccesskeyId 以及 Secret 同时也要指定文件位置 以及文件名字</p>
<p>最终上传结果</p>
<p><img src="/image-20201019202933756.png" alt="image-20201019202933756"></p>
<h4 id="5-6-3、-抽取成一个单独的第三方服务？OSS"><a href="#5-6-3、-抽取成一个单独的第三方服务？OSS" class="headerlink" title="5.6.3、 抽取成一个单独的第三方服务？OSS"></a>5.6.3、 抽取成一个单独的第三方服务？OSS</h4><p>官网文档</p>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md">https://github.com/alibaba/aliyun-spring-boot/blob/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample/README-zh.md</a></p>
<p>新建项目 gulimall-third-party</p>
<p>pom 配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- springCloudAlibaba --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.yml 配置 <strong>accessKey、secretKey、endpoint</strong> </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">    <span class="attr">alicloud:</span></span><br><span class="line">      <span class="attr">access-key:</span> <span class="string">LTAI4GE22ckocpNBfd36zkxJ</span> </span><br><span class="line">      <span class="attr">secret-key:</span> <span class="string">qDFrQ6cxZqc4DwxoWx5K2aosXXj0Go</span></span><br><span class="line">      <span class="attr">oss:</span></span><br><span class="line">        <span class="attr">endpoint:</span> <span class="string">oss-cn-shenzhen.aliyuncs.com</span>  <span class="comment">## 地域节点</span></span><br><span class="line">        <span class="attr">bucket:</span> <span class="string">gulimall-oss01</span> <span class="comment"># 桶列表</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gulimall-third-party</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">30000</span></span><br></pre></td></tr></table></figure>



<h4 id="5-6-4、Web端上传介绍"><a href="#5-6-4、Web端上传介绍" class="headerlink" title="5.6.4、Web端上传介绍"></a>5.6.4、Web端上传介绍</h4><blockquote>
<p>阿里云对象存储-普通上传方式：</p>
</blockquote>
<p><img src="/image-20201019203642525.png" alt="image-20201019203642525"></p>
<p>用户提交文件到服务器，服务器将文件提交到 OSS 对象存储</p>
<p>和数据直传到OSS相比，以上方法有三个缺点：</p>
<ul>
<li>上传慢：用户数据需先上传到应用服务器，之后再上传到OSS。网络传输时间比直传到OSS多一倍。如果用户数据不通过应用服务器中转，而是直传到OSS，速度将大大提升。而且OSS采用BGP带宽，能保证各地各运营商之间的传输速度。</li>
<li>扩展性差：如果后续用户多了，应用服务器会成为瓶颈。</li>
<li>费用高：需要准备多台应用服务器。由于OSS上传流量是免费的，如果数据直传到OSS，不通过应用服务器，那么将能省下几台应用服务器。</li>
</ul>
<blockquote>
<p>阿里云对象存储-服务端签名后直传：</p>
</blockquote>
<p><img src="/image-20201019203744740.png" alt="image-20201019203744740"></p>
<p>流程介绍</p>
<p><img src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3156348951/p139016.png" alt="时序图"></p>
<p><strong>背景</strong></p>
<p>采用JavaScript客户端直接签名（参见<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31925.html?spm=a2c4g.11186623.2.11.26386e28XWAM19#concept-frd-4gy-5db">JavaScript客户端签名直传</a>）时，AccessKey ID和AcessKey Secret会暴露在前端页面，因此存在严重的安全隐患。因此，OSS提供了服务端签名后直传的方案。</p>
<p>Web端向服务端请求签名，然后直接上传，不会对服务端产生压力，而且安全可靠。服务端签后直传</p>
<h2 id="六、SpringCloud"><a href="#六、SpringCloud" class="headerlink" title="六、SpringCloud"></a>六、SpringCloud</h2><h3 id="6-1-Feign-声明式远程调用"><a href="#6-1-Feign-声明式远程调用" class="headerlink" title="6.1 Feign 声明式远程调用"></a>6.1 Feign 声明式远程调用</h3><h4 id="6-1-1、简介"><a href="#6-1-1、简介" class="headerlink" title="6.1.1、简介"></a>6.1.1、简介</h4><p>Feign 是一个声明式的 HTTP 客户端，他的目的就是让远程调用更加简单，Feign提供了 HTTP请求的模板，<strong>通过编写简单的接口和插入注解</strong>，就可以定义好的 HTTP 请求参数、格式、地址等信息</p>
<p>Feign 整合了 <strong>Ribbon（负载均衡</strong>）和 <strong>Hystrix（服务熔断</strong>），可以让我们不再需要显示地使用这两个组件</p>
<p>SpringCloud - Feign，在 NetflixFeign 的基础上扩展了对 SpringMVC 注解的支持，在其实现下，我们只需创建一个接口并用注解的方式来配置它，即可完成对服务提供方的接口绑定。简化了 SpringCloud - Ribbon 自行封装服务调用客户端的开发量。</p>
<h4 id="6-1-2、使用"><a href="#6-1-2、使用" class="headerlink" title="6.1.2、使用"></a>6.1.2、使用</h4><p>1、引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、开启 feign 功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.atguigu.gulimall.pms.feign&quot;)</span> <span class="comment">// 指定feign包位置</span></span><br></pre></td></tr></table></figure>

<p>3、声明远程接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;gulimall-ware&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WareFeignService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/ware/waresku/skus&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Resp&lt;List&lt;SkuStockVO&gt;&gt; <span class="title function_">skuWareInfos</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; skuIds)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1、想要远程调用别的服务</span></span><br><span class="line"><span class="comment"> *  1.1 引入open-feing</span></span><br><span class="line"><span class="comment"> *  1.2 编写一个接口，告诉SpringCloud这个接口需要调用的远程服务</span></span><br><span class="line"><span class="comment"> *      1.2.1 生命接口的每一个方法都是调用远程服务的那个请求</span></span><br><span class="line"><span class="comment"> *  1.3 开启远程调用功能</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h3 id="6-2-Gateway"><a href="#6-2-Gateway" class="headerlink" title="6.2 Gateway"></a>6.2 Gateway</h3><h4 id="6-2-1、简介"><a href="#6-2-1、简介" class="headerlink" title="6.2.1、简介"></a>6.2.1、简介</h4><p>网关作为流浪入口，常用功能包括路由转发，权限效验，限流控制等，而 SpringCloud GateWay作为 SpringCloud 官方推出的第二代网关框架，取代了 Zull 网关</p>
<p>网上测试 三种网关对应请求数</p>
<p><img src="/image-20201016222628121.png" alt="image-20201016222628121"></p>
<p>网关提供 API 全托管服务，丰富的 API 管理功能，辅助企业管理大规模的 API，以降低管理成本和安全风险、包括协议适配、协议转发、安全策略、防刷、流量、监控日志等功能</p>
<p>Spring Cloud GateWay 旨在提供一种简单有效的方式来对 API 进行路由，并为他们提供切面，列如、安全性、监控&#x2F;指标 和弹性等</p>
<p>官网文档地址</p>
<h3 id="6-3-Sleuth-Zipkin-服务链路追踪"><a href="#6-3-Sleuth-Zipkin-服务链路追踪" class="headerlink" title="6.3 Sleuth+Zipkin 服务链路追踪"></a>6.3 Sleuth+Zipkin 服务链路追踪</h3><h4 id="1、为什么用"><a href="#1、为什么用" class="headerlink" title="1、为什么用"></a>1、为什么用</h4><p>微服务架构是一个分布式架构，它按业务划分服务单元，一个分布式系统往往有很多个服务单元。由于服务单元数量众多，业务的复杂性，如果出现了错误和异常，很难去定位。主要体现在，一个请求可能需要调用很多个服务，而内部服务的调用复杂性，决定了问题难以定位。所以微服务架构中，必须实现分布式链路追踪，去跟进一个请 求到底有哪些服务参与，参与的顺序又是怎样的，从而达到每个请求的步骤清晰可见，出了问题，很快定位。</p>
<p>链路追踪组件有Google 的Dapper, Twitter 的Zipkin,以及阿里的Eagleeye(鹰眼)等，它们都是非常优秀的链路追踪开源组件。</p>
<h4 id="2、基本术语"><a href="#2、基本术语" class="headerlink" title="2、基本术语"></a>2、基本术语</h4><ul>
<li>Span (跨度) :基本工作单元，发送一个远程调度任务就会产生一个Span, Span 是一个64位ID唯一标识的，Trace 是用另一个64ID唯一标识的，Span 还有其他数据信息，比如摘要、时间戳事件、Span的ID、 以及进度ID。</li>
<li>Trace (跟踪) :一系列Span组成的一个树状结构。请求一个微服务系统的API接口，这个API接口，需要调用多个微服务，调每个微服务都会产生一个新的Span,所有由这个请求产生的Span组成了这个Trace</li>
<li>Annotation (标注) :用来及时记录一个事件的，一些核心注解用来定义一个请求的开始和结束。这些注解包括以下:<ul>
<li>cs- Client Sent客户端发送一 个请求，这个注解描述了这个Span的开始</li>
<li>sr- Server Received -服务端获得请求并准备开始处理它，如果将其sr诚去cs时间戳便可得到网络传输的时间。</li>
<li>ss- Server Sent(服务端 发送响应) -该注解表明请求处理的完成(当请求返回客户端)，如果ss的时间戳诚去sr时间戳，就可以得到服务器请求的时间。</li>
<li>cr- Client Received (客 户端接收响应)此时Span的结束，如果cr的时间戳诚去cs时间戳便可以得到整个请求所消耗的时间。</li>
</ul>
</li>
</ul>
<p>官方文档：</p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-sleuth/docs/2.2.5.RELEASE/reference/html/">https://docs.spring.io/spring-cloud-sleuth/docs/2.2.5.RELEASE/reference/html/</a></p>
<p>如果调用顺序是这样的</p>
<h4 id="3、整合-Sleuth"><a href="#3、整合-Sleuth" class="headerlink" title="3、整合 Sleuth"></a>3、整合 Sleuth</h4><p>1、服务提供者与消费者导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、打开 debug 日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>3、发起一次远程调用，观察控制台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="4、整合-zipkin-可视化观察"><a href="#4、整合-zipkin-可视化观察" class="headerlink" title="4、整合 zipkin 可视化观察"></a>4、整合 zipkin 可视化观察</h4><p>通过 Sleuth 产生的调用链监控信息，可以得知微服务之间的调用链路，但监控信息只输出到控制台不方便查看，我们需要一个图形化的工具 -Zipkin ，Zipkin 是 Twitter 开源的分布式跟踪系统，主要用来收集系统的时序数据，从而追踪链路的调用问题，zipkin 官网地址如下：</p>
<p><a target="_blank" rel="noopener" href="https://zipkin.io/">https://zipkin.io/</a></p>
<p><img src="/image-20201127111241744.png" alt="image-20201127111241744"></p>
<p>1、docker 安装 zipkin服务器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9411:9411 openzipkin/zipkin</span><br></pre></td></tr></table></figure>

<p>2、pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、application.yml</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zipkin查询服务器实例的URL</span></span><br><span class="line"><span class="attr">spring.zipkin.base-url</span>=<span class="string">http://192.168.56.10:9411/</span></span><br><span class="line"><span class="comment"># 不查询自己</span></span><br><span class="line"><span class="attr">spring.zipkin.discovery-client-enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 发送类型</span></span><br><span class="line"><span class="attr">spring.zipkin.sender.type</span>=<span class="string">web</span></span><br><span class="line"><span class="comment"># 应用采样的请求概率</span></span><br><span class="line"><span class="attr">spring.sleuth.sampler.probability</span>=<span class="string">1</span></span><br></pre></td></tr></table></figure>



<h4 id="5、Zipkin-数据持久化"><a href="#5、Zipkin-数据持久化" class="headerlink" title="5、Zipkin 数据持久化"></a>5、Zipkin 数据持久化</h4><p>Zipkin默认是将监控数据存储在内存的，如果Zipkin挂掉或重启的话，那么监控数据就会丢失。所以如果想要搭建生产可用的Zipkin,就需要实现监控数据的持久化。而想要实现数据持久化，自然就是得将数据存储至数据库。好在Zipkin 支持将数据存储至:</p>
<p>内存（默认）</p>
<p>MySQL</p>
<p>Elasticsearch</p>
<p>Cassandra</p>
<p>Zipkin 数据持久化相关官方文档地址如下</p>
<h2 id="七、前端开发基础知识"><a href="#七、前端开发基础知识" class="headerlink" title="七、前端开发基础知识"></a>七、前端开发基础知识</h2><p>这个等以后深入学习在进行记录~~~~</p>
<h3 id="7-1-VSCode-使用"><a href="#7-1-VSCode-使用" class="headerlink" title="7.1 VSCode 使用"></a>7.1 VSCode 使用</h3><p>Get</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;http-get请求&quot;: &#123;</span><br><span class="line">	&quot;prefix&quot;: &quot;httpget&quot;,</span><br><span class="line">	&quot;body&quot;: [</span><br><span class="line">	&quot;this.\\$http(&#123;&quot;,</span><br><span class="line">	&quot;url: this.\\$http.adornUrl(&#x27;&#x27;),&quot;,</span><br><span class="line">	&quot;method: &#x27;get&#x27;,&quot;,</span><br><span class="line">	&quot;params: this.\\$http.adornParams(&#123;&#125;)&quot;,</span><br><span class="line">	&quot;&#125;).then((&#123; data &#125;) =&gt; &#123;&quot;,</span><br><span class="line">	&quot;&#125;)&quot;],</span><br><span class="line">	&quot;description&quot;: &quot;httpGET请求&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>POST </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&quot;http-post请求&quot;: &#123;</span><br><span class="line">	&quot;prefix&quot;: &quot;httppost&quot;,</span><br><span class="line">	&quot;body&quot;: [</span><br><span class="line">	&quot;this.\\$http(&#123;&quot;,</span><br><span class="line">	&quot;url: this.\\$http.adornUrl(&#x27;&#x27;),&quot;,</span><br><span class="line">	&quot;method: &#x27;post&#x27;,&quot;,</span><br><span class="line">	&quot;data: this.\\$http.adornData(data, false)&quot;,</span><br><span class="line">	&quot;&#125;).then((&#123; data &#125;) =&gt; &#123; &#125;);&quot; ],</span><br><span class="line">	&quot;description&quot;: &quot;httpPOST请求&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>















<h3 id="7-2-ES6"><a href="#7-2-ES6" class="headerlink" title="7.2 ES6"></a>7.2 ES6</h3><h3 id="7-3-Node-js"><a href="#7-3-Node-js" class="headerlink" title="7.3 Node.js"></a>7.3 Node.js</h3><h3 id="7-4-Vue"><a href="#7-4-Vue" class="headerlink" title="7.4 Vue"></a>7.4 Vue</h3><h4 id="7-4-5-整合-Element-UI"><a href="#7-4-5-整合-Element-UI" class="headerlink" title="7.4.5 整合 Element UI"></a>7.4.5 整合 Element UI</h4><blockquote>
<p>1、安装</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui -S</span><br></pre></td></tr></table></figure>

<p><img src="/image-20201017104101531.png" alt="image-20201017104101531"></p>
<blockquote>
<p>2、引入 Element</p>
</blockquote>
<p>main.js 中引入以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;;</span><br><span class="line">import ElementUI from &#x27;element-ui&#x27;;</span><br><span class="line">import &#x27;element-ui/lib/theme-chalk/index.css&#x27;; // 引入静态资源文件</span><br><span class="line">import App from &#x27;./App.vue&#x27;;</span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI);</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &#x27;#app&#x27;,</span><br><span class="line">  render: h =&gt; h(App)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="7-5-Babel"><a href="#7-5-Babel" class="headerlink" title="7.5 Babel"></a>7.5 Babel</h3><h3 id="7-6-Webpack"><a href="#7-6-Webpack" class="headerlink" title="7.6 Webpack"></a>7.6 Webpack</h3><h2 id="八、商品服务-amp-三级分类"><a href="#八、商品服务-amp-三级分类" class="headerlink" title="八、商品服务&amp;三级分类"></a>八、商品服务&amp;三级分类</h2><h3 id="8-1-基础概念"><a href="#8-1-基础概念" class="headerlink" title="8.1 基础概念"></a>8.1 基础概念</h3><h4 id="8-1-1、三级分类"><a href="#8-1-1、三级分类" class="headerlink" title="8.1.1、三级分类"></a>8.1.1、三级分类</h4><p><img src="/image-20201017105714352.png" alt="image-20201017105714352"></p>
<p>一级分类查出二级分类数据，二级分类中查询出三级分类数据</p>
<p><strong>数据库设计</strong></p>
<p><img src="/image-20201017085122214.png" alt="image-20201017085122214"></p>
<h4 id="8-1-2、SPU-和-SKU"><a href="#8-1-2、SPU-和-SKU" class="headerlink" title="8.1.2、SPU 和 SKU"></a>8.1.2、SPU 和 SKU</h4><p><strong>SPU：Standard Product Unit （标准化产品单元）</strong></p>
<p>是商品信息聚合的最小单位，是一组可复用，易检索的标准化信息的组合，该集合描述了一个产品的特性</p>
<p><img src="/image-20201020083615056.png" alt="image-20201020083615056"></p>
<p><img src="/image-20201020083857519.png" alt="image-20201020083857519"></p>
<p>IPhoneX 是 SPU,MI8 是 SPU</p>
<p>IPhoneX 64G 黑曜石 是 SKU</p>
<p>MIX8 + 64G 是 SKU</p>
<p><strong>SKU: Stock KeepingUnit (库存量单位)</strong></p>
<h4 id="8-1-3、基本属性-【规格参数】与-销售属性"><a href="#8-1-3、基本属性-【规格参数】与-销售属性" class="headerlink" title="8.1.3、基本属性 【规格参数】与 销售属性"></a>8.1.3、基本属性 【规格参数】与 销售属性</h4><p>每个分共下的商共享规格参数、与销售属性，只是有些商品不一定更用这个分类下全部的属性：</p>
<p>属性是以三级分类组织起来的</p>
<p>规格参数中有些是可以提供检索的</p>
<p>规格参数也是基本属性，他们具有自己的分组</p>
<p>属性的分组也是以三级分类组织起来的</p>
<p>属性名确定的，但是值是每一个商品不同来决定的</p>
<blockquote>
<p>【属性分组-规格参数-销售属性-三级分类】关联关系</p>
</blockquote>
<p><img src="/image-20201020150957557.png" alt="image-20201020150957557"></p>
<p>SPU-SKU-属性表</p>
<p><img src="/image-20201020151022330.png" alt="image-20201020151022330"></p>
<h4 id="8-1-4、接口文档位置"><a href="#8-1-4、接口文档位置" class="headerlink" title="8.1.4、接口文档位置"></a>8.1.4、接口文档位置</h4><p><a target="_blank" rel="noopener" href="https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd">https://easydoc.xyz/s/78237135/ZUqEdvA4/hKJTcbfd</a></p>
<h4 id="8-1-5、-Object-划分"><a href="#8-1-5、-Object-划分" class="headerlink" title="8.1.5、 Object 划分"></a>8.1.5、 Object 划分</h4><h5 id="1、PO-persistant-object-持久化对象"><a href="#1、PO-persistant-object-持久化对象" class="headerlink" title="1、PO (persistant object) 持久化对象"></a>1、PO (persistant object) 持久化对象</h5><p>po 就是对应数据库中某一个表的一条记录，多个记录可以用 PO 的集合，PO 中应该不包含任何对数据库到操作</p>
<h5 id="2、DO-Domain-Object-领域对象"><a href="#2、DO-Domain-Object-领域对象" class="headerlink" title="2、DO ( Domain Object) 领域对象"></a>2、DO ( Domain Object) 领域对象</h5><p>就是从现实世界抽象出来的有形或无形的业务实体</p>
<h5 id="3、TO-Transfer-Object-数据传输对象"><a href="#3、TO-Transfer-Object-数据传输对象" class="headerlink" title="3、TO (Transfer Object) 数据传输对象"></a>3、TO (Transfer Object) 数据传输对象</h5><p>不同的应用程序之间传输的对象</p>
<h5 id="4、DTO-Data-Transfer-Object-数据传输对象"><a href="#4、DTO-Data-Transfer-Object-数据传输对象" class="headerlink" title="4、DTO  (Data Transfer Object) 数据传输对象"></a>4、DTO  (Data Transfer Object) 数据传输对象</h5><p>这个概念来源于 J2EE 的设计模式，原来的目的是为了 EJB的分布式应用提供粗粒度的数据实体，以减少分布式调用的次数，从而提高分数调用的性能和降低网络负载，但在这里，泛指用于展示层与服务层之间的数据传输对象</p>
<h5 id="5、VO-value-object-值对象"><a href="#5、VO-value-object-值对象" class="headerlink" title="5、VO(value object) 值对象"></a>5、VO(value object) 值对象</h5><p>通常用于业务层之间的数据传递，和 PO 一样也是仅仅包含数据而已，但应是抽象出的业务对象，可以和表对应，也可以不，这根据业务的需要，用 new 关键字创建，由 GC 回收</p>
<p>view Object 试图对象</p>
<p>接受页面传递来的数据，封装对象，封装页面需要用的数据</p>
<h5 id="6、BO-business-object-业务对象"><a href="#6、BO-business-object-业务对象" class="headerlink" title="6、BO(business object) 业务对象"></a>6、BO(business object) 业务对象</h5><p>从业务模型的角度看，见 UML 原件领域模型中的领域对象，封装业务逻辑的， java 对象，通过调用 DAO 方法，结合 PO VO,进行业务操作，business object 业务对象，主要作用是把业务逻辑封装成一个对象，这个对象包括一个或多个对象，比如一个简历，有教育经历，工作经历，社会关系等等，我们可以把教育经历对应一个 PO 、工作经验对应一个 PO、 社会关系对应一个 PO, 建立一个对应简历的的 BO 对象处理简历，每 个 BO 包含这些 PO ,这样处理业务逻辑时，我们就可以针对 BO 去处理</p>
<h5 id="7、POJO-plain-ordinary-java-object-简单无规则-java-对象"><a href="#7、POJO-plain-ordinary-java-object-简单无规则-java-对象" class="headerlink" title="7、POJO ( plain ordinary java object) 简单无规则 java 对象"></a>7、POJO ( plain ordinary java object) 简单无规则 java 对象</h5><p>传统意义的 java 对象，就是说一些 Object&#x2F;Relation Mapping 工具中，能够做到维护数据库表记录的 persisent object 完全是一个符合  Java Bean 规范的 纯 java 对象，没有增加别的属性和方法，我们的理解就是最基本的 Java bean 只有属性字段 setter 和 getter 方法</p>
<p>POJO 时是 DO&#x2F;DTO&#x2F;BO&#x2F;VO 的统称</p>
<h5 id="8、DAO（data-access-object）-数据访问对象"><a href="#8、DAO（data-access-object）-数据访问对象" class="headerlink" title="8、DAO（data access object） 数据访问对象"></a>8、DAO（data access object） 数据访问对象</h5><p>是一个 sun 的一个标准 j2ee 设计模式，这个模式有个接口就是 DAO ，他负持久层的操作，为业务层提供接口，此对象用于访问数据库，通常和 PO 结合使用，DAO 中包含了各种数据库的操作方法，通过它的方法，结合 PO 对数据库进行相关操作，夹在业务逻辑与数据库资源中间，配合VO 提供数据库的 CRUD 功能</p>
<h3 id="8-2-三级分类接口编写"><a href="#8-2-三级分类接口编写" class="headerlink" title="8.2 三级分类接口编写"></a>8.2 三级分类接口编写</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回查询所有分类以及子子分类，以树形结构组装起来    </span></span><br><span class="line">List&lt;CategoryEntity&gt; <span class="title function_">listWithTree</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>实现类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">listWithTree</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="comment">// 1、查出所有分类 设置为null查询全部</span></span><br><span class="line">      List&lt;CategoryEntity&gt; entities = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2、组装成父子的树形结构</span></span><br><span class="line">      List&lt;CategoryEntity&gt; levelList = entities.stream().filter(categoryEntity -&gt; &#123;</span><br><span class="line">          <span class="comment">// parentCid ==0 为父目录默认0</span></span><br><span class="line">          <span class="keyword">return</span> categoryEntity.getParentCid() == <span class="number">0</span>;</span><br><span class="line">      &#125;).map(menu -&gt; &#123;</span><br><span class="line">          <span class="comment">// 设置二三级分类 递归</span></span><br><span class="line">          menu.setChildren(getChildrens(menu,entities));</span><br><span class="line">          <span class="keyword">return</span> menu;</span><br><span class="line">      &#125;).sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">          <span class="comment">//  排序 Sort字段排序</span></span><br><span class="line">          <span class="keyword">return</span> (menu1.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : menu1.getSort()) - (menu2.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : menu2.getSort());</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> levelList;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   *  递归查询子分类</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> root 当前category对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> all  全部分类数据</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title function_">getChildrens</span><span class="params">(CategoryEntity root, List&lt;CategoryEntity&gt; all)</span> &#123;</span><br><span class="line"></span><br><span class="line">      List&lt;CategoryEntity&gt; collect = all.stream().filter(categoryEntity -&gt; &#123;</span><br><span class="line">          <span class="comment">// 遍历所有的category对象的父类id = 等于root的分类id 说明是他的子类</span></span><br><span class="line">          <span class="keyword">return</span> categoryEntity.getParentCid() == root.getCatId();</span><br><span class="line">      &#125;).map(menu -&gt; &#123;</span><br><span class="line">          <span class="comment">// 1、递归遍历菜单</span></span><br><span class="line">          menu.setChildren(getChildrens(menu, all));</span><br><span class="line">          <span class="keyword">return</span> menu;</span><br><span class="line">      &#125;).sorted((menu1, menu2) -&gt; &#123;</span><br><span class="line">          <span class="comment">// 2、菜单排序</span></span><br><span class="line">          <span class="keyword">return</span> (menu1.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : menu1.getSort()) - (menu2.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : menu2.getSort());</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> collect;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>跨域</p>
</blockquote>
<p>跨域：指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对javascript施加的安全限制。</p>
<p>同源策略：是指协议，域名，端口都要相同，其中有一个不同都会产生跨域；</p>
<p>下图详细说明了 URL  的改变导致是否允许通信</p>
<p><img src="/image-20201017090210286.png" alt="image-20201017090210286"></p>
<blockquote>
<p>跨域流程</p>
</blockquote>
<p><img src="/image-20201017090318165.png" alt="image-20201017090318165"></p>
<p>浏览器发请求都要实现发送一个请求询问是否可以进行通信 ，我直接给你返回可以通信不就可以了吗？<img src="/image-20201017090546193.png" alt="image-20201017090546193"></p>
<p>相关资料参考：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS</a></p>
<blockquote>
<p>解决跨越（ 一 ） 使用nginx部署为同一域</p>
</blockquote>
<p>开发过于麻烦，上线在使用</p>
<p><img src="/image-20201017090434369.png" alt="image-20201017090434369"></p>
<blockquote>
<p>解决跨域 （ 二 ）配置当次请求允许跨域</p>
</blockquote>
<p>1、添加响应头</p>
<ul>
<li><p>Access-Control-Allow-Origin: 支持哪些来源的请求跨域</p>
</li>
<li><p>Access-Control-Allow-Methods: 支持哪些方法跨域</p>
</li>
<li><p>Access-Control-Allow-Credentials: 跨域请求默认不包含cookie,设置为true可以包含cookie</p>
</li>
<li><p>Access-Control-Expose-Headers: 跨域请求暴露的字段</p>
<p>​	CORS请求时, XML .HttpRequest对象的getResponseHeader()方法只能拿到6个基本字段: CacheControl、Content-L anguage、Content Type、Expires、 </p>
<p>Last-Modified、 Pragma。 如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。</p>
</li>
<li><p>Access-Control-Max- Age: 表明该响应的有效时间为多少秒。在有效时间内，浏览器无须为同一-请求再次发起预检请求。请注意，浏览器自身维护了一个最大有效时间，如果该首部字段的值超过了最大有效时间，将不会生效。</p>
</li>
</ul>
<p>网关配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://gulimall-product</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://renren-fast</span>  <span class="comment"># lb负载均衡</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/**</span>  <span class="comment"># path指定对应路径</span></span><br><span class="line">  <span class="attr">filters:</span> <span class="comment"># 重写路径</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;/?.*),</span> <span class="string">/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p>跨越设置</p>
<p>请求先发送到网关，网关在转发给其他服务  事先都要注册到<strong>注册中心</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallCorsConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">corsConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置跨越</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>); <span class="comment">// 允许那些头</span></span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>); <span class="comment">// 允许那些请求方式</span></span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">&quot;*&quot;</span>); <span class="comment">//  允许请求来源</span></span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="literal">true</span>); <span class="comment">// 是否允许携带cookie跨越</span></span><br><span class="line">        <span class="comment">// 注册跨越配置</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,corsConfiguration);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="8-2-1-树形展示三级分类数据"><a href="#8-2-1-树形展示三级分类数据" class="headerlink" title="8.2.1 树形展示三级分类数据"></a>8.2.1 树形展示三级分类数据</h4><blockquote>
<p>1、用到的前端组件  Tree 树形控件</p>
</blockquote>
<p><img src="/image-20201018160751922.png" alt="image-20201018160751922"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tree :data=&quot;data&quot; :props=&quot;defaultProps&quot; @node-click=&quot;handleNodeClick&quot;&gt;&lt;/el-tree&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">data	展示数据</span><br><span class="line">props 配置选项</span><br><span class="line">	children 指定子树为节点对象的某个属性值</span><br><span class="line">	label 指定节点标签为节点对象的某个属性值</span><br><span class="line">    disabled 节点选择框是否禁用为节点对象的某个属性值</span><br><span class="line">@node-click 节点被点击时的回调</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p>配置静态数据就能显示出对应的效果</p>
<blockquote>
<p>2、编写方法获取全部菜单数据</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getMenus</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">          <span class="comment">// 请求接口见上面</span></span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/list/tree&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回的菜单数据&quot;</span> + data.<span class="property">data</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">menus</span> = data.<span class="property">data</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3、最终展示结果  ( append ,edit 会在后面介绍)</p>
</blockquote>
<p><img src="/image-20201018161429599.png" alt="image-20201018161429599"></p>
<h4 id="8-2-2-逻辑删除-amp-删除效果细化"><a href="#8-2-2-逻辑删除-amp-删除效果细化" class="headerlink" title="8.2.2 逻辑删除&amp;删除效果细化"></a>8.2.2 逻辑删除&amp;删除效果细化</h4><p>效果图</p>
<p><img src="/image-20201018164706109.png" alt="image-20201018164706109"></p>
<p><img src="/image-20201018164715825.png" alt="image-20201018164715825"></p>
<blockquote>
<p>1、节点的内容支持自定义，可以在节点区添加按钮或图标等内容</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt; Delete&lt;/el-button&gt;</span><br><span class="line"> &lt;!-- </span><br><span class="line">	v-if=&quot;node.childNodes.length == 0&quot;  没有子节点可以删除</span><br><span class="line">	type 对应类型</span><br><span class="line">	size 大小</span><br><span class="line">	@click 点击后出发的方法 此处使用了 箭头函数</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、前端remove方法进行删除</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">remove</span>(<span class="params">node, data</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$confirm(<span class="string">`是否删除【<span class="subst">$&#123;data.name&#125;</span>】菜单 ? `</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 拿到当前节点的catId</span></span><br><span class="line">          <span class="keyword">var</span> ids = [data.<span class="property">catId</span>];</span><br><span class="line">          <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/delete&quot;</span>),</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(ids, <span class="literal">false</span>)</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">              <span class="attr">message</span>: <span class="string">&quot;菜单删除成功&quot;</span>,</span><br><span class="line">              <span class="attr">type</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 刷新菜单</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">            <span class="comment">// 设置默认需要展开的菜单</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            default-expanded-keys  默认展开节点的 key 数组 </span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [node.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span>];</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(node.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;remove&quot;</span>, node, data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3、后端接口 – 逻辑删除配置</p>
</blockquote>
<p>3.1 第一种方式 mybatisplus 逻辑删除参考官网：<a target="_blank" rel="noopener" href="https://baomidou.com/guide/logic-delete.html">https://baomidou.com/guide/logic-delete.html</a></p>
<p>在appliction.yml 中配置 myabtisplus 逻辑删除</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># 数据库主键自增</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>

<p>3.2 第二种方式 在 Entity中 使用注解 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	是否为数据库表字段</span></span><br><span class="line"><span class="comment">	默认 true 存在，false 不存在</span></span><br><span class="line"><span class="comment">	标记为false 说明 该字段不在数据库 </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;CategoryEntity&gt; children;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4、Controller 实现  使用了代码生成器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestBody</span>:获取请求体，必须发送post请求才有 get请求没有</span></span><br><span class="line"><span class="comment">     * SpringMvc 自动将请求体的数据 ( json ) 转为对应的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestBody</span> Long[] catIds)</span>&#123;</span><br><span class="line">        <span class="comment">// 1、检查当前删除的菜单，是否被别的地方应用</span></span><br><span class="line">        categoryService.removeMenuByIds(Arrays.asList(catIds));</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//Service 实现</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeMenuByIds</span><span class="params">(List&lt;Long&gt; asList)</span> &#123;</span><br><span class="line">        <span class="comment">// 1、逻辑删除</span></span><br><span class="line">        baseMapper.deleteBatchIds(asList);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="8-2-3-新增效果-amp-基本修改"><a href="#8-2-3-新增效果-amp-基本修改" class="headerlink" title="8.2.3 新增效果&amp;基本修改"></a>8.2.3 新增效果&amp;基本修改</h4><p><img src="/image-20201018164748228.png" alt="image-20201018164748228"></p>
<blockquote>
<p>1、前端组件 button 组件  Dialog 对话框</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">  &lt;!-- 层级小于2 才能新增 --&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">            &gt;Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line"> &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;() =&gt; edit(data)&quot;</span><br><span class="line">            &gt;edit</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 上面组件在tree中--&gt;</span><br><span class="line">&lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :before-close=&quot;handleClose&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;category.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、新增&amp;修改</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">  <span class="title function_">append</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;append&quot;</span>, data);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;添加分类&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">parentCid</span> = data.<span class="property">catId</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">catLevel</span> = data.<span class="property">catLevel</span> * <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">catId</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">icon</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">productUnit</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;, <span class="comment">// 要修改的数据</span></span><br><span class="line">    <span class="title function_">edit</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;要修改的数据&quot;</span>, data);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogType</span> = <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">title</span> = <span class="string">&quot;修改分类&quot;</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 发送请求获取最新的数据</span></span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">`/product/category/info/<span class="subst">$&#123;data.catId&#125;</span>`</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;get&quot;</span></span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 请求成功</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;要回显的数据&quot;</span>, data);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">name</span> = data.<span class="property">data</span>.<span class="property">name</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">catId</span> = data.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">icon</span> = data.<span class="property">data</span>.<span class="property">icon</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">productUnit</span> = data.<span class="property">data</span>.<span class="property">productUnit</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">parentCid</span> = data.<span class="property">data</span>.<span class="property">parentCid</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">submitData</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 进行新增</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dialogType</span> == <span class="string">&quot;edit&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 进行修改</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">editCategory</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">        <span class="comment">// 添加三级分类</span></span><br><span class="line">    <span class="title function_">addCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;添加三级分类的数据&quot;</span>, <span class="variable language_">this</span>.<span class="property">category</span>);</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/save&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(<span class="variable language_">this</span>.<span class="property">category</span>, <span class="literal">false</span>)</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;菜单保存成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 关闭对话框</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 重新刷新数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">        <span class="comment">// 默认展开的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [<span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">parentCid</span>];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="comment">// 修改三级分类数据</span></span><br><span class="line">    <span class="title function_">editCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 解构出单独的几个对象 用来提交</span></span><br><span class="line">      <span class="keyword">var</span> &#123; catId, name, icon, productUnit &#125; = <span class="variable language_">this</span>.<span class="property">category</span>;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/update&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(&#123; catId, name, icon, productUnit &#125;, <span class="literal">false</span>)</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;菜单修改成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 关闭对话框</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">dialogVisible</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 重新刷新数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">        <span class="comment">// 默认展开的菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">expandedKey</span> = [<span class="variable language_">this</span>.<span class="property">category</span>.<span class="property">parentCid</span>];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3、要考虑到的点 以及细节</p>
</blockquote>
<ul>
<li>添加完成后要把表单的数据进行清除，否则第二次打开任然会有上次表单提交剩下的数据      this.category.name &#x3D; “”;</li>
<li>修改和新增用的是同一个表单，因此在方法对话框中 动态的绑定了  :title&#x3D;”title” 标题 用于显示是新增还是修改</li>
<li>一个表单都是一个提交方法 因此在提交方法的时候进行了判断，根据变量赋值决定调用那个方法  this.dialogType &#x3D; “add”;  this.dialogType &#x3D; “edit”;</li>
</ul>
<h4 id="8-2-4-拖拽功能-amp-数据收集-amp-批量删除"><a href="#8-2-4-拖拽功能-amp-数据收集-amp-批量删除" class="headerlink" title="8.2.4 拖拽功能&amp;数据收集&amp;批量删除"></a>8.2.4 拖拽功能&amp;数据收集&amp;批量删除</h4><p>效果演示</p>
<p><img src="/image-20201018093124893.png" alt="image-20201018093124893"></p>
<blockquote>
<p>1、前端用的组件  Tree 树形控件 可拖拽节点 </p>
</blockquote>
<p>通过 draggable 属性可让节点变为可拖拽。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-tree</span><br><span class="line">      :expand-on-click-node=&quot;false&quot; </span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">      ref=&quot;menuTree&quot;</span><br><span class="line">    &gt;</span><br><span class="line">&lt;!-- </span><br><span class="line">:expand-on-click-node 是否在点击节点的时候展开或者收缩节点 默认 true 则只有点箭头图标的时候才会展开或者收缩节点。</span><br><span class="line">show-checkbox	节点是否可被选择</span><br><span class="line">node-key 每个树节点用来做唯一标识的属性 </span><br><span class="line">default-expanded-keys  默认展开节点的节点</span><br><span class="line">draggable 表示是否可以被拖拽 true&amp;false</span><br><span class="line">allow-drop 拖拽时判定目标节点能否被放置</span><br><span class="line">node-drop 拖拽成功完成出发的事件</span><br><span class="line">ref 该组件tree的引用</span><br><span class="line">详细解释参考官网 https://element.eleme.cn/#/zh-CN/component/tree</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2、主要业务逻辑  TODO：暂时不懂 回头再来看</p>
</blockquote>
<p><strong>allowDrop</strong>：</p>
<p>拖拽时判定目标节点能否被放置。<code>type</code> 参数有三种情况：’prev’、’inner’ 和 ‘next’，分别表示放置在目标节点前、插入至目标节点和放置在目标节点后</p>
<p><strong>@node-drop</strong></p>
<p>拽成功完成时触发的事件</p>
<p>共四个参数，依次为：被拖拽节点对应的 Node、结束拖拽时最后进入的节点、被拖拽节点的放置位置（before、after、inner）、event</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">allowDrop</span>(<span class="params">draggingNode, dropNode, type</span>) &#123;</span><br><span class="line">     <span class="comment">// 1、被拖动的当前节点以及所在的父节点总层次不能大于3</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// 1) 被拖动节点的总层数</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;allowDrop&quot;</span>, draggingNode, dropNode, type);</span><br><span class="line"></span><br><span class="line">     <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(draggingNode.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 当前正在拖动的节点 + 父节点所在的深度不大于3即可</span></span><br><span class="line">     <span class="keyword">let</span> deep = <span class="title class_">Math</span>.<span class="title function_">abs</span>(<span class="variable language_">this</span>.<span class="property">maxLevel</span> - draggingNode.<span class="property">level</span>) + <span class="number">1</span>;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;深度&quot;</span>, deep);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (type == <span class="string">&quot;inner&quot;</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> deep + dropNode.<span class="property">level</span> &lt;= <span class="number">3</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> deep + dropNode.<span class="property">parent</span>.<span class="property">level</span> &lt;= <span class="number">3</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;,</span><br><span class="line">   <span class="title function_">countNodeLevel</span>(<span class="params">node</span>) &#123;</span><br><span class="line">     <span class="comment">// 找到所有子节点，求出最大深度</span></span><br><span class="line">     <span class="keyword">if</span> (node.<span class="property">children</span> != <span class="literal">null</span> &amp;&amp; node.<span class="property">children</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">children</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">if</span> (node.<span class="property">children</span>[i].<span class="property">catLevel</span> &gt; <span class="variable language_">this</span>.<span class="property">maxLevel</span>) &#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="property">maxLevel</span> = node.<span class="property">children</span>[i].<span class="property">catLevel</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 递归查找</span></span><br><span class="line">         <span class="variable language_">this</span>.<span class="title function_">countNodeLevel</span>(node.<span class="property">children</span>[i]);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,  <span class="title function_">handleDrop</span>(<span class="params">draggingNode, dropNode, dropType, ev</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;handleDrop: &quot;</span>, draggingNode, dropNode, dropType);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 1、当前节点最新的父节点</span></span><br><span class="line">     <span class="keyword">let</span> pCid = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">let</span> siblings = <span class="literal">null</span>;</span><br><span class="line">     <span class="keyword">if</span> (dropType == <span class="string">&quot;before&quot;</span> || dropType == <span class="string">&quot;after&quot;</span>) &#123;</span><br><span class="line">       pCid =</span><br><span class="line">         dropNode.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span> == <span class="literal">undefined</span></span><br><span class="line">           ? <span class="number">0</span></span><br><span class="line">           : dropNode.<span class="property">parent</span>.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">       siblings = dropNode.<span class="property">parent</span>.<span class="property">childNodes</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       pCid = dropNode.<span class="property">data</span>.<span class="property">catId</span>;</span><br><span class="line">       siblings = dropNode.<span class="property">childNodes</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// this.PCid = pCid</span></span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">pCid</span>.<span class="title function_">push</span>(pCid);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 2、当前拖拽节点的最新顺序</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; siblings.<span class="property">length</span>; i++) &#123;</span><br><span class="line">       <span class="keyword">if</span> (siblings[i].<span class="property">data</span>.<span class="property">catId</span> == draggingNode.<span class="property">data</span>.<span class="property">catId</span>) &#123;</span><br><span class="line">         <span class="comment">// 如果遍历的是当前正在拖拽的节点</span></span><br><span class="line">         <span class="keyword">let</span> catLevel = draggingNode.<span class="property">level</span>;</span><br><span class="line">         <span class="keyword">if</span> (siblings[i].<span class="property">level</span> != draggingNode.<span class="property">level</span>) &#123;</span><br><span class="line">           <span class="comment">// 当前结点的层级发生变化</span></span><br><span class="line">           catLevel = siblings[i].<span class="property">level</span>;</span><br><span class="line">           <span class="comment">// 修改它子节点的层级</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">updateChildNodeLevel</span>(siblings[i]);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="comment">// 如果遍历当前正在拖拽的节点</span></span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">           <span class="attr">catId</span>: siblings[i].<span class="property">data</span>.<span class="property">catId</span>,</span><br><span class="line">           <span class="attr">sort</span>: i,</span><br><span class="line">           <span class="attr">parentCid</span>: pCid</span><br><span class="line">         &#125;);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123; <span class="attr">catId</span>: siblings[i].<span class="property">data</span>.<span class="property">catId</span>, <span class="attr">sort</span>: i &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 3、当前拖拽节点的最新层级</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;updateNodes&quot;</span>, <span class="variable language_">this</span>.<span class="property">updateNodes</span>);</span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="title function_">updateChildNodeLevel</span>(<span class="params"></span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (node.<span class="property">childNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; node.<span class="property">childNodes</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">var</span> cNode = node.<span class="property">childNodes</span>[i].<span class="property">data</span>;</span><br><span class="line">         <span class="variable language_">this</span>.<span class="property">updateNodes</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">           <span class="attr">catId</span>: cNode.<span class="property">catId</span>,</span><br><span class="line">           <span class="attr">catLevel</span>: node.<span class="property">childNodes</span>[i].<span class="property">level</span></span><br><span class="line">         &#125;);</span><br><span class="line">         <span class="variable language_">this</span>.<span class="title function_">updateChildNodeLevel</span>(node.<span class="property">childNodes</span>[i]);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>



<blockquote>
<p>3、批量删除</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;danger&quot; @click=&quot;batchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>batchDelete方法 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">batchDelete</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> catIds = [];</span><br><span class="line">    <span class="keyword">let</span> names = [];</span><br><span class="line">    <span class="comment">// 返回目前被选中的节点所组成的数组</span></span><br><span class="line">    <span class="keyword">let</span> checkedNodes = <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">menuTree</span>.<span class="title function_">getCheckedNodes</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;被选中的元素&quot;</span>, checkedNodes);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; checkedNodes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// 遍历节点数组 拿到需要的值</span></span><br><span class="line">      catIds.<span class="title function_">push</span>(checkedNodes[i].<span class="property">catId</span>);</span><br><span class="line">      names.<span class="title function_">push</span>(checkedNodes[i].<span class="property">name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.$confirm(<span class="string">`是否批量删除【<span class="subst">$&#123;names&#125;</span>】菜单 ? `</span>, <span class="string">&quot;提示&quot;</span>, &#123;</span><br><span class="line">      <span class="attr">confirmButtonText</span>: <span class="string">&quot;确定&quot;</span>,</span><br><span class="line">      <span class="attr">cancelButtonText</span>: <span class="string">&quot;取消&quot;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;warning&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/delete&quot;</span>),</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(catIds, <span class="literal">false</span>)</span><br><span class="line">      &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;删除成功&quot;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">      <span class="comment">// 刷新菜单</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getMenus</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>后端接口也是逻辑批量删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">removeMenuByIds</span><span class="params">(List&lt;Long&gt; asList)</span>; <span class="comment">//接收的是一个id数组</span></span><br></pre></td></tr></table></figure>

<p><strong>总结：</strong></p>
<p>前端用到的组件</p>
<p> Dialog 对话框、可拖拽节点、Switch 开关、Button 按钮、Tree组件（属性较多）</p>
<p>细节点：</p>
<p>没开启拖拽</p>
<p><img src="/image-20201018115207636.png" alt="image-20201018115207636"></p>
<p>开启拖拽：</p>
<p>通过 draggable 属性可让节点变为可拖拽。</p>
<p><img src="/image-20201018115219350.png" alt="image-20201018115219350"></p>
<p><img src="/image-20201018115326664.png" alt="image-20201018115326664"></p>
<h2 id="九、商品服务-amp-品牌管理"><a href="#九、商品服务-amp-品牌管理" class="headerlink" title="九、商品服务&amp;品牌管理"></a>九、商品服务&amp;品牌管理</h2><h3 id="9-1、效果显示优化与快速显示开关"><a href="#9-1、效果显示优化与快速显示开关" class="headerlink" title="9.1、效果显示优化与快速显示开关"></a>9.1、效果显示优化与快速显示开关</h3><p><img src="/image-20201019201328358.png" alt="image-20201019201328358"></p>
<p>vue代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> &lt;el-switch</span><br><span class="line">            v-model=&quot;scope.row.showStatus&quot;</span><br><span class="line">            active-color=&quot;#13ce66&quot;</span><br><span class="line">            inactive-color=&quot;#ff4949&quot;</span><br><span class="line">            :active-value=&quot;1&quot;</span><br><span class="line">            :inactive-value=&quot;0&quot;</span><br><span class="line">            @change=&quot;updateBrandStatus(scope.row)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">     &lt;!-- </span><br><span class="line">scope.row 拿到整行的数据</span><br><span class="line">active-color	switch 打开时的背景色</span><br><span class="line">inactive-color	switch 关闭时的背景色</span><br><span class="line">active-value	switch 打开时的值</span><br><span class="line">inactive-value	switch 关闭时的值</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p>组件地址：<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/switch">https://element.eleme.cn/#/zh-CN/component/switch</a></p>
<p>用户点击 switch 开关就会调用后台的接口更改对应数据库的字段 ( 决定是否显示)，定义了 @change 事件 只要修后就会触发对应方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">updateBrandStatus</span>(<span class="params">data</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;整行数据&quot;</span>,data);</span><br><span class="line">    <span class="comment">// 单独就封装两个字段</span></span><br><span class="line">     <span class="keyword">let</span> &#123;brandId,showStatus&#125; = data</span><br><span class="line">     <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">       <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&#x27;/product/brand/update&#x27;</span>),</span><br><span class="line">       <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">       <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornData</span>(&#123;brandId,showStatus&#125;, <span class="literal">false</span>)</span><br><span class="line">     &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">         <span class="attr">type</span>:<span class="string">&quot;success&quot;</span>,</span><br><span class="line">         <span class="attr">message</span>:<span class="string">&quot;状态更新成功&quot;</span></span><br><span class="line">       &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="9-2、表单效验-amp-自定义效验规则"><a href="#9-2、表单效验-amp-自定义效验规则" class="headerlink" title="9.2、表单效验&amp;自定义效验规则"></a>9.2、表单效验&amp;自定义效验规则</h3><p>Form 组件提供了表单验证的功能，只需要通过 <code>rules</code> 属性传入约定的验证规则，并将 Form-Item 的 <code>prop</code> 属性设置为需校验的字段名即可</p>
<p><img src="/image-20201019204335899.png" alt="image-20201019204335899"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form</span><br><span class="line">      :model=&quot;dataForm&quot;</span><br><span class="line">      :rules=&quot;dataRule&quot;</span><br><span class="line">      ref=&quot;dataForm&quot;</span><br><span class="line">      @keyup.enter.native=&quot;dataFormSubmit()&quot;</span><br><span class="line">      label-width=&quot;140px&quot;</span><br><span class="line">    &gt;</span><br></pre></td></tr></table></figure>

<p>data中</p>
<p> 自定义的规则 ，用来对数据进行判断</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataRule</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">&quot;品牌名不能为空&quot;</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;],</span><br><span class="line">        <span class="comment">// 自定义的规则  </span></span><br><span class="line">        <span class="attr">firstLetter</span>: [</span><br><span class="line">          &#123; <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(value == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;首字母必须填写&quot;</span>))</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(! <span class="regexp">/^[a-zA-Z]$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;首字母必须a-z或者A-Z之间&quot;</span>))</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">callback</span>()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,<span class="attr">trigger</span>:<span class="string">&#x27;blur&#x27;</span>&#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">sort</span>: [&#123; <span class="attr">validator</span>: <span class="function">(<span class="params">rule, value, callback</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(value == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;排序字段必须填写&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(value) || value &lt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;排序必须是一个大于等于0的整数&quot;</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span> &#125;]</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-3、JSR303-数据效验-amp-统一异常处理"><a href="#9-3、JSR303-数据效验-amp-统一异常处理" class="headerlink" title="9.3、JSR303 数据效验 &amp; 统一异常处理"></a>9.3、JSR303 数据效验 &amp; 统一异常处理</h3><p>前端数据效验成功了，就会把json数据传递到后端，但是有人利用接口 比如 postman 乱发送请求 那会怎么办，于是后端也会利用 JSR303进行数据效验</p>
<h4 id="9-3-1、给Bean添加效验注解-javax-validation-constraints包下-并定义自己的的message提示"><a href="#9-3-1、给Bean添加效验注解-javax-validation-constraints包下-并定义自己的的message提示" class="headerlink" title="9.3.1、给Bean添加效验注解  javax.validation.constraints包下 并定义自己的的message提示"></a>9.3.1、给Bean添加效验注解  javax.validation.constraints包下 并定义自己的的message提示</h4><p><img src="/image-20201019205020068.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotEmpty(messsage = &quot;logo不能为空&quot;)</span></span><br><span class="line"><span class="meta">@URL(message = &quot;logo必须是一个合法的url地址&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String logo;</span><br></pre></td></tr></table></figure>

<h4 id="9-3-2、开启效验功能-Valid"><a href="#9-3-2、开启效验功能-Valid" class="headerlink" title="9.3.2、开启效验功能 @Valid"></a>9.3.2、开启效验功能 @Valid</h4><ul>
<li><p>效果：效验错误以后有默认的响应</p>
<p>Controller代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span><span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/image-20201020083020271.png" alt="image-20201020083020271"></p>
</li>
</ul>
<h4 id="9-3-3、给效验的bean后紧跟一个BindingResult-就可以获取到效验的结果"><a href="#9-3-3、给效验的bean后紧跟一个BindingResult-就可以获取到效验的结果" class="headerlink" title="9.3.3、给效验的bean后紧跟一个BindingResult 就可以获取到效验的结果"></a>9.3.3、给效验的bean后紧跟一个BindingResult 就可以获取到效验的结果</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand,BindingResult result)</span>&#123;</span><br><span class="line"> <span class="keyword">if</span>(result.hasErrors())&#123;</span><br><span class="line">           Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           <span class="comment">//1、获取校验的错误结果</span></span><br><span class="line">           result.getFieldErrors().forEach((item)-&gt;&#123;</span><br><span class="line">               <span class="comment">//FieldError 获取到错误提示</span></span><br><span class="line">               <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">               <span class="comment">//获取错误的属性的名字</span></span><br><span class="line">               <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">               map.put(field,message);</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> R.error(<span class="number">400</span>,<span class="string">&quot;提交的数据不合法&quot;</span>).put(<span class="string">&quot;data&quot;</span>,map);</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h4 id="9-3-4、分组效验-多场景复杂效验"><a href="#9-3-4、分组效验-多场景复杂效验" class="headerlink" title="9.3.4、分组效验 (多场景复杂效验)"></a>9.3.4、分组效验 (多场景复杂效验)</h4><p>添加一个组 &amp; 修改一个组</p>
<p>1、@NotBlank(message &#x3D; “品牌名必须提交”,groups &#x3D; {AddGroup.class,UpdateGroup.class})</p>
<ul>
<li><strong>给效验注解标注什么情况需要进行效验</strong></li>
<li>@Validated({AddGroup.class}) 在对应方法上进行标注</li>
<li><strong>默认没有指定分组的效验注解 @NotBlank 在分组效验情况@Validated({AddGroup.class})不生效</strong>，只会在@Validated生效</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标记使用修改分组</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@Validated(UpdateGroup.class)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">	brandService.updateById(brand);</span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Entity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Null(message = &quot;新增不能指定Id&quot;,groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@NotNull(message = &quot;修改必须指定品牌id&quot;,groups = &#123;UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@TableId</span></span><br><span class="line"><span class="keyword">private</span> Long brandId;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotBlank(message = &quot;品牌名不能为空&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 品牌logo地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotEmpty(groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@URL(message = &quot;logo必须是一个合法的url地址&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String logo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 介绍</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String descript;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@ListValue(vals=&#123;0,1&#125;,groups = &#123;AddGroup.class,UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检索首字母</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotEmpty(groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@Pattern(regexp = &quot;^[a-zA-Z]$&quot;,message = &quot;检索首字母必须是一个字母&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String firstLetter;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@NotNull(groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@Min(value=0,message = &quot;排序必须大于等于0&quot;,groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> Integer sort;</span><br></pre></td></tr></table></figure>

<h4 id="9-3-5、自定义效验"><a href="#9-3-5、自定义效验" class="headerlink" title="9.3.5、自定义效验"></a>9.3.5、自定义效验</h4><ul>
<li><pre><code> 编写一个自定义的效验注解
</code></pre>
</li>
<li><pre><code> 编写一个自定义的效验器何自定义的效验注解
</code></pre>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = &#123;ListValueConstraintValidator.class&#125;)</span><span class="comment">//【可以指定多个不同的效验器，适配不同类型的效验】</span></span><br><span class="line"><span class="meta">@Target(&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 三要素不能丢</span></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.atguigu.gulimall.product.valid.ListValue.message&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] vals() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现约束</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;ListValue,Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> val : vals) &#123;</span><br><span class="line">            <span class="comment">// 将结果添加到set集合</span></span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *	判断效验是否成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 需要效验的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是包含该值</span></span><br><span class="line">        <span class="keyword">return</span> set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="9-3-6、异常处理"><a href="#9-3-6、异常处理" class="headerlink" title="9.3.6、异常处理"></a>9.3.6、异常处理</h4><p>这里使用到了 SpringMVC 的注解 @ControllerAdvice</p>
<p>1、编写异常处理类使用SpringMvc的@ControllerAdvice</p>
<p> 2、使用@ExceptionHandler标记方法可以处理异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages =  &quot;com.atguigu.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GulimallExceptionControllerAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 捕获定义的异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleVaildException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据效验出现问题&#123;&#125;,异常类型:&#123;&#125;&quot;</span>,e.getMessage(),e.getClass());</span><br><span class="line">        Map&lt;String,String&gt; errorMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        bindingResult.getFieldErrors().forEach(fieldError -&gt; &#123;</span><br><span class="line">            errorMap.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnume.VAILD_EXCEPTION.getCode(),BizCodeEnume.VAILD_EXCEPTION.getMsg()).put(<span class="string">&quot;data&quot;</span>,errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 兜底异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> throwable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> R.error();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>异常错误码定义 （重点）</strong></p>
<p>后端将定义的错误码写入到开发手册，前端出现对于的错误，就可以通过手册查询到对应的异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment"> * 错误码和错误信息定义类</span></span><br><span class="line"><span class="comment"> * 1. 错误码定义规则为5为数字</span></span><br><span class="line"><span class="comment"> * 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常</span></span><br><span class="line"><span class="comment"> * 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式</span></span><br><span class="line"><span class="comment"> * 错误码列表：</span></span><br><span class="line"><span class="comment"> *  10: 通用</span></span><br><span class="line"><span class="comment"> *      001：参数格式校验</span></span><br><span class="line"><span class="comment"> *  11: 商品</span></span><br><span class="line"><span class="comment"> *  12: 订单</span></span><br><span class="line"><span class="comment"> *  13: 购物车</span></span><br><span class="line"><span class="comment"> *  14: 物流</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BizCodeEnume</span> &#123;</span><br><span class="line">    UNKNOW_EXCEPTION(<span class="number">10000</span>,<span class="string">&quot;系统未知异常&quot;</span>),</span><br><span class="line">    VAILD_EXCEPTION(<span class="number">10001</span>,<span class="string">&quot;参数格式校验失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    BizCodeEnume(<span class="type">int</span> code,String msg)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="十、商品服务-amp-属性分组"><a href="#十、商品服务-amp-属性分组" class="headerlink" title="十、商品服务&amp;属性分组"></a>十、商品服务&amp;属性分组</h2><h3 id="10-1-、前端组件抽取-amp-父子组件交互"><a href="#10-1-、前端组件抽取-amp-父子组件交互" class="headerlink" title="10.1 、前端组件抽取 &amp; 父子组件交互"></a>10.1 、前端组件抽取 &amp; 父子组件交互</h3><h4 id="10-1-1-属性分组-效果"><a href="#10-1-1-属性分组-效果" class="headerlink" title="10.1.1 属性分组 - 效果"></a>10.1.1 属性分组 - 效果</h4><p><img src="/image-20201020151047887.png" alt="image-20201020151047887"></p>
<p>左边这个树形空间我们已经写过了，在三级分类的时候编写过，相对应的功能，拖拽，添加，删除等等都已经实现，那我们为什么不把他抽取出一个公共的组件便于其他组件利用？</p>
<p>说干就干！</p>
<p>在 modules 中新建 common 文件夹，在common中 新建 category.vue</p>
<p>category.vue 核心代码</p>
<p>抽取需要的结果，多余的结果进行删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree :data=&quot;menus&quot; :props=&quot;defaultProps&quot; node-key=&quot;catId&quot; ref=&quot;menuTree&quot; @node-click=&quot;nodeClick&quot;&gt;</span><br><span class="line">  &lt;/el-tree&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h4 id="10-1-2-Layout-布局"><a href="#10-1-2-Layout-布局" class="headerlink" title="10.1.2 Layout 布局"></a>10.1.2 Layout 布局</h4><p>通过基础的 24 分栏，迅速简便地创建布局、类似之前学过的bootstrap </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">  &lt;el-col :span=&quot;6&quot;&gt;表格&lt;/el-col&gt;</span><br><span class="line">  &lt;el-col :span=&quot;18&quot;&gt;菜单&lt;/el-col&gt;</span><br><span class="line">&lt;/el-row&gt;</span><br></pre></td></tr></table></figure>

<p>左边放表格，右边放菜单</p>
<p>引入 category 组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&quot;../common/category&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>并且声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//import引入的组件需要注入到对象中才能使用</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    category</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>最后在组件中使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">    &lt;!-- 直接使用--&gt;</span><br><span class="line">   &lt;category @tree-node-click=&quot;treenodeclick&quot;&gt;&lt;/category&gt;</span><br><span class="line"> &lt;/el-col&gt;</span><br></pre></td></tr></table></figure>

<p>右边菜单使用代码生成器的代码直接引入即可</p>
<h4 id="10-1-3-父子组件如何进行交互"><a href="#10-1-3-父子组件如何进行交互" class="headerlink" title="10.1.3 父子组件如何进行交互"></a>10.1.3 父子组件如何进行交互</h4><p>子组件中的 Tree 组件的一个事件  node-click 节点被点击时的回调</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 向父组件发送事件，后面是需要传递的对象，参数等</span></span><br><span class="line"><span class="variable language_">this</span>.$emit(<span class="string">&quot;tree-node-click&quot;</span>,data,node,component)</span><br></pre></td></tr></table></figure>

<p>父组件需要定义相同方法接收</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;category @tree-node-click=&quot;treenodeclick&quot;&gt;&lt;/category&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 感知到节点被点击</span></span><br><span class="line">   <span class="title function_">treenodeclick</span>(<span class="params">node, data, component</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;attrgroup感知到category节点被点击&quot;</span>);</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;刚才被点击的菜单id:&quot;</span> + data.<span class="property">catId</span>);</span><br><span class="line">     <span class="keyword">if</span> (node.<span class="property">level</span> == <span class="number">3</span>) &#123;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">catId</span> = data.<span class="property">catId</span>;</span><br><span class="line">       <span class="variable language_">this</span>.<span class="title function_">getDataList</span>();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>



<h3 id="10-2-、获取属性分类分组"><a href="#10-2-、获取属性分类分组" class="headerlink" title="10.2 、获取属性分类分组"></a>10.2 、获取属性分类分组</h3><p>查看提供的接口文档</p>
<p><img src="/image-20201020153526835.png" alt="image-20201020153526835"></p>
<p>请求参数需要我们带对应的分页参数，所以我们在请求的时候得把参数带上</p>
<p>那就定义接口 go</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 分页请求相关参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId 三级分类id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span>;</span><br></pre></td></tr></table></figure>

<p>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> &#123;</span><br><span class="line">    <span class="comment">// 分类id 等于01 查询全部</span></span><br><span class="line">    <span class="keyword">if</span> (catelogId == <span class="number">0</span>) &#123;</span><br><span class="line">        IPage&lt;AttrGroupEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 拿到参数中的 key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="comment">// 先根据分类id进行查询</span></span><br><span class="line">        QueryWrapper&lt;AttrGroupEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;catelog_id&quot;</span>,catelogId);</span><br><span class="line">        <span class="comment">// selecet * from attrgroup where catelog_id = ? and (attr_group_id = key or like attr_group_name = key)</span></span><br><span class="line">        <span class="comment">// 有时候查询也不会带上key 所以得判断</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            <span class="comment">// where条件后加上 and </span></span><br><span class="line">            wrapper.and((obj) -&gt; &#123;</span><br><span class="line">                obj.eq(<span class="string">&quot;attr_group_id&quot;</span>,key).or().like(<span class="string">&quot;attr_group_name&quot;</span>,key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 组装条件进行查询 </span></span><br><span class="line">        IPage&lt;AttrGroupEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">                wrapper);</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-、分类新增-amp-级联选择器"><a href="#10-3-、分类新增-amp-级联选择器" class="headerlink" title="10.3 、分类新增 &amp; 级联选择器"></a>10.3 、分类新增 &amp; 级联选择器</h3><p>级联选择器是啥？？ 没接触过</p>
<p>官方解释</p>
<p><strong>Cascader 级联选择器</strong></p>
<p>当一个数据集合有清晰的层级结构时，可通过级联选择器逐级查看并选择。</p>
<p>对应效果 </p>
<p><img src="/image-20201020154619941.png" alt="image-20201020154619941"></p>
<p>attrgroup-add-or-update.vue 中 加入该组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  &lt;el-cascader</span><br><span class="line">          v-model=&quot;dataForm.catelogPath&quot;</span><br><span class="line">           placeholder=&quot;试试搜索：手机&quot;</span><br><span class="line">          :options=&quot;categorys&quot;</span><br><span class="line">          :props=&quot;props&quot;</span><br><span class="line">          filterable</span><br><span class="line">        &gt;&lt;/el-cascader&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">placeholder=&quot;试试搜索：手机&quot;默认的搜索提示</span><br><span class="line">:options=&quot;categorys&quot; 可选项数据源，键名可通过 Props 属性配置</span><br><span class="line">:props=&quot;props&quot; 配置选项	</span><br><span class="line"> filterable 是否可搜索选项</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<p>那么问题来了？ 我怎样把数据加载到这个组件里面？</p>
<p>在你组件加载完成后，我在调用方法 ( getCategorys() ) 获取菜单数据，在设置到options不就行了吗？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getCategorys</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.$http(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">adornUrl</span>(<span class="string">&quot;/product/category/list/tree&quot;</span>),</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;get&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">categorys</span> = data.<span class="property">data</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="10-4-、分类修改-amp-回显级联选择器"><a href="#10-4-、分类修改-amp-回显级联选择器" class="headerlink" title="10.4 、分类修改 &amp; 回显级联选择器"></a>10.4 、分类修改 &amp; 回显级联选择器</h3><p>修改和新增用的是一个添加组件 那么我们再点击修改后，你如何把 级联显示的数据再次显示出来？</p>
<p>在 AttrGroup点击修改后，会触发addOrUpdateHandle方法，他会通过引用 vue 文件里的 addOrUpdate 并调用他的 init初始化方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 新增 / 修改</span></span><br><span class="line">   <span class="title function_">addOrUpdateHandle</span>(<span class="params">id</span>) &#123;</span><br><span class="line">     <span class="comment">// 对话框显示</span></span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">addOrUpdateVisible</span> = <span class="literal">true</span>;</span><br><span class="line">     <span class="comment">// 要渲染的组件完成选然后 调用该方法</span></span><br><span class="line">     <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">// this 当前 refs 当前所有组件</span></span><br><span class="line">       <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">addOrUpdate</span>.<span class="title function_">init</span>(id);</span><br><span class="line">     &#125;);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>init执行完成会回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (data &amp;&amp; data.code === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="built_in">this</span>.dataForm.attrGroupName = data.attrGroup.attrGroupName;</span><br><span class="line">              <span class="built_in">this</span>.dataForm.sort = data.attrGroup.sort;</span><br><span class="line">              <span class="built_in">this</span>.dataForm.descript = data.attrGroup.descript;</span><br><span class="line">              <span class="built_in">this</span>.dataForm.icon = data.attrGroup.icon;</span><br><span class="line">              <span class="built_in">this</span>.dataForm.catelogId = data.attrGroup.catelogId;</span><br><span class="line">                <span class="comment">// 设置 级联的路径 从数据中取</span></span><br><span class="line">              <span class="built_in">this</span>.dataForm.catelogPath = data.attrGroup.catelogPath;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br></pre></td></tr></table></figure>

<p>后端如何根据分组id 查询出 对应的分类？定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 找到catelogId的完整路径</span></span><br><span class="line"><span class="comment"> * 【父/子/孙】</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Long[] findCatelogPath(Long catelogId);</span><br></pre></td></tr></table></figure>

<p>实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Long[] findCatelogPath(Long catelogId) &#123;</span><br><span class="line">    List&lt;Long&gt; paths = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Long&gt; parentPath = findParentPath(catelogId, paths);</span><br><span class="line">    <span class="comment">// 反转</span></span><br><span class="line">    Collections.reverse(parentPath);</span><br><span class="line">    <span class="comment">//转成Long[] 数组返回</span></span><br><span class="line">    <span class="keyword">return</span> parentPath.toArray(<span class="keyword">new</span> <span class="title class_">Long</span>[parentPath.size()]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId 三级分类的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> paths 路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Long&gt; <span class="title function_">findParentPath</span><span class="params">(Long catelogId,List&lt;Long&gt; paths)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、收集当前节点id</span></span><br><span class="line">    paths.add(catelogId);</span><br><span class="line">    <span class="comment">// 2、通过分类id拿到 Category 对象</span></span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(catelogId);</span><br><span class="line">    <span class="comment">// 3、如果不是根节点 就一直递归下去查找</span></span><br><span class="line">    <span class="keyword">if</span> (byId.getParentCid() != <span class="number">0</span>) &#123;</span><br><span class="line">        findParentPath(byId.getParentCid(),paths);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> paths;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 AttrGroupEntity 中 添加了一个新属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于存放 级联显示的 父子孙的地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span> <span class="comment">// 标注为false 表是不是数据库字段</span></span><br><span class="line"><span class="keyword">private</span> Long[] catelogPath;</span><br></pre></td></tr></table></figure>

<p>Controller 具体设置返回数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 信息</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@RequestMapping(&quot;/info/&#123;attrGroupId&#125;&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrGroupId&quot;)</span> Long attrGroupId)</span>&#123;</span><br><span class="line">     <span class="comment">// 根据id查询出 分组group对象</span></span><br><span class="line"><span class="type">AttrGroupEntity</span> <span class="variable">attrGroup</span> <span class="operator">=</span> attrGroupService.getById(attrGroupId);</span><br><span class="line"><span class="comment">// 拿到分类id</span></span><br><span class="line">     <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroup.getCatelogId();</span><br><span class="line">     <span class="comment">// 根据分类id查询出 他的 父 子 孙 对应的数据,并且设置到 attrGroup对象</span></span><br><span class="line">     Long[] catelogPath = categoryService.findCatelogPath(catelogId);</span><br><span class="line">     attrGroup.setCatelogPath(catelogPath);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attrGroup&quot;</span>, attrGroup);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-5、品牌分类关联与级联更新"><a href="#10-5、品牌分类关联与级联更新" class="headerlink" title="10.5、品牌分类关联与级联更新"></a>10.5、品牌分类关联与级联更新</h3><h4 id="10-5-1、实现品牌管理搜索"><a href="#10-5-1、实现品牌管理搜索" class="headerlink" title="10.5.1、实现品牌管理搜索"></a>10.5.1、实现品牌管理搜索</h4><p><img src="/image-20201020120929362.png" alt="image-20201020120929362"></p>
<p>在原本查询中加入新功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">       <span class="comment">// 1、获取key</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">       QueryWrapper&lt;BrandEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">// key不为空 brand_id 和 name 进行值匹配 </span></span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">           wrapper.eq(<span class="string">&quot;brand_id&quot;</span>,key).or().like(<span class="string">&quot;name&quot;</span>,key);</span><br><span class="line">       &#125;</span><br><span class="line">       IPage&lt;BrandEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">Query</span>&lt;BrandEntity&gt;().getPage(params),</span><br><span class="line">               wrapper</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>我们是直接把数据表存进了中间表,如果在真正的品牌名和分类名进行了修改，那么此时中间表的数据就是不对的，这时候数据就不是一致性</p>
<p>解决</p>
<p>在进行修改的时候，也要把中间表的数据进行更改</p>
<p>Brand</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// BrandController</span></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">      /**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@Validated(UpdateGroup.class)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line"></span><br><span class="line">		brandService.updateDetail(brand);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Service</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateDetail</span><span class="params">(BrandEntity brand)</span> &#123;</span><br><span class="line">    <span class="comment">// 保证字段一致</span></span><br><span class="line">    <span class="comment">// 根据id更改</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(brand);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brand.getName())) &#123;</span><br><span class="line">        <span class="comment">// 同步更新其他关联表中的数据</span></span><br><span class="line">        categoryBrandRelationService.updateBrand(brand.getBrandId(),brand.getName());</span><br><span class="line">        <span class="comment">// TODO 更新其他关联</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Service实现类</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBrand</span><span class="params">(Long brandId, String name)</span> &#123;</span><br><span class="line">        <span class="type">CategoryBrandRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategoryBrandRelationEntity</span>();</span><br><span class="line">        relationEntity.setBrandName(name);</span><br><span class="line">        relationEntity.setBrandId(brandId);</span><br><span class="line">        <span class="built_in">this</span>.update(relationEntity,<span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>,brandId));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Category</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCascate</span><span class="params">(CategoryEntity category)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.updateById(category);</span><br><span class="line">    categoryBrandRelationService.updateCategory(category.getCatId(),category.getName());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Service </span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCascate</span><span class="params">(CategoryEntity category)</span> &#123;</span><br><span class="line">        <span class="comment">// 更新自己表对象</span></span><br><span class="line">        <span class="built_in">this</span>.updateById(category);</span><br><span class="line">        <span class="comment">// 更新关联表对象</span></span><br><span class="line">        categoryBrandRelationService.updateCategory(category.getCatId(),category.getName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="十一、商品服务-amp-平台属性"><a href="#十一、商品服务-amp-平台属性" class="headerlink" title="十一、商品服务&amp;平台属性"></a>十一、商品服务&amp;平台属性</h2><h3 id="11-1-规格参数新增与VO"><a href="#11-1-规格参数新增与VO" class="headerlink" title="11.1 规格参数新增与VO"></a>11.1 规格参数新增与VO</h3><h4 id="11-1-1-获取分类规格参数"><a href="#11-1-1-获取分类规格参数" class="headerlink" title="11.1.1 获取分类规格参数"></a>11.1.1 获取分类规格参数</h4><p><strong>具体需求：</strong></p>
<p>查询的数据没有分类和分组</p>
<p><img src="/image-20201021051239049.png" alt="image-20201021051239049"></p>
<p>属性分类 和 所属分组居然没有数据？</p>
<p>先查看返回的数据</p>
<p><img src="/image-20201021051433485.png" alt="image-20201021051433485"></p>
<p>发现没有 catelogName 和 AttrGroupName 的数据！！ 原因是 AttrEntity没有这两个属性</p>
<p><img src="/image-20201021051653178.png" alt="image-20201021051653178"></p>
<p>但是他关联了 pms_attr_attrgroup_relation 表 这个表里面有 attr_Group_id 那么思路来了？</p>
<p>1、我先用 attr_id 去 pms_attr_attrgroup_relation中查询出 attr_Group_id 然后通过 attr_Group_id去pms_attr_group 表中查询出 分组的名称</p>
<p>2、自身 attr表中有 catelog_id 那我根据这个id去 category表中查询到 分类的姓名 不就行了吗？</p>
<p>上代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catelog_id&quot;</span>,catelogId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((wrapper1) -&gt; &#123;</span><br><span class="line">            wrapper1.eq(<span class="string">&quot;attr_id&quot;</span>,key).or().like(<span class="string">&quot;attr_name&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拿到分页记录</span></span><br><span class="line">    List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line"></span><br><span class="line">    List&lt;AttrRespVo&gt; respVo = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、设置分类和分组的名字</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attr_idEntity</span> <span class="operator">=</span> relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (attr_idEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attr_idEntity.getAttrGroupId());</span><br><span class="line">            attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">        <span class="keyword">if</span> (categoryEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> attrRespVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    pageUtils.setList(respVo);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是原先的 AttrEntity 对象里面任然没有这两个属性 ! 怎么解决</p>
<p>1、我直接在 AttrEntity中新建对应的字段不就行了吗？ 然后设置成不是数据库的字段</p>
<p>缺点：<strong>这样子是不是太乱了？</strong></p>
<p>2、新建一个 VO 抽取出这两个属性 不就行了吗？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrRespVo</span> <span class="keyword">extends</span> <span class="title class_">AttrVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * catelogName 手机数码，所属分类名字</span></span><br><span class="line"><span class="comment">     * groupName 主体 所属分组名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="11-2-规格参数列表-amp-规格修改"><a href="#11-2-规格参数列表-amp-规格修改" class="headerlink" title="11.2 规格参数列表&amp;规格修改"></a>11.2 规格参数列表&amp;规格修改</h3><h5 id="11-2-1、获取分类规格参数"><a href="#11-2-1、获取分类规格参数" class="headerlink" title="11.2.1、获取分类规格参数"></a>11.2.1、获取分类规格参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取分类规格参数</span></span><br><span class="line"><span class="comment"> 	attrType 和 catelogId 通用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type  sale 销售属性 base 规格参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrType&#125;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">baseAttrList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String,Object&gt; params</span></span><br><span class="line"><span class="params">        ,<span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId,</span></span><br><span class="line"><span class="params">                      <span class="meta">@PathVariable(&quot;attrType&quot;)</span> String  type)</span> &#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.queryBaseAttrPage(params,catelogId,type);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> PageUtils <span class="title function_">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId, String type)</span> &#123;</span><br><span class="line">       <span class="comment">// 先根据 attr_type字段进行查询 该字段表示 1是基本属性 0是销售属性，基本属性和销售属性我们放在一张表内</span></span><br><span class="line">       QueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;()</span><br><span class="line">               .eq(<span class="string">&quot;attr_type&quot;</span>,<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(type)?</span><br><span class="line">                       ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode():</span><br><span class="line">                       ProductConstant.AttrEnum.ATTR_TYPE_SALE.getCode());</span><br><span class="line">       <span class="comment">// 分类id不等于0 按照分类id进行查询</span></span><br><span class="line">       <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">           wrapper.eq(<span class="string">&quot;catelog_id&quot;</span>,catelogId);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 取出参数 key,进行条件查询</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">           wrapper.and((wrapper1) -&gt; &#123;</span><br><span class="line">               wrapper1.eq(<span class="string">&quot;attr_id&quot;</span>,key).or().like(<span class="string">&quot;attr_name&quot;</span>,key);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 封装分页数据</span></span><br><span class="line">       IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">               wrapper</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 拿到全部的分页记录</span></span><br><span class="line">       List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">       <span class="comment">// 查询所属分类以及所属分组</span></span><br><span class="line">       List&lt;AttrRespVo&gt; respVo = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line">           <span class="comment">// 实例化数据传输对象 将 attrEntity的分类名字以及分组名字 复制到该对象</span></span><br><span class="line">           <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">           BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line">           <span class="comment">// Controller地址如果是 基础 才进行查询分裂</span></span><br><span class="line">           <span class="keyword">if</span>(<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(type))&#123;</span><br><span class="line">               <span class="comment">// 1、根据attr_id 查询到 attr和 attrGroup的关系表</span></span><br><span class="line">               <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attr_idEntity</span> <span class="operator">=</span> relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">                       .eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">               <span class="comment">//查询到的关系对象以及分组id不为空</span></span><br><span class="line">               <span class="keyword">if</span> (attr_idEntity != <span class="literal">null</span> &amp;&amp; attr_idEntity.getAttrGroupId()!=<span class="literal">null</span>) &#123;</span><br><span class="line">                   <span class="comment">// 根据分组id查询到分组信息</span></span><br><span class="line">                   <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attr_idEntity.getAttrGroupId());</span><br><span class="line">                   attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">// 根据attrEntity的分类id 查询到分类对象并设置分类姓名</span></span><br><span class="line">           <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">           <span class="keyword">if</span> (categoryEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">               attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> attrRespVo;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line">       <span class="comment">//封装到分页工具类</span></span><br><span class="line">       pageUtils.setList(respVo);</span><br><span class="line">       <span class="keyword">return</span> pageUtils;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>先是根据 <code>catelog_id</code>查询到<code>AttrEntity</code> 对象 该对象里拥有 <code>attr_id</code> 然后根据attr_id 去 <code>pms_attr_attrgroup_relation</code>表进行查询</p>
<h5 id="11-2-2、查询属性详情"><a href="#11-2-2、查询属性详情" class="headerlink" title="11.2.2、查询属性详情"></a>11.2.2、查询属性详情</h5><p><img src="/image-20201022154745658.png" alt="image-20201022154745658"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span>&#123;</span><br><span class="line"><span class="type">AttrRespVo</span> <span class="variable">attr</span> <span class="operator">=</span> attrService.getAttrInfo(attrId);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, attr);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Service 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AttrRespVo <span class="title function_">getAttrInfo</span><span class="params">(Long attrId)</span> &#123;</span><br><span class="line">    <span class="comment">// 实例化封装VO数据对象</span></span><br><span class="line">    <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">    <span class="comment">// 根据attrid查询出商品属性</span></span><br><span class="line">    <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrId);</span><br><span class="line">    <span class="comment">// 将商品属性对象的属性复制到 VO数据对象</span></span><br><span class="line">    BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  attrType == 1为基本类型才进行查询分组信息</span></span><br><span class="line">    <span class="keyword">if</span> (attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode()) &#123;</span><br><span class="line">        <span class="comment">// 根据 attr_id 查询到 商品属性以及商品分组关系表</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;attr_id&quot;</span>, attrId));</span><br><span class="line">        <span class="keyword">if</span> (relationEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置分组id</span></span><br><span class="line">            attrRespVo.setAttrGroupId(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="comment">// 分组&amp;商品信息关系表拿到分组id 查询到分组对象</span></span><br><span class="line">            <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(relationEntity.getAttrGroupId());</span><br><span class="line">            <span class="keyword">if</span> (attrGroupEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//不为空设置分组姓名</span></span><br><span class="line">                attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从当前商品属性对象中拿到分类id进行设置分类信息</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrEntity.getCatelogId();</span><br><span class="line">    <span class="comment">// 根据 catelogId 查询到分类 父 子 孙 路径</span></span><br><span class="line">    Long[] catelogPath = categoryService.findCatelogPath(catelogId);</span><br><span class="line">    attrRespVo.setCatelogPath(catelogPath);</span><br><span class="line">    <span class="comment">//最后根据分类id 查询到分类对象 并进行设置分类姓名</span></span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryService.getById(catelogId);</span><br><span class="line">    <span class="keyword">if</span> (categoryEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">        attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> attrRespVo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要理解： 先是根据 <code>attrId</code> 查询到<strong>商品属性</strong>  然后根据 attrId 查询到<strong>分类关系表</strong> 该表中有分组id attrGroup_id 通过这个查询到 <strong>分组对象信息</strong>，</p>
<p>，同时在 商品属性表中拿到 分类id 通过<strong>分类id 查询到 查询到分类对象</strong> 同时根据 分类id查询对应层级关系，并设置<strong>分类姓名</strong></p>
<h5 id="11-3-3、销售属性"><a href="#11-3-3、销售属性" class="headerlink" title="11.3.3、销售属性"></a>11.3.3、销售属性</h5><p><img src="/image-20201022155557579.png" alt="image-20201022155557579"></p>
<p>销售属性 和 基本属性 通过一个字段来区分，对应的修改，查询 都用的同一个方法，所以在方法的中 也进行了对应的判断</p>
<p>保存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">    <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">    <span class="comment">// 保存基本数据</span></span><br><span class="line">    <span class="built_in">this</span>.save(attrEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、保存关联关系</span></span><br><span class="line">    <span class="comment">// 等于1 说明基本属性 才进行保存分组关系</span></span><br><span class="line">    <span class="keyword">if</span> (attr.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode() &amp;&amp; attr.getAttrGroupId() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">        relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">        relationEntity.setAttrId(attrEntity.getAttrId());</span><br><span class="line">        relationDao.insert(relationEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">       <span class="comment">// Vo数据传输对象属性拷贝到 attrEntity对象</span></span><br><span class="line">       <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">       BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">       <span class="built_in">this</span>.updateById(attrEntity);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// attrType 等于 1 也就是基本属性</span></span><br><span class="line">       <span class="keyword">if</span> (attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode()) &#123;</span><br><span class="line">           <span class="comment">//1、修改分组关联</span></span><br><span class="line">           <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">           <span class="comment">// 设置attrid 以及 分组id</span></span><br><span class="line">           relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line">           relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">           <span class="comment">// 关系表中根据attr_id 进行更新</span></span><br><span class="line">           relationDao.update(relationEntity, <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().</span><br><span class="line">                   eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">           <span class="comment">// 根据 attr_id 是否可以查询到结果</span></span><br><span class="line">           <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> relationDao.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().</span><br><span class="line">                   eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">           </span><br><span class="line">           <span class="comment">// 查得到</span></span><br><span class="line">           <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="comment">// 进行更新</span></span><br><span class="line">               relationDao.update(relationEntity, <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().</span><br><span class="line">                       eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// 查不到意味着 没有该记录 则进行插入</span></span><br><span class="line">               relationDao.insert(relationEntity);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-3-查询分类关联属性-amp-删除关联-amp-查询分组未关联属性"><a href="#11-3-查询分类关联属性-amp-删除关联-amp-查询分组未关联属性" class="headerlink" title="11.3 查询分类关联属性&amp;删除关联&amp;查询分组未关联属性"></a>11.3 查询分类关联属性&amp;删除关联&amp;查询分组未关联属性</h3><h5 id="11-3-1、获取属性分组的关联的所有属性"><a href="#11-3-1、获取属性分组的关联的所有属性" class="headerlink" title="11.3.1、获取属性分组的关联的所有属性"></a>11.3.1、获取属性分组的关联的所有属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取属性分组的关联的所有属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/attr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId)</span> &#123;</span><br><span class="line">    List&lt;AttrEntity&gt; entityList = attrService.getRelationAttr(attrgroupId);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, entityList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据分组id查找关联的所有基本属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title function_">getRelationAttr</span><span class="params">(Long attrgroupId)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据attr_group_id 查询到 关系表</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; entities = relationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">            .eq(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从关系表中 取到 属性id</span></span><br><span class="line">    List&lt;Long&gt; attrIds = entities.stream().map((attr) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> attr.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">if</span> (attrIds == <span class="literal">null</span> || attrIds.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 按照属性id进行查询</span></span><br><span class="line">    Collection&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.listByIds(attrIds);</span><br><span class="line">    <span class="keyword">return</span> (List&lt;AttrEntity&gt;) attrEntities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/image-20201022161654834.png" alt="image-20201022161654834"></p>
<p>已知有参数 attr_group_id 进行查询 能查到 attr_id,在利用 attr_id 查询到 attr相关信息</p>
<h5 id="11-3-2、删除属性与分组的关联关系"><a href="#11-3-2、删除属性与分组的关联关系" class="headerlink" title="11.3.2、删除属性与分组的关联关系"></a>11.3.2、删除属性与分组的关联关系</h5><p><img src="/image-20201022162103501.png" alt="image-20201022162103501"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除属性与分组的关联关系</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> relationVo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">deleteRelation</span><span class="params">(<span class="meta">@RequestBody</span> AttrGroupRelationVo[] relationVo)</span> &#123;</span><br><span class="line">    attrService.deleteRelation(relationVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRelation</span><span class="params">(AttrGroupRelationVo[] relationVo)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 转成 list 进行stream流处理</span></span><br><span class="line">       List&lt;AttrAttrgroupRelationEntity&gt; entities = Arrays.asList(relationVo).stream().map((item) -&gt; &#123;</span><br><span class="line">           <span class="comment">// 将 item对应属性拷贝到 relationEntity对象中</span></span><br><span class="line">           <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">           BeanUtils.copyProperties(item, relationEntity);</span><br><span class="line">           <span class="keyword">return</span> relationEntity;</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line">       <span class="comment">// id批量删除</span></span><br><span class="line">       relationDao.deleteBatchRelation(entities);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>deleteBatchRelation 方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchRelation&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM `pms_attr_attrgroup_relation` WHERE </span><br><span class="line">    &lt;!- 循环遍历进行删除 使用的是 or--&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;entities&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot; OR &quot;</span>&gt;</span></span><br><span class="line">        ( attr_id=#&#123;item.attrId&#125; AND attr_group_id=#&#123;item.attrGroupId&#125; )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h5 id="11-3-3、查询分组未关联属性"><a href="#11-3-3、查询分组未关联属性" class="headerlink" title="11.3.3、查询分组未关联属性"></a>11.3.3、查询分组未关联属性</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/noattr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrNoRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.getNoRelationAttr(params,attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">getNoRelationAttr</span><span class="params">(Map&lt;String, Object&gt; params, Long attrgroupId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、当前分组只能关联自己所属分类里面的所有属性</span></span><br><span class="line">    <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrgroupId);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroupEntity.getCatelogId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、当前分组只能关联别的分组没有引用的属性</span></span><br><span class="line">    <span class="comment">//2.1 当前分类下的 **其他分组** 根据分类id进行查询</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; group = attrGroupDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;()</span><br><span class="line">            .eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line">    <span class="comment">// 拿到分组id</span></span><br><span class="line">    List&lt;Long&gt; collect = group.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrGroupId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2 这些分组关联的属性  根据分组id查询出关联表</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; groupId = relationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;()</span><br><span class="line">            .in(<span class="string">&quot;attr_group_id&quot;</span>, collect));</span><br><span class="line">    <span class="comment">// 拿到所有的属性id</span></span><br><span class="line">    List&lt;Long&gt; attrIds = groupId.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.3 从当前分类的所有属性中移除这些属性</span></span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;()</span><br><span class="line">            .eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId)</span><br><span class="line">            .eq(<span class="string">&quot;attr_type&quot;</span>, ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// attrIds 属性id数组不为空</span></span><br><span class="line">    <span class="keyword">if</span> (attrIds != <span class="literal">null</span> &amp;&amp; attrIds.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 在attrids 数组中得id不用进行查询</span></span><br><span class="line">        wrapper.notIn(<span class="string">&quot;attr_id&quot;</span>, attrIds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取出参数进行 对应条件查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt; &#123;</span><br><span class="line">            w.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据分页数据 以及 wrapper进行查询</span></span><br><span class="line">    IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params), wrapper);</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="11-4-4、新增分组与属性关联"><a href="#11-4-4、新增分组与属性关联" class="headerlink" title="11.4.4、新增分组与属性关联"></a>11.4.4、新增分组与属性关联</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span>  R <span class="title function_">addRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrGroupRelationVo&gt; attrGroupRelationVo)</span> &#123;</span><br><span class="line">    attrAttrgroupRelationService.saveBatch(attrGroupRelationVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveBatch</span><span class="params">(List&lt;AttrGroupRelationVo&gt; attrGroupRelationVo)</span> &#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; collect = attrGroupRelationVo.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 复制属性 返回</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(item, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>业务之间需要多种测试 各种判断 	</p>
<h2 id="十二、商品服务-amp-新增商品"><a href="#十二、商品服务-amp-新增商品" class="headerlink" title="十二、商品服务&amp;新增商品"></a>十二、商品服务&amp;新增商品</h2><h3 id="12-1-获取分类关联的品牌"><a href="#12-1-获取分类关联的品牌" class="headerlink" title="12.1 获取分类关联的品牌"></a>12.1 获取分类关联的品牌</h3><p><img src="/image-20201023052252280.png" alt="image-20201023052252280"></p>
<p>前端发送请求</p>
<p><img src="/image-20201023052320519.png" alt="image-20201023052320519"></p>
<p>后端编写：</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  获取分类关联的品牌</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/brands/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">relationBrandList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;catId&quot;,required = true)</span> Long catId)</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;BrandEntity&gt; vos = categoryBrandRelationService.getBrandCatId(catId);</span><br><span class="line">    <span class="comment">//拿到 品牌对象数据后 从中抽取除 品牌姓名和id</span></span><br><span class="line">    List&lt;BrandVo&gt; collect = vos.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="type">BrandVo</span> <span class="variable">brandVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandVo</span>();</span><br><span class="line">        brandVo.setBrandId(item.getBrandId());</span><br><span class="line">        brandVo.setBrandName(item.getName());</span><br><span class="line">        <span class="keyword">return</span> brandVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;BrandEntity&gt; <span class="title function_">getBrandCatId</span><span class="params">(Long catId)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据分类id查询出 分类和品牌的关系表</span></span><br><span class="line">    List&lt;CategoryBrandRelationEntity&gt; catelogId = categoryBrandRelationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catId));</span><br><span class="line"></span><br><span class="line">    List&lt;BrandEntity&gt; collect = catelogId.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="comment">//根据品牌id查询出品牌对象</span></span><br><span class="line">        <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> brandDao.selectById(item.getBrandId());</span><br><span class="line">        <span class="keyword">return</span> brandEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>总结：</p>
</blockquote>
<p>业务操作设计两个表</p>
<ul>
<li>pms_brand</li>
<li>pms_category_brand_relation</li>
</ul>
<p>请求参数是 CatId Long类型</p>
<ul>
<li>先根据 CatId 在 pms_category_brand_relation表中查询到品牌 Id </li>
<li>拿到 brand_id 查询出 brand 的相关信息</li>
<li>组装成 BrandVo 后 返回</li>
</ul>
<p><img src="/image-20201023052748618.png" alt="image-20201023052748618"></p>
<h3 id="12-2-获取分类下所有分组以及属性"><a href="#12-2-获取分类下所有分组以及属性" class="headerlink" title="12.2 获取分类下所有分组以及属性"></a>12.2 获取分类下所有分组以及属性</h3><p><img src="/image-20201023072959266.png" alt="image-20201023072959266"></p>
<p>基本信息输入成功后，就会跳转到规格参数，</p>
<p>并根据分类id查询出对应数据</p>
<p><img src="/image-20201023073041272.png" alt="image-20201023073041272"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  获取分类下所有分组&amp;关联属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&#123;catelogId&#125;/withattr&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">getAttrGroupWithAttrs</span><span class="params">(<span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span>   &#123;</span><br><span class="line">    List&lt;AttrGroupWithAttrsVo&gt; vos = attrGroupService.getAttrGroupWithAttrsByCatelogId(catelogId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,vos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AttrGroupWithAttrsVo&gt; <span class="title function_">getAttrGroupWithAttrsByCatelogId</span><span class="params">(Long catelogId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、根据分类id查询出 查询分组关系</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; attrgroupEntites = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line"></span><br><span class="line">    List&lt;AttrGroupWithAttrsVo&gt; collect = attrgroupEntites.stream().map(group -&gt; &#123;</span><br><span class="line">        <span class="type">AttrGroupWithAttrsVo</span> <span class="variable">attrsVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrGroupWithAttrsVo</span>();</span><br><span class="line">        <span class="comment">// 2、将分组属性拷贝到 VO中</span></span><br><span class="line">        BeanUtils.copyProperties(group, attrsVo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、通过分组id查询出 商品属性信息</span></span><br><span class="line">        <span class="comment">// 调用 getRelationAttr方法先根据 分组id去 中间关系表查询到商品属性id 然后根据商品属性id查询到商品信息</span></span><br><span class="line">        List&lt;AttrEntity&gt; relationAttr = attrService.getRelationAttr(attrsVo.getAttrGroupId());</span><br><span class="line">        attrsVo.setAttrs(relationAttr);</span><br><span class="line">        <span class="keyword">return</span> attrsVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> collect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="12-3-商品-VO-抽取-amp-商品新增业务流程"><a href="#12-3-商品-VO-抽取-amp-商品新增业务流程" class="headerlink" title="12.3 商品 VO 抽取&amp;商品新增业务流程"></a>12.3 商品 VO 抽取&amp;商品新增业务流程</h3><p>商品属性、销售属性、规格参数、基本信息都填好了后就会生成一串 JSON</p>
<p><img src="/image-20201023080411308.png" alt="image-20201023080411308"></p>
<p>我们将 json 放到 json解析网站上 并生成对应得实体类</p>
<p><img src="/image-20201023080500520.png" alt="image-20201023080500520"></p>
<h4 id="12-3-4-封装-Vo-中，更改对应得属性"><a href="#12-3-4-封装-Vo-中，更改对应得属性" class="headerlink" title="12.3.4 封装 Vo 中，更改对应得属性"></a>12.3.4 封装 Vo 中，更改对应得属性</h4><p><img src="/image-20201023081250886.png" alt="image-20201023081250886"></p>
<p>有些参与计算的属性 如 int price 将类型更改为 BigDecimal </p>
<h4 id="12-3-5-分析业务流程"><a href="#12-3-5-分析业务流程" class="headerlink" title="12.3.5 分析业务流程"></a>12.3.5 分析业务流程</h4><blockquote>
<p>业务流程:</p>
</blockquote>
<p><img src="/image-20201024112115137.png" alt="image-20201024112115137"></p>
<h4 id="12-3-6-主要编码！"><a href="#12-3-6-主要编码！" class="headerlink" title="12.3.6 主要编码！"></a>12.3.6 主要编码！</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、保存Spu基本信息  pms_spu_info</span></span><br><span class="line">    <span class="type">SpuInfoEntity</span> <span class="variable">spuInfoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(vo,spuInfoEntity);</span><br><span class="line">    spuInfoEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    spuInfoEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.saveBaseSpuInfo(spuInfoEntity);</span><br><span class="line">    <span class="comment">// 2、保存Spu的描述信息  pms_spu_info_desc</span></span><br><span class="line">    List&lt;String&gt; decript = vo.getDecript();</span><br><span class="line">    <span class="type">SpuInfoDescEntity</span> <span class="variable">spuInfoDescEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoDescEntity</span>();</span><br><span class="line">    <span class="comment">// SpuInfoEntity保存到取得 spuId 设置到 Desc中</span></span><br><span class="line">    spuInfoDescEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">    <span class="comment">// 以逗号来拆分</span></span><br><span class="line">    spuInfoDescEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>,decript));</span><br><span class="line">    spuInfoDescService.saveSpuInfoDesc(spuInfoDescEntity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、保存Spu的图片集 pms_spu_images</span></span><br><span class="line">    List&lt;String&gt; imageList = vo.getImages();</span><br><span class="line">    spuImagesService.saveImages(spuInfoEntity.getId(),imageList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4、保存spu的规格参数 pms_product_attr_value</span></span><br><span class="line">    List&lt;BaseAttrs&gt; baseAttrs = vo.getBaseAttrs();</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">        <span class="comment">// 设置 spu 属性值</span></span><br><span class="line">        <span class="type">ProductAttrValueEntity</span> <span class="variable">valueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductAttrValueEntity</span>();</span><br><span class="line">        valueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> attrService.getById(attr.getAttrId());</span><br><span class="line">        valueEntity.setAttrName(attrEntity.getAttrName());</span><br><span class="line">        valueEntity.setSpuId(spuInfoEntity.getId());</span><br><span class="line">        valueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">        valueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">        <span class="keyword">return</span> valueEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    attrValueService.saveProductAttr(collect);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5、保存SPU的积分信息 gulimall_sms sms =&gt; sms_spu_bounds</span></span><br><span class="line">    <span class="type">Bounds</span> <span class="variable">bounds</span> <span class="operator">=</span> vo.getBounds();</span><br><span class="line">    <span class="type">SpuBoundTo</span> <span class="variable">spuBoundTo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuBoundTo</span>();</span><br><span class="line">    BeanUtils.copyProperties(bounds,spuBoundTo);</span><br><span class="line">    spuBoundTo.setSpuId(spuInfoEntity.getId());</span><br><span class="line">    <span class="comment">// 远程服务调用</span></span><br><span class="line">    <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> couponFeignService.saveSpuBounds(spuBoundTo);</span><br><span class="line">    <span class="keyword">if</span> (r.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;远程保存优惠信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5、保存当前Spu对应的所有SKU信息</span></span><br><span class="line">    List&lt;Skus&gt; skus = vo.getSkus();</span><br><span class="line">    <span class="keyword">if</span> (skus != <span class="literal">null</span> &amp;&amp; skus.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 遍历 skus 集合</span></span><br><span class="line">        skus.forEach(item -&gt;&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">defaultImage</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="comment">// 遍历 skus 集合中的图片 </span></span><br><span class="line">            <span class="keyword">for</span> (Images image : item.getImages()) &#123;</span><br><span class="line">                <span class="comment">// 默认图片等于 1 该记录则是默认图片</span></span><br><span class="line">                <span class="keyword">if</span> (image.getDefaultImg() == <span class="number">1</span>) &#123;</span><br><span class="line">                    defaultImage = image.getImgUrl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// private String skuName;</span></span><br><span class="line">            <span class="comment">//    private String price;</span></span><br><span class="line">            <span class="comment">//    private String skuTitle;</span></span><br><span class="line">            <span class="comment">//    private String skuSubtitle;</span></span><br><span class="line">            <span class="comment">// 只有上面4个属性相同</span></span><br><span class="line">            <span class="type">SkuInfoEntity</span> <span class="variable">skuInfoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuInfoEntity</span>();</span><br><span class="line">            BeanUtils.copyProperties(item,skuInfoEntity);</span><br><span class="line">            <span class="comment">// 其他属性需要自己赋值</span></span><br><span class="line">            skuInfoEntity.setBrandId(spuInfoEntity.getBrandId());</span><br><span class="line">            skuInfoEntity.setCatalogId(spuInfoEntity.getCatalogId());</span><br><span class="line">            skuInfoEntity.setSaleCount(<span class="number">0L</span>);</span><br><span class="line">            skuInfoEntity.setSpuId(spuInfoDescEntity.getSpuId());</span><br><span class="line">            skuInfoEntity.setSkuDefaultImg(defaultImage);</span><br><span class="line">            <span class="comment">//5.1、SKU的基本信息 pms_sku_info</span></span><br><span class="line">            skuInfoService.saveSkuInfo(skuInfoEntity);</span><br><span class="line"></span><br><span class="line">            <span class="type">Long</span> <span class="variable">skuId</span> <span class="operator">=</span> skuInfoEntity.getSkuId();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存 sku 图片信息</span></span><br><span class="line">            List&lt;SkuImagesEntity&gt; imagesEntities = item.getImages().stream().map(img -&gt; &#123;</span><br><span class="line">                <span class="type">SkuImagesEntity</span> <span class="variable">skuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuImagesEntity</span>();</span><br><span class="line">                skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                skuImagesEntity.setImgUrl(img.getImgUrl());</span><br><span class="line">                skuImagesEntity.setDefaultImg(img.getDefaultImg());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">            &#125;).filter(entity -&gt;&#123;</span><br><span class="line">                <span class="comment">//返回 true 需要 false 过滤</span></span><br><span class="line">                <span class="keyword">return</span> !StringUtils.isEmpty(entity.getImgUrl());</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// TODO 没有图片路径的无需保存</span></span><br><span class="line">            <span class="comment">//5.2、SKU的图片信息 pms_sku_images</span></span><br><span class="line">            skuImagesService.saveBatch(imagesEntities);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            List&lt;Attr&gt; attr = item.getAttr();</span><br><span class="line">            <span class="comment">// 保存 sku 销售属性</span></span><br><span class="line">            List&lt;SkuSaleAttrValueEntity&gt; skuSaleAttrValueEntities = attr.stream().map(a -&gt; &#123;</span><br><span class="line">                <span class="type">SkuSaleAttrValueEntity</span> <span class="variable">skuSaleAttrValueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuSaleAttrValueEntity</span>();</span><br><span class="line">                BeanUtils.copyProperties(a, skuSaleAttrValueEntity);</span><br><span class="line">                skuSaleAttrValueEntity.setSkuId(skuId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> skuSaleAttrValueEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//5.3、SKU的销售属性信息 pms_sku_sale_attr_value</span></span><br><span class="line">            saleAttrValueService.saveBatch(skuSaleAttrValueEntities);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5.4、SKU的优惠、满减等信息 gulimall_sms -&gt;sms_sku_ladder \sms_sku_full_reduction\sms_member_price</span></span><br><span class="line"></span><br><span class="line">            <span class="type">SkuReductionTo</span> <span class="variable">skuReductionTo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuReductionTo</span>();</span><br><span class="line">            BeanUtils.copyProperties(item,skuReductionTo);</span><br><span class="line">            skuReductionTo.setSkuId(skuId);</span><br><span class="line">            <span class="keyword">if</span> (skuReductionTo.getFullCount() &gt; <span class="number">0</span> || skuReductionTo.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> couponFeignService.saveSkuReduction(skuReductionTo);</span><br><span class="line">                <span class="keyword">if</span> (r1.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存sku优惠信息失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>saveImages</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveImages</span><span class="params">(Long id, List&lt;String&gt; imageList)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (imageList == <span class="literal">null</span> || imageList.size() &lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;图片为空！！！！！！&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        List&lt;SpuImagesEntity&gt; collect = imageList.stream().map(img -&gt; &#123;</span><br><span class="line">            <span class="type">SpuImagesEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuImagesEntity</span>();</span><br><span class="line">            <span class="comment">// 设置主要属性 </span></span><br><span class="line">            entity.setSpuId(id);</span><br><span class="line">            entity.setImgUrl(img);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> entity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="built_in">this</span>.saveBatch(collect );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>远程服务调用 对应方法</p>
<p>保存了 <strong>商品阶梯价格</strong>、<strong>商品满减信息</strong>、<strong>商品会员价格</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSkuReduction</span><span class="params">(SkuReductionTo skuReductionTo)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.4、SKU的优惠、满减等信息 gulimall_sms -&gt;sms_sku_ladder \sms_sku_full_reduction\sms_member_price</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//sms_sku_ladder</span></span><br><span class="line">    <span class="type">SkuLadderEntity</span> <span class="variable">skuLadderEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuLadderEntity</span>();</span><br><span class="line">    skuLadderEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">    skuLadderEntity.setFullCount(skuReductionTo.getFullCount());</span><br><span class="line">    skuLadderEntity.setAddOther(skuReductionTo.getCountStatus());</span><br><span class="line">    skuLadderEntity.setDiscount(skuReductionTo.getDiscount());</span><br><span class="line">    <span class="keyword">if</span> (skuLadderEntity.getFullCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        skuLadderService.save(skuLadderEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//sms_sku_full_reduction</span></span><br><span class="line">    <span class="type">SkuFullReductionEntity</span> <span class="variable">skuFullReductionEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuFullReductionEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(skuReductionTo,skuFullReductionEntity);</span><br><span class="line">    <span class="comment">// BigDecimal 用 compareTo来比较</span></span><br><span class="line">    <span class="keyword">if</span> (skuFullReductionEntity.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.save(skuFullReductionEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//sms_member_price</span></span><br><span class="line"></span><br><span class="line">    List&lt;MemberPrice&gt; memberPrice = skuReductionTo.getMemberPrice();</span><br><span class="line"></span><br><span class="line">    List&lt;MemberPriceEntity&gt; collect = memberPrice.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="type">MemberPriceEntity</span> <span class="variable">priceEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemberPriceEntity</span>();</span><br><span class="line">        priceEntity.setSkuId(skuReductionTo.getSkuId());</span><br><span class="line">        priceEntity.setMemberPrice(item.getPrice());</span><br><span class="line">        priceEntity.setMemberLevelName(item.getName());</span><br><span class="line">        priceEntity.setMemberLevelId(item.getId());</span><br><span class="line">        priceEntity.setAddOther(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> priceEntity;</span><br><span class="line">    &#125;).filter(item -&gt; &#123;</span><br><span class="line">        <span class="comment">// 会员对应价格等于0 过滤掉</span></span><br><span class="line">        <span class="keyword">return</span> item.getMemberPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    memberPriceService.saveBatch(collect);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12-3-7-总结"><a href="#12-3-7-总结" class="headerlink" title="12.3.7 总结"></a><strong>12.3.7 总结</strong></h4><ul>
<li>电商系统中大表数据不做关联 宁可一点一点查询</li>
<li>商品新增业务，眨眼一看很多代码，但是如果把他们划分成几个功能点一一完成，业务也就不会变得很庞大</li>
</ul>
<p>相关操作的表</p>
<p><img src="/image-20201024113618961.png" alt="image-20201024113618961"></p>
<h4 id="12-3-8-商品保存后-Debug-调试"><a href="#12-3-8-商品保存后-Debug-调试" class="headerlink" title="12.3.8 商品保存后 Debug 调试"></a>12.3.8 商品保存后 Debug 调试</h4><p>很少有一次写的代码能一次通过，所以我们要 一个功能点一个断点来调试程序是否正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 将当前会话等级设置成读为提交，当前窗口就能查看到没有提交的数据</span><br><span class="line">SET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br></pre></td></tr></table></figure>

<p>具体 Debug 过程不在此叙述</p>
<h4 id="12-3-9-商品保存其他问题处理"><a href="#12-3-9-商品保存其他问题处理" class="headerlink" title="12.3.9 商品保存其他问题处理"></a>12.3.9 商品保存其他问题处理</h4><h5 id="1、-sku-images-表中-img-url-字段为空"><a href="#1、-sku-images-表中-img-url-字段为空" class="headerlink" title="1、   sku_images 表中 img_url 字段为空"></a>1、   <code>sku_images</code> 表中 img_url 字段为空</h5><p><code>sku_images</code> 中有很多图片都是为空，因此我们需要在程序中处理这个数据，空数据不写入到数据库中</p>
<p><img src="/image-20201024114238060.png" alt="image-20201024114238060"></p>
<p><strong>解决思路：</strong></p>
<p><code>skuImages</code> 保存部分代码、如果 <code>ImgUrl</code> 为空则进行过滤</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#125;).filter(entity -&gt;&#123;</span><br><span class="line">    <span class="comment">//返回 true 需要 false 过滤</span></span><br><span class="line">    <span class="keyword">return</span> !StringUtils.isEmpty(entity.getImgUrl());</span><br><span class="line">&#125;).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>



<h5 id="2、sku-满减以及打折信息-数据出现错误"><a href="#2、sku-满减以及打折信息-数据出现错误" class="headerlink" title="2、sku 满减以及打折信息 数据出现错误"></a>2、sku 满减以及打折信息 数据出现错误</h5><p>有部分数据 为0</p>
<p><img src="/image-20201024114652266.png" alt="image-20201024114652266"></p>
<p>解决思路：</p>
<p>在代码中过滤对应为0的数据</p>
<p>部分修改代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 满几件 大于0 可以添加  满多少钱 至少要大于0</span></span><br><span class="line"><span class="keyword">if</span> (skuReductionTo.getFullCount() &gt; <span class="number">0</span> || skuReductionTo.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> couponFeignService.saveSkuReduction(skuReductionTo);</span><br><span class="line">    <span class="keyword">if</span> (r1.getCode() != <span class="number">0</span>) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;远程保存sku优惠信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>远程服务中也进行对应修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">保存 商品阶梯价格</span></span><br><span class="line"><span class="comment">件数 大于0才能进行修改</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">if</span> (skuLadderEntity.getFullCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    skuLadderService.save(skuLadderEntity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">保存商品满减信息</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">  <span class="comment">// BigDecimal 用 compareTo来比较</span></span><br><span class="line"><span class="keyword">if</span> (skuFullReductionEntity.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">this</span>.save(skuFullReductionEntity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">保存商品会员价格</span></span><br><span class="line"><span class="comment">也进行了过滤数据</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"> &#125;).filter(item -&gt; &#123;</span><br><span class="line">            <span class="comment">// 会员对应价格等于0 过滤掉</span></span><br><span class="line">            <span class="keyword">return</span> item.getMemberPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<h5 id="3、程序中其他的异常"><a href="#3、程序中其他的异常" class="headerlink" title="3、程序中其他的异常"></a>3、程序中其他的异常</h5><p>程序中总会出现一些其他的异常的，这个留到高级篇进行讲解</p>
<h2 id="十三、-商品服务-amp-商品管理"><a href="#十三、-商品服务-amp-商品管理" class="headerlink" title="十三、 商品服务&amp;商品管理"></a>十三、 商品服务&amp;商品管理</h2><h4 id="13-1-商品管理-SPU-检索"><a href="#13-1-商品管理-SPU-检索" class="headerlink" title="13.1 商品管理 SPU 检索"></a>13.1 商品管理 SPU 检索</h4><p><strong>功能概述：</strong></p>
<ul>
<li>查询刚刚发布的商品，并能进行对应的条件查询</li>
</ul>
<p><img src="/image-20201024061157844.png" alt="image-20201024061157844"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:spuinfo:list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> spuInfoService.queryPageByCondition(params);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Service 实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件进行查询 spu相关信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 分页参数  status上架状态，catelogId 分类id brandId 品牌id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;SpuInfoEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出参数 key 进行查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;key&quot;</span>).or().like(<span class="string">&quot;spu_name&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证不为空 取出参数进行 查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(status)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;publish_status&quot;</span>,status);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">brandId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId)  &amp;&amp; ! <span class="string">&quot;0&quot;</span>.equalsIgnoreCase(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>,brandId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">catelogId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId) &amp;&amp; ! <span class="string">&quot;0&quot;</span>.equalsIgnoreCase(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>,catelogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SpuInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;SpuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程</strong></p>
<ul>
<li>主要查询的是 <code>pms_spu_info</code> 这张表 前端传递过来的参数 主要有分页，以及 品牌id 分类id  我们需要判断这些值是否正确，然后进行查询数据</li>
</ul>
<h4 id="13-1-商品管理-SkU-检索"><a href="#13-1-商品管理-SkU-检索" class="headerlink" title="13.1 商品管理 SkU 检索"></a>13.1 商品管理 SkU 检索</h4><p><strong>功能概述：</strong></p>
<p>查询具体的商品管理 库存 </p>
<p><img src="/image-20201024061836312.png" alt="image-20201024061836312"></p>
<p>Controller</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 列表</span><br><span class="line"> */</span><br><span class="line">@RequestMapping(&quot;/list&quot;)</span><br><span class="line">//@RequiresPermissions(&quot;product:skuinfo:list&quot;)</span><br><span class="line">public R list(@RequestParam Map&lt;String, Object&gt; params)&#123;</span><br><span class="line">    PageUtils page = skuInfoService.queryPageByCondition(params);</span><br><span class="line"></span><br><span class="line">    return R.ok().put(&quot;page&quot;, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;SkuInfoEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出参数 进行查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;sku_id&quot;</span>,key).or().like(<span class="string">&quot;sku_name&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证 id 是否为0 否则进行匹配</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">catelogId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId) &amp;&amp; !<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(catelogId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>,catelogId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">brandId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(brandId) &amp;&amp; !<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(brandId)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;brand_id&quot;</span>,brandId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">min</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;min&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(min)) &#123;</span><br><span class="line">        wrapper.ge(<span class="string">&quot;price&quot;</span>,min);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">max</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;max&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(max) ) &#123;</span><br><span class="line">        <span class="comment">// 怕前端传递的数据是 abc 等等 所以要抛出异常</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BigDecimal</span> <span class="variable">bigDecimal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(max);</span><br><span class="line">            <span class="keyword">if</span> ( bigDecimal.compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>) &#123;</span><br><span class="line">                wrapper.le(<span class="string">&quot;price&quot;</span>,max);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;SkuInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;SkuInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程：</strong></p>
<p>主要查询是 <code>pms_sku_info</code> 这张表，我出现的问题是发布商品时候，实体类的 价格 与 VO属性不一致，出现了数据没有拷贝，修改后，数据查询正常</p>
<h2 id="十四、仓储服务-amp-仓库管理"><a href="#十四、仓储服务-amp-仓库管理" class="headerlink" title="十四、仓储服务&amp;仓库管理"></a>十四、仓储服务&amp;仓库管理</h2><h3 id="14-1-整合ware服务-amp-获取仓库列表"><a href="#14-1-整合ware服务-amp-获取仓库列表" class="headerlink" title="14.1 整合ware服务&amp;获取仓库列表"></a>14.1 整合ware服务&amp;获取仓库列表</h3><h4 id="14-1-1整合-ware-服务"><a href="#14-1-1整合-ware-服务" class="headerlink" title="14.1.1整合 ware 服务"></a>14.1.1整合 ware 服务</h4><p>1、首先服务需要先注册到 Nacos 中，需要自己配置文件 配置对应的 nacos注册地址，</p>
<p>2、启动类需要开启 服务注册发现，开启远程服务调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span> <span class="comment">// 开启openfeign 远程服务调用</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启事务</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.atguigu.gulimall.ware.dao&quot;)</span> <span class="comment">//mapper包扫描</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">//服务注册发现</span></span><br></pre></td></tr></table></figure>

<h4 id="14-1-2-获取仓库列表"><a href="#14-1-2-获取仓库列表" class="headerlink" title="14.1.2 获取仓库列表"></a>14.1.2 获取仓库列表</h4><p><strong>具体需求：</strong></p>
<p>根据参数名查询出 仓库相关的记录 ，具体对于操作的是<code>wms_ware_info</code> 表</p>
<p><img src="/image-20201024121842147.png" alt="image-20201024121842147"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;ware:wareinfo:list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> wareInfoService.queryPage(params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;WareInfoEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String)params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="comment">// 拼接条件</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.eq(<span class="string">&quot;id&quot;</span>,key).or()</span><br><span class="line">                .like(<span class="string">&quot;name&quot;</span>,key)</span><br><span class="line">                .eq(<span class="string">&quot;address&quot;</span>,key)</span><br><span class="line">                .eq(<span class="string">&quot;areacode&quot;</span>,key);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;WareInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;WareInfoEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程</strong></p>
<p>仓库维护对应的是 <code>wms_ware_info</code> 根据前端传递过来的参数进行拼接然后进行查询</p>
<h3 id="14-2-查询库存-amp-创建采购需求"><a href="#14-2-查询库存-amp-创建采购需求" class="headerlink" title="14.2 查询库存&amp;创建采购需求"></a>14.2 查询库存&amp;创建采购需求</h3><h4 id="14-2-1-查询库存"><a href="#14-2-1-查询库存" class="headerlink" title="14.2.1 查询库存"></a>14.2.1 查询库存</h4><p><strong>具体需求：</strong></p>
<p>根据 <strong>仓库、skuId</strong> 进行查询对应的表是 wms_ware_sku </p>
<p><img src="/image-20201024122540156.png" alt="image-20201024122540156"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;ware:waresku:list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> wareSkuService.queryPage(params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;WareSkuEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出请求的参数 组装条件进行查询</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">skuId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;skuId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(skuId)) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;sku_id&quot;</span>,skuId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">wareId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;wareId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(wareId)) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;ware_id&quot;</span>,wareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;WareSkuEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;WareSkuEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程：</strong></p>
<p><code>wms_ware_sku</code> 主要的操作的就是该表 一样的封装条件，然后进行查询</p>
<h4 id="14-2-2-创建采购需求"><a href="#14-2-2-创建采购需求" class="headerlink" title="14.2.2 创建采购需求"></a>14.2.2 创建采购需求</h4><p><strong>具体需求：</strong></p>
<p>选择 仓库、状态、 以及其他关键字 查询出对应的数据 那么查询的是哪张表？ <code>wms_purchase_detail</code></p>
<p><img src="/image-20201024125311832.png" alt="image-20201024125311832"></p>
<p>Controller</p>
<p>如往常一样 调用 <code>Service</code> 返回结果 组装 返回~~~</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;ware:purchasedetail:list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> purchaseDetailService.queryPage(params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  //   status: 0,//状态</span></span><br><span class="line"><span class="comment"> *         //   wareId: 1,//仓库id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;PurchaseDetailEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取出key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="comment">// key 主要查询条件 </span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;purchase_id&quot;</span>,key).or().eq(<span class="string">&quot;sku_id&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(status)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;status&quot;</span>,status);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">wareId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;wareId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(wareId)) &#123;</span><br><span class="line">        wrapper.and((w) -&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;ware_id&quot;</span>,wareId);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;PurchaseDetailEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;PurchaseDetailEntity&gt;().getPage(params),</span><br><span class="line">            wrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程：</strong></p>
<p>对 <code>wms_purchase_detail</code> 表进行操作  拼装条件  查询 嗯 就这样~~~</p>
<h3 id="14-3-合并采购需求-amp-领取采购单-amp-完成采购-amp-Spu规格维护"><a href="#14-3-合并采购需求-amp-领取采购单-amp-完成采购-amp-Spu规格维护" class="headerlink" title="14.3 合并采购需求&amp;领取采购单&amp;完成采购&amp;Spu规格维护"></a>14.3 合并采购需求&amp;领取采购单&amp;完成采购&amp;Spu规格维护</h3><h4 id="14-3-1-合并采购需求"><a href="#14-3-1-合并采购需求" class="headerlink" title="14.3.1 合并采购需求"></a>14.3.1 合并采购需求</h4><p><strong>具体需求：</strong></p>
<p><img src="/image-20201024131822802.png"></p>
<p>选中 点击批量操作</p>
<p><img src="/image-20201024132207468.png" alt="image-20201024132207468"></p>
<p>请求参数分享</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  purchaseId: <span class="number">1</span>, <span class="comment">//整单id</span></span><br><span class="line">  items:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] <span class="comment">//合并项集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那就建立对应的 Vo 用来接收请求参数</p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mergeVo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">///ware/purchase/merge</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/merge&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">merge</span><span class="params">(<span class="meta">@RequestBody</span> MergeVo mergeVo)</span> &#123;</span><br><span class="line">    purchaseService.mrgePurchase(mergeVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并采购需求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mergeVo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mrgePurchase</span><span class="params">(MergeVo mergeVo)</span> &#123;</span><br><span class="line">    <span class="comment">// 拿到采购单id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">purchaseId</span> <span class="operator">=</span> mergeVo.getPurchaseId();</span><br><span class="line">    <span class="comment">// 采购单 id为空 新建</span></span><br><span class="line">    <span class="keyword">if</span> (purchaseId == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line">        <span class="comment">// 状态设置为新建</span></span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.CREATED.getCode());</span><br><span class="line">        purchaseEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="built_in">this</span>.save(purchaseEntity);</span><br><span class="line">        <span class="comment">// 拿到最新的采购单id</span></span><br><span class="line">        purchaseId = purchaseEntity.getId();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//TODO 确认采购是 0 或 1 才可以合并</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拿到合并项 **采购需求的id**</span></span><br><span class="line">    List&lt;Long&gt; items = mergeVo.getItems();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">finalPurchaseId</span> <span class="operator">=</span> purchaseId;</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; collect = items.stream().map(i -&gt; &#123;</span><br><span class="line">        <span class="comment">// 采购需求</span></span><br><span class="line">        <span class="type">PurchaseDetailEntity</span> <span class="variable">detailEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过采购单id 查询到 采购信息对象</span></span><br><span class="line">        <span class="type">PurchaseEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(finalPurchaseId);</span><br><span class="line">        <span class="comment">// 状态如果是正在采购</span></span><br><span class="line">        <span class="keyword">if</span> (! (byId.getStatus() == WareConstant.PurchaseDetailStatusEnum.BUYING.getCode())) &#123;</span><br><span class="line">            <span class="comment">// 设置为已分配</span></span><br><span class="line">            detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.HASERROR.getCode());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        detailEntity.setId(i);</span><br><span class="line">        <span class="comment">// 设置采购单id</span></span><br><span class="line">        detailEntity.setPurchaseId(finalPurchaseId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> detailEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// id批量更新</span></span><br><span class="line">    purchaseDetailService.updateBatchById(collect);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次合并的话 更新修改时间</span></span><br><span class="line">    <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line">    purchaseEntity.setId(purchaseId);</span><br><span class="line">    purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.updateById(purchaseEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程:</strong></p>
<ul>
<li>从 参数 mergeVo中取出 purchaseId 和 items 进行相关操作 </li>
<li>主要是用来操作两张表 <code>wms_purchase</code> 和 <code>wms_purchase_detail</code> </li>
<li><code>wms_purchase</code> 表是 采购信息</li>
<li><code>wms_purchase_detail</code> 表是 采购需求</li>
<li>我的理解是将 <code>wms_purchase</code> 的id插入到 <code>wms_purchase_detail</code> 表中 也就是 purchase_id 字段，中间通过这个字段关联起来，同时 <code>wms_purchase</code> 表对 status 状态有比较多的选择，视频里面也是定义了两个常量</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WareConstant</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">PurchaseStatusEnum</span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>,<span class="string">&quot;新建&quot;</span>),ASSIGNED(<span class="number">1</span>,<span class="string">&quot;已分配&quot;</span>),</span><br><span class="line">        RECEIVE(<span class="number">2</span>,<span class="string">&quot;已领取&quot;</span>),FINISH(<span class="number">3</span>,<span class="string">&quot;已完成&quot;</span>),</span><br><span class="line">        HASERROR(<span class="number">4</span>,<span class="string">&quot;有异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        PurchaseStatusEnum(<span class="type">int</span> code,String msg) &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">PurchaseDetailStatusEnum</span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>,<span class="string">&quot;新建&quot;</span>),ASSIGNED(<span class="number">1</span>,<span class="string">&quot;已分配&quot;</span>),</span><br><span class="line">        BUYING(<span class="number">2</span>,<span class="string">&quot;正在采购&quot;</span>),FINISH(<span class="number">3</span>,<span class="string">&quot;已完成&quot;</span>),</span><br><span class="line">        HASERROR(<span class="number">4</span>,<span class="string">&quot;采购失败&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line">        PurchaseDetailStatusEnum(<span class="type">int</span> code,String msg) &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将常量抽取出来，修改更加方便</p>
<h4 id="14-3-2-领取采购单"><a href="#14-3-2-领取采购单" class="headerlink" title="14.3.2 领取采购单"></a>14.3.2 领取采购单</h4><p><strong>具体需求：</strong></p>
<p>合并采购需求成功后，具体这个功能有啥用啊？ 你总得需要有人去采购吧？ 所以就会有一个<strong>采购APP 工作人员点击采购</strong>，然后就去采购，这里就没有实现采购 APP 就用接口来实现，通过 JSON 的参数 来请求</p>
<p><img src="/image-20201024140120849.png" alt="image-20201024140120849"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/received&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">received</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    purchaseService.received(ids);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">received</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、确认当前采购单是 新建或者 已分配状态 才能进行采购</span></span><br><span class="line">    List&lt;PurchaseEntity&gt; collect = ids.stream().map(id -&gt; &#123;</span><br><span class="line">        <span class="comment">// 根据采购id查询出采购信息</span></span><br><span class="line">        <span class="type">PurchaseEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">return</span> byId;</span><br><span class="line">    &#125;).filter(item -&gt; &#123;</span><br><span class="line">        <span class="comment">// 新建或者已分配留下</span></span><br><span class="line">        <span class="keyword">if</span> (item.getStatus() == WareConstant.PurchaseStatusEnum.CREATED.getCode() ||</span><br><span class="line">                item.getStatus() == WareConstant.PurchaseStatusEnum.ASSIGNED.getCode()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;).map(item -&gt; &#123;</span><br><span class="line">        <span class="comment">// 设置为已领取</span></span><br><span class="line">        item.setStatus(WareConstant.PurchaseStatusEnum.RECEIVE.getCode());</span><br><span class="line">        item.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、改变采购单状态</span></span><br><span class="line">    <span class="built_in">this</span>.updateBatchById(collect);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3、改变采购项的状态</span></span><br><span class="line">    collect.forEach((item) -&gt; &#123;</span><br><span class="line">        <span class="comment">// 根据 purchase_id 查询出采购需求</span></span><br><span class="line">        List&lt;PurchaseDetailEntity&gt; entities = purchaseDetailService.listDetailByPurchaseId(item.getId());</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        List&lt;PurchaseDetailEntity&gt; detailEntites = entities.stream().map(entity -&gt; &#123;</span><br><span class="line">            <span class="type">PurchaseDetailEntity</span> <span class="variable">detailEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line"></span><br><span class="line">            detailEntity.setId(entity.getId());</span><br><span class="line">            <span class="comment">// 设置状态正在采购</span></span><br><span class="line">            detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.BUYING.getCode());</span><br><span class="line">            <span class="keyword">return</span> detailEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// id批量更新</span></span><br><span class="line">        purchaseDetailService.updateBatchById(detailEntites);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>总结业务流程：</strong></p>
<p>业务分析</p>
<ul>
<li>采购人员通过 APP 点击采购 完成对应的采购需求，这里使用的是 PostMan 来发送请求，发送请求 带的参数是什么？ 参数就是 采购Id</li>
<li>通过采购 Id 查询出采购相关信息，然后设置采购表的状态，设置成采购成功，同时通过这个 id 在 <code>wms_purchase_detail</code>  表中 <strong>对应的是 purchase_id</strong> 查询采购需求表的数据， 查询到后将他的状态设置成 <strong>“正在采购“</strong></li>
</ul>
<h4 id="14-3-3-完成采购"><a href="#14-3-3-完成采购" class="headerlink" title="14.3.3 完成采购"></a>14.3.3 完成采购</h4><p><strong>具体需求：</strong></p>
<p>采购人员参与采购后，采购就会有他的结果，采购成功、采购失败，</p>
<p><img src="/image-20201024142800046.png" alt="image-20201024142800046"></p>
<p>有了请求参数，如果比较多，那么底考虑设计一个 VO 哦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/done&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">finish</span><span class="params">(<span class="meta">@RequestBody</span> PurchaseDoneVo doneVo)</span> &#123;</span><br><span class="line">    purchaseService.done(doneVo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PurchaseDoneVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 采购单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">public</span> List&lt;PurchaseItemDoneVo&gt; items;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class PurchaseItemDoneVo &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 完成/失败的需求详情</span><br><span class="line">     */</span><br><span class="line">    private Long itemId;</span><br><span class="line">    /**</span><br><span class="line">     * 状态</span><br><span class="line">     */</span><br><span class="line">    private Integer status;</span><br><span class="line">    </span><br><span class="line">    private String reason;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">done</span><span class="params">(PurchaseDoneVo doneVo)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 采购单id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> doneVo.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、改变采购项目的状态</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    List&lt;PurchaseItemDoneVo&gt; items = doneVo.getItems();</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; updates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (PurchaseItemDoneVo item : items) &#123;</span><br><span class="line">        <span class="type">PurchaseDetailEntity</span> <span class="variable">detailEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line">        <span class="comment">// 如果采购失败</span></span><br><span class="line">        <span class="keyword">if</span> (item.getStatus() == WareConstant.PurchaseDetailStatusEnum.HASERROR.getCode()) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            detailEntity.setStatus(item.getStatus());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3、将成功采购的进行入库</span></span><br><span class="line">            <span class="type">PurchaseDetailEntity</span> <span class="variable">entity</span> <span class="operator">=</span> purchaseDetailService.getById(item.getItemId());</span><br><span class="line">            wareSkuService.addStock(entity.getSkuId(),entity.getWareId(),entity.getSkuNum());</span><br><span class="line">            detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.FINISH.getCode());</span><br><span class="line">        &#125;</span><br><span class="line">        detailEntity.setId(item.getItemId());</span><br><span class="line">        updates.add(detailEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 批量更新</span></span><br><span class="line">    purchaseDetailService.updateBatchById(updates);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、改变采购单状态</span></span><br><span class="line">    <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line">    purchaseEntity.setId(id);</span><br><span class="line">    <span class="comment">// 设置状态根据变量判断</span></span><br><span class="line">    purchaseEntity.setStatus(flag?WareConstant.PurchaseStatusEnum.FINISH.getCode():WareConstant.PurchaseStatusEnum.HASERROR.getCode());</span><br><span class="line">    purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.updateById(purchaseEntity);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>addStock方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> &#123;</span><br><span class="line">    <span class="comment">// 先根据 skuId 和 ware_id 查询 是否拥有这个用户</span></span><br><span class="line">    List&lt;WareSkuEntity&gt; wareSkuEntities = wareSkuDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).eq(<span class="string">&quot;ware_id&quot;</span>, wareId));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//没有这个用户 那就新增</span></span><br><span class="line">    <span class="keyword">if</span>(wareSkuEntities == <span class="literal">null</span> || wareSkuEntities.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">WareSkuEntity</span> <span class="variable">wareSkuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WareSkuEntity</span>();</span><br><span class="line">        <span class="comment">// 根据属性值设置</span></span><br><span class="line">        wareSkuEntity.setSkuId(skuId);</span><br><span class="line">        wareSkuEntity.setStock(skuNum);</span><br><span class="line">        wareSkuEntity.setWareId(wareId);</span><br><span class="line">        wareSkuEntity.setStockLocked(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// TODO 远程查询sku的名字 如果失败整个事务不需要回滚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 远程调用 根据 skuid进行查询</span></span><br><span class="line">            <span class="type">R</span> <span class="variable">info</span> <span class="operator">=</span> productFeignService.info(skuId);</span><br><span class="line">            Map&lt;String,Object&gt; map = (Map&lt;String, Object&gt;) info.get(<span class="string">&quot;skuInfo&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (info.getCode() == <span class="number">0</span>) &#123;</span><br><span class="line">                wareSkuEntity.setSkuName((String) map.get(<span class="string">&quot;skuName&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        wareSkuDao.insert(wareSkuEntity);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 有该记录那就进行更新</span></span><br><span class="line">    wareSkuDao.addStock(skuId,wareId,skuNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>addStock 具体实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=<span class="string">&quot;addStock&quot;</span>&gt;</span><br><span class="line">UPDATE `wms_ware_sku` SET stock=stock+#&#123;skuNum&#125; WHERE sku_id=#&#123;skuId&#125; AND ware_id=#&#123;wareId&#125;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h4 id="14-3-4-Spu规格维护"><a href="#14-3-4-Spu规格维护" class="headerlink" title="14.3.4 Spu规格维护"></a>14.3.4 Spu规格维护</h4><p><strong>具体需求：</strong></p>
<p>前端项目遇到的问题： 需要自己去 router目录下找到 index.js 增加改行配置，主要是配置规格维护的路径</p>
<p><img src="/image-20201025095926893.png" alt="image-20201025095926893"></p>
<p>在 Spu管理上 点击规格后查询出相关规格信息</p>
<p><img src="/image-20201025100138990.png" alt="image-20201025100138990"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/base/listforspu/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">baseAttrListforspu</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span> &#123;</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; productAttrValueEntity = productAttrValueService.baseAttrListforspu(spuId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,productAttrValueEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ProductAttrValueEntity&gt; <span class="title function_">baseAttrListforspu</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、根据spuid进行查询</span></span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; attrValueEntities = <span class="built_in">this</span>.baseMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">    <span class="keyword">return</span> attrValueEntities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程：</strong></p>
<p>单表操作，根据 spu_id 查询出 <code>pms_product_attr_value</code> 表的信息</p>
<h4 id="14-3-5-Spu更新操作"><a href="#14-3-5-Spu更新操作" class="headerlink" title="14.3.5 Spu更新操作"></a>14.3.5 Spu更新操作</h4><p><strong>具体需求：</strong></p>
<p>根据spu_id 查询出规格信息后 ，修改对应信息 提交后会发送一个post请求，并同时带上请求参数</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;入网型号&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LIO-AL00&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;quickShow&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;机身材质工艺&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;玻璃&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;quickShow&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;attrId&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CPU型号&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;attrValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HUAWEI Kirin 980&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;quickShow&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>刚好这四个参数和实体类的一致，就不需要创建 Vo来接收</p>
<p><img src="/image-20201025100424345.png" alt="image-20201025100424345"></p>
<p>Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/update/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:attr:update&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateSpuAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId,</span></span><br><span class="line"><span class="params">                       <span class="meta">@RequestBody</span> List&lt;ProductAttrValueEntity&gt; productAttrValueEntityList)</span>&#123;</span><br><span class="line"></span><br><span class="line">    productAttrValueService.updateSpuAttr(spuId,productAttrValueEntityList);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 先删除 后更新</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> spuId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> productAttrValueEntityList</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSpuAttr</span><span class="params">(Long spuId, List&lt;ProductAttrValueEntity&gt; productAttrValueEntityList)</span> &#123;</span><br><span class="line">    <span class="comment">// 1、根据spuid删除记录</span></span><br><span class="line">    <span class="built_in">this</span>.baseMapper.delete(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>,spuId));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、遍历传递过来的记录 设置 spuId</span></span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = productAttrValueEntityList.stream().map(item -&gt; &#123;</span><br><span class="line">        item.setSpuId(spuId);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 3、批量保存</span></span><br><span class="line">    <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结业务流程：</strong></p>
<ul>
<li>更新操作，根据前端传递过来的参数来进行更新，前端传递了一个 <code>spu_id</code> 和多个 spu属性值 一个 <code>spu_id</code>对多个 spu 属性值</li>
<li>先根据 <code>spu_id</code> 删除存在 pms_product_attr_value 表的记录 </li>
<li>然后对多个  ProductAttrValueEntity 对象设置 sup_id ，最后进行批量保存</li>
</ul>
<h2 id="分布式基础篇总结"><a href="#分布式基础篇总结" class="headerlink" title="分布式基础篇总结"></a>分布式基础篇总结</h2><p><strong>1、分布式基础概念</strong></p>
<ul>
<li>微服务、注册中心（Nacos）、配置中心（Nacos Cofig）、远程调用、Feign、网关</li>
</ul>
<p><strong>2、基础开发</strong></p>
<ul>
<li>SpringBoot2.0、SpringCloud、Mybatis-Plus、Vue组件化、阿里云对象存储</li>
</ul>
<p><strong>3、环境</strong></p>
<ul>
<li>Vagrant、Linux、Docker、MySQL、Redis、逆向工程&amp;人人开源</li>
</ul>
<p><strong>4、开发规范</strong></p>
<ul>
<li>数据效验JSR303、全局异常处理、全局统一返回、全家跨越处理</li>
<li>枚举状态、业务状态、VO与TO与PO划分、逻辑删除</li>
<li>Lombok:@Data、@Slf4j</li>
</ul>

      </div>
      
      
      
    </div>

    
    


</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jonebs</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
